<html>
<head>
<title>CI: Build performance testing with github action</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">CI:ç”¨ github åŠ¨ä½œæ„å»ºæ€§èƒ½æµ‹è¯•</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/nerd-for-tech/ci-build-performance-testing-with-github-action-e6b227097c83?source=collection_archive---------0-----------------------#2020-05-18">https://medium.com/nerd-for-tech/ci-build-performance-testing-with-github-action-e6b227097c83?source=collection_archive---------0-----------------------#2020-05-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/06fe5eb2fb141f2185d36e678d341481.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*GGvk_pzxNmkShp3F.png"/></div></div></figure><p id="0006" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">å¦‚æœ<strong class="is hj"> DevOps </strong>å’Œ<strong class="is hj"> CI/CD </strong>å·²ç»åœ¨ä½ çš„å…¬å¸å®Œå…¨é‡‡ç”¨ï¼Œæˆ‘ç›¸ä¿¡ä½ å·²ç»æœ‰ä¸€äº›è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œä½†æ˜¯ä½ æµ‹è¯•ä½ çš„<strong class="is hj">æ€§èƒ½</strong>å—ï¼Ÿå¦‚æœæ²¡æœ‰ï¼Œæ‚¨åº”è¯¥è€ƒè™‘åœ¨æ‚¨çš„å‘å¸ƒç³»åˆ—ä¸­æ·»åŠ æ€§èƒ½æµ‹è¯•ã€‚</p><p id="58a7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">æˆ‘å°†å±•ç¤ºæˆ‘å¦‚ä½•ä½¿ç”¨<strong class="is hj"> GitHub action </strong>åœ¨æˆ‘çš„ä¸€ä¸ª npm åº“ä¸Šæµ‹è¯•æ€§èƒ½ã€‚å®ƒæä¾›äº†æ£€æŸ¥æ‚¨æ˜¯å¦æœ‰æ€§èƒ½é€€åŒ–çš„å·¥å…·ã€‚</p></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><h1 id="a044" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">ç¼–å†™æ€§èƒ½æµ‹è¯•</h1><p id="623a" class="pw-post-body-paragraph iq ir hi is b it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn hb bi translated">å¯ä»¥æƒ³è±¡ï¼Œç¬¬ä¸€ä»¶äº‹å°±æ˜¯å†™æ€§èƒ½æµ‹è¯•ã€‚<br/>å› ä¸ºæˆ‘åœ¨è¿™ä¸ªåº“ä¸Šä½¿ç”¨äº† typescriptï¼Œæ‰€ä»¥æˆ‘ä½¿ç”¨äº†<a class="ae ky" href="https://benchmarkjs.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj"> benchmarkjs </strong> </a>æ¡†æ¶æ¥ç¼–å†™å®ƒã€‚</p><p id="a246" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">ä¸€ä¸ªåŸºæœ¬çš„æ€§èƒ½æµ‹è¯•å°†å¦‚ä¸‹æ‰€ç¤º:</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="0a58" class="li jw hi le b fi lj lk l ll lm"><strong class="le hj">import</strong> Benchmark = <strong class="le hj">require</strong>('benchmark');</span><span id="e569" class="li jw hi le b fi ln lk l ll lm"><strong class="le hj">const</strong> suite = <strong class="le hj">new</strong> Benchmark.Suite;<br/><strong class="le hj">suite</strong><br/>    .<strong class="le hj">add</strong>('some test case', () =&gt; {<br/>        <em class="lo">// here call the code you want to test.</em><br/>    })<br/>    .<strong class="le hj">on</strong>('cycle', event =&gt; {<br/>        <em class="lo">// Output benchmark result by converting benchmark result to string</em><br/>        <strong class="le hj">console.log(String(event.target));</strong><br/>    })<br/>    .<strong class="le hj">run</strong>();</span></pre><p id="0fef" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">å¦‚æœæ‚¨æ²¡æœ‰ä½¿ç”¨ Typescript/Javascriptï¼Œè¯·æ³¨æ„ GitHub åŠ¨ä½œä¸ä»¥ä¸‹å†…å®¹å…¼å®¹:</p><ul class=""><li id="4d6e" class="lp lq hi is b it iu ix iy jb lr jf ls jj lt jn lu lv lw lx bi translated"><code class="du ly lz ma le b"><a class="ae ky" href="https://doc.rust-lang.org/cargo/commands/cargo-bench.html" rel="noopener ugc nofollow" target="_blank">cargo bench</a></code>å¯¹äº Rust é¡¹ç›®</li><li id="b636" class="lp lq hi is b it mb ix mc jb md jf me jj mf jn lu lv lw lx bi translated"><code class="du ly lz ma le b">go test -bench</code>å¯¹äº Go é¡¹ç›®</li><li id="a928" class="lp lq hi is b it mb ix mc jb md jf me jj mf jn lu lv lw lx bi translated">ç”¨äº JavaScript/TypeScript é¡¹ç›®çš„<a class="ae ky" href="https://benchmarkjs.com/" rel="noopener ugc nofollow" target="_blank"> benchmark.js </a></li><li id="f07c" class="lp lq hi is b it mb ix mc jb md jf me jj mf jn lu lv lw lx bi translated"><a class="ae ky" href="https://pypi.org/project/pytest-benchmark/" rel="noopener ugc nofollow" target="_blank">py test-ç”¨<a class="ae ky" href="https://pypi.org/project/pytest/" rel="noopener ugc nofollow" target="_blank"> pytest </a>å¯¹ Python é¡¹ç›®è¿›è¡ŒåŸºå‡†æµ‹è¯•</a></li><li id="e6fb" class="lp lq hi is b it mb ix mc jb md jf me jj mf jn lu lv lw lx bi translated">ç”¨äº C++é¡¹ç›®çš„è°·æ­ŒåŸºå‡†æ¡†æ¶</li><li id="9b9a" class="lp lq hi is b it mb ix mc jb md jf me jj mf jn lu lv lw lx bi translated">å¯¹äº C++é¡¹ç›®æ¥è¯´</li></ul><h2 id="76f1" class="li jw hi bd jx mg mh mi kb mj mk ml kf jb mm mn kj jf mo mp kn jj mq mr kr ms bi translated">ä¸ºä»€ä¹ˆè¦ä½¿ç”¨åŸºå‡†åº“</h2><p id="e5e6" class="pw-post-body-paragraph iq ir hi is b it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn hb bi translated">å› ä¸ºåœ¨ä»£ç ä¸­å®ç°å®ƒæ€»æ˜¯ä¸€ä¸ªå™©æ¢¦ï¼Œæ‰€ä»¥è¿™äº›åº“è¿è¡Œç›¸åŒçš„ä»£ç  X æ¬¡ï¼Œä»¥ç¡®ä¿åœ¨æœ€åæœ‰æ›´å¤šç›¸å…³çš„ç»Ÿè®¡æ•°æ®ã€‚</p></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><h1 id="6c0b" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">è®¾ç½®æ‚¨çš„ GitHub æ“ä½œ</h1><p id="ffd2" class="pw-post-body-paragraph iq ir hi is b it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn hb bi translated">GitHub åŠ¨ä½œæ˜¯<strong class="is hj">è¿ç»­åŸºå‡†</strong>ï¼Œåœ¨<a class="ae ky" href="https://github.com/marketplace/actions/continuous-benchmark" rel="noopener ugc nofollow" target="_blank"> GitHub åŠ¨ä½œå¸‚åœº</a>æœ‰å”®ã€‚</p><p id="0c1b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">è¿™ä¸ª GitHub æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</strong></p><ol class=""><li id="dcb7" class="lp lq hi is b it iu ix iy jb lr jf ls jj lt jn mt lv lw lx bi translated">å®ƒè¿è¡Œæ‚¨çš„æ€§èƒ½æµ‹è¯•</li><li id="4991" class="lp lq hi is b it mb ix mc jb md jf me jj mf jn mt lv lw lx bi translated">å®ƒå°†ç»“æœå­˜å‚¨åœ¨æ‚¨çš„ gh é¡µé¢ä¸­ã€‚</li><li id="2439" class="lp lq hi is b it mb ix mc jb md jf me jj mf jn mt lv lw lx bi translated">å®ƒå°†å…¶ä¸æœ€åçš„ç»“æœè¿›è¡Œæ¯”è¾ƒã€‚</li><li id="d286" class="lp lq hi is b it mb ix mc jb md jf me jj mf jn mt lv lw lx bi translated">å¦‚æœè¾¾åˆ°äº†æ€§èƒ½é˜ˆå€¼ï¼Œå®ƒä¼šå¯¹æ‚¨çš„æäº¤è¿›è¡Œæ³¨é‡Šã€‚</li></ol></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><h2 id="3fe0" class="li jw hi bd jx mg mh mi kb mj mk ml kf jb mm mn kj jf mo mp kn jj mq mr kr ms bi translated">1.åˆ›å»ºæ‚¨çš„<code class="du ly lz ma le b">gh-pages</code>åˆ†å…¬å¸</h2><p id="d5ac" class="pw-post-body-paragraph iq ir hi is b it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn hb bi translated">é¦–å…ˆï¼Œå¦‚æœæ‚¨è¿˜æ²¡æœ‰ä¸º GitHub é¡µé¢åˆ›å»ºåˆ†æ”¯ï¼Œé‚£ä¹ˆæ‚¨éœ€è¦ä¸ºå®ƒåˆ›å»ºä¸€ä¸ªåˆ†æ”¯ã€‚è¿™ç”¨äºæ˜¾ç¤ºæ‚¨çš„ä»ªè¡¨æ¿ã€‚</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="ebdd" class="li jw hi le b fi lj lk l ll lm"><em class="lo"># Create a local branch</em><br/>$ <strong class="le hj">git checkout --orphan gh-pages</strong><br/><em class="lo"># Push it to create a remote branch</em><br/>$ <strong class="le hj">git push origin gh-pages:gh-pages</strong></span></pre><p id="fef1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">ä¸è¦å¿˜è®°åœ¨è¿™ä¸ªåˆ†æ”¯ä¸Šæ¿€æ´»è¿™ä¸ªé¡¹ç›®çš„ GitHub é¡µé¢ã€‚ä¸ºæ­¤ï¼Œä½ åº”è¯¥å»ä½ çš„é¡¹ç›®è®¾ç½®ã€‚</p><figure class="kz la lb lc fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mu"><img src="../Images/cccf99858ef0b74c54162504754744bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*krLgjVnLnnpNQZv5kVZATg.png"/></div></div></figure><h2 id="57fa" class="li jw hi bd jx mg mh mi kb mj mk ml kf jb mm mn kj jf mo mp kn jj mq mr kr ms bi translated">2.åˆ›å»º GitHub ä¸ªäººè®¿é—®ä»¤ç‰Œ</h2><p id="2b50" class="pw-post-body-paragraph iq ir hi is b it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn hb bi translated">æ‚¨åº”è¯¥<a class="ae ky" href="https://help.github.com/en/github/authenticating-to-github/creating-a-personal-access-token-for-the-command-line" rel="noopener ugc nofollow" target="_blank">åˆ›å»º GitHub ä¸ªäººè®¿é—®ä»¤ç‰Œ</a>å’Œä½œç”¨åŸŸ<code class="du ly lz ma le b">repo</code>ï¼Œæˆ‘ä»¬ç”¨å®ƒæ¥æ¨åŠ¨<code class="du ly lz ma le b">gh-pages</code>åˆ†æ”¯ã€‚</p><p id="e662" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">å½“å®ƒè¢«å±•ç¤ºçš„æ—¶å€™ä¸è¦å¿˜è®°æ‹·è´å®ƒğŸ˜‰ã€‚</p><h2 id="72e5" class="li jw hi bd jx mg mh mi kb mj mk ml kf jb mm mn kj jf mo mp kn jj mq mr kr ms bi translated">3.åˆ›å»ºæ‚¨çš„å·¥ä½œæµç¨‹</h2><p id="8ee7" class="pw-post-body-paragraph iq ir hi is b it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn hb bi translated">åœ¨ä½ çš„é¡¹ç›®ä¸­åˆ›å»ºä¸€ä¸ªæ–‡ä»¶<code class="du ly lz ma le b">.github/workflow/benchmark.yml</code>ã€‚</p><p id="1ef9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">è¯¥æ–‡ä»¶åº”è¯¥åŒ…å«å¦‚ä¸‹å†…å®¹:</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="351f" class="li jw hi le b fi lj lk l ll lm">name: Benchmark<br/><strong class="le hj">on:<br/>  push:<br/>    branches:<br/>      - master</strong><br/><br/>jobs:<br/>  benchmark:<br/>    name: Check performance regeression.<br/>    runs-on: ubuntu-latest<br/>    steps:<br/>      - uses: actions/checkout@v2<br/>      - uses: actions/setup-node@v1<br/>      - name: Run benchmark<br/><strong class="le hj">        run: npm install &amp;&amp; npm run bench | tee output.txt</strong><br/>      - name: Store benchmark result<br/>        uses: rhysd/github-action-benchmark@v1<br/>        with:<br/>          name: Benchmark.js Benchmark<br/>          tool: 'benchmarkjs'<br/>          output-file-path: output.txt<em class="lo"><br/>          </em>github-token: ${{ secrets.PERSONAL_GITHUB_TOKEN }}<br/>          auto-push: true<em class="lo"><br/></em><strong class="le hj"><em class="lo">          </em>alert-threshold: '130%'</strong><br/>          comment-on-alert: true<br/>          fail-on-alert: true<br/><strong class="le hj">          alert-comment-cc-users: '@thomaspoignant'</strong></span></pre><p id="13e2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">è¯¥æ–‡ä»¶ä¸­çš„é‡è¦å†…å®¹æœ‰:</strong></p><ul class=""><li id="843a" class="lp lq hi is b it iu ix iy jb lr jf ls jj lt jn lu lv lw lx bi translated"><code class="du ly lz ma le b"><strong class="is hj">on</strong></code>éƒ¨åˆ†ï¼Œå¦‚ä½ æ‰€è§ï¼Œæˆ‘ä»¬åªæ£€æŸ¥äº†<code class="du ly lz ma le b">master</code>åˆ†å…¬å¸çš„ç»©æ•ˆã€‚æˆ‘ä»¬è¿™æ ·åšæ˜¯ä¸ºäº†åœ¨æœ€åæœ‰ä¸€ä¸ªå¯ç†è§£çš„å›¾ï¼Œå¦‚æœæˆ‘ä»¬åœ¨å¤šä¸ª branch/pull è¯·æ±‚ä¸Šè¿™æ ·åšï¼Œç»“æœå°†æ˜¯æ··ä¹±çš„ã€‚</li><li id="a7f8" class="lp lq hi is b it mb ix mc jb md jf me jj mf jn lu lv lw lx bi translated"><code class="du ly lz ma le b"><strong class="is hj">run</strong></code> part æ˜¯æ‰§è¡Œå·¥ä½œå°å¹¶å°†ç»“æœè¾“å‡ºåˆ°æ–‡ä»¶ä¸­çš„å‘½ä»¤ã€‚</li><li id="dfed" class="lp lq hi is b it mb ix mc jb md jf me jj mf jn lu lv lw lx bi translated"><code class="du ly lz ma le b"><strong class="is hj">alert-threshold</strong></code> <strong class="is hj">ï¼Œ</strong>è¿™æ˜¯åœ¨æ€§èƒ½ä¸‹é™æ—¶è¯„è®ºæ‚¨æäº¤çš„é˜ˆå€¼ã€‚</li><li id="fc83" class="lp lq hi is b it mb ix mc jb md jf me jj mf jn lu lv lw lx bi translated"><code class="du ly lz ma le b"><strong class="is hj">alert-comment-cc-users</strong></code> <strong class="is hj">ï¼Œ</strong>æ¯æ¬¡æœ‰ commit ä¸Šçš„æ³¨é‡Šï¼Œå®ƒä¹Ÿä¼š ping è¿™ä¸ªç”¨æˆ·ã€‚</li></ul><h2 id="b280" class="li jw hi bd jx mg mh mi kb mj mk ml kf jb mm mn kj jf mo mp kn jj mq mr kr ms bi translated">4.å®ƒçœ‹èµ·æ¥æ€ä¹ˆæ ·</h2><p id="0096" class="pw-post-body-paragraph iq ir hi is b it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn hb bi translated">ç¬¬ä¸€æ¬¡å·¥ä½œæµè¿è¡Œåï¼Œæ‚¨å°†åœ¨<code class="du ly lz ma le b">https://you.github.io/repo/dev/bench</code> <a class="ae ky" href="https://rhysd.github.io/github-action-benchmark/dev/bench/" rel="noopener ugc nofollow" target="_blank">ä¸Šè·å¾—ç¬¬ä¸€ä¸ªç»“æœï¼Œå¦‚ä¸‹å›¾</a>ã€‚</p><figure class="kz la lb lc fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mv"><img src="../Images/6a871c630c14b0458cfdf7058452ba61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vn6oIqCjyPj1hNfW90xFmA.png"/></div></div></figure><p id="0fac" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">å¦‚æœè¾¾åˆ°é˜ˆå€¼ï¼Œæ‚¨å°†åœ¨æäº¤ä¸­ç›´æ¥çœ‹åˆ°ä¸€æ¡æ³¨é‡Šï¼Œå¦‚ä¸‹æ‰€ç¤º:</p><figure class="kz la lb lc fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/f352de097170e5e65d292015d9ec2b9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rObpTbdkpH2PlH03"/></div></div></figure></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><h1 id="6027" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">ç»“è®º</h1><p id="1658" class="pw-post-body-paragraph iq ir hi is b it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn hb bi translated">æˆ‘ä½¿ç”¨è¿™ä¸ªç³»ç»Ÿæ¥æ£€æµ‹åº“çš„æ€§èƒ½é—®é¢˜ï¼Œä»¥æµ‹è¯•åŸºæœ¬çš„ç®—æ³•å›å½’ã€‚ä½†æ˜¯æ‚¨å¯ä»¥ä½¿ç”¨å®ƒæ¥è°ƒç”¨ HTTP ç«¯ç‚¹ï¼Œæˆ–è€…æ‰§è¡Œæ‚¨æƒ³è¦æµ‹è¯•å’Œç›‘æ§çš„æ›´å¤æ‚çš„é€»è¾‘ã€‚</p><p id="5f7b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">å°½å¯èƒ½å¤šåœ°æ·»åŠ æ€§èƒ½æµ‹è¯•ã€‚è¿™å°†æœ‰åŠ©äºä½ å’Œä½ çš„å›¢é˜Ÿæ‹¥æœ‰ä¸€ä¸ªæ›´å¥½çš„äº§å“ï¼Œå¹¶ä¸”åœ¨ä¸€ä¸ªç‰ˆæœ¬å‘å¸ƒåèƒ½å¿«é€Ÿæ£€æµ‹å‡ºæŸä¸ªä¸œè¥¿æ˜¯å¦èŠ±è´¹äº†æ¯”å¹³å¸¸æ›´é•¿çš„æ—¶é—´ã€‚</p></div></div>    
</body>
</html>