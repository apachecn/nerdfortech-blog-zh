<html>
<head>
<title>Home DevOps Pipeline: A junior engineerâ€™s tale (2/4)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">å®¶åº­å¼€å‘ç®¡é“:ä¸€ä¸ªåˆçº§å·¥ç¨‹å¸ˆçš„æ•…äº‹(2/4)</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/nerd-for-tech/home-devops-pipeline-a-junior-engineers-tale-2-4-7be3e3c292c?source=collection_archive---------0-----------------------#2020-02-12">https://medium.com/nerd-for-tech/home-devops-pipeline-a-junior-engineers-tale-2-4-7be3e3c292c?source=collection_archive---------0-----------------------#2020-02-12</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="5c08" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">å†…å®¹:</em> <a class="ae je" rel="noopener" href="/@t3chflicks/home-devops-pipeline-a-junior-engineers-tale-1-4-336ed07a6ec0"> <em class="jd"> 1 </em> </a> <em class="jd">ï¼Œ(</em> <a class="ae je" rel="noopener" href="/@t3chflicks/home-devops-pipeline-a-junior-engineers-tale-2-4-7be3e3c292c"> <em class="jd"> 2 </em> </a> <em class="jd">)ï¼Œ</em> <a class="ae je" rel="noopener" href="/@t3chflicks/home-devops-pipeline-a-junior-engineers-tale-3-4-5f61c5245934"> <em class="jd"> 3 </em> </a> <em class="jd">ï¼Œ</em> <a class="ae je" rel="noopener" href="/@t3chflicks/home-devops-pipeline-a-junior-engineers-tale-4-4-5db7c1610e3e"> <em class="jd"> 4 </em> </a></p><p id="3aa6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">åœ¨è¿™ä¸€ç³»åˆ—æ–‡ç« ä¸­ï¼Œæˆ‘å°†è§£é‡Šæˆ‘æ˜¯å¦‚ä½•ä½¿ç”¨å‡ ä¸ª Raspberry Pis å’Œè®¸å¤šè½¯ä»¶æ„å»ºè‡ªå·±çš„å®¶åº­å¼€å‘ç¯å¢ƒçš„ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†ä»‹ç»ç®¡é“çš„å¼€å‘/ CI éƒ¨åˆ†ï¼Œä» Git å­˜å‚¨åº“å¼€å§‹ã€‚</p><blockquote class="jf"><p id="baeb" class="jg jh hi bd ji jj jk jl jm jn jo jc dx translated"><a class="ae je" href="https://github.com/sk-t3ch/home-repo" rel="noopener ugc nofollow" target="_blank">ğŸ”—åœ¨ Github ä¸Šè·å– Home DevOps ç®¡é“ä»£ç ğŸ“”</a></p></blockquote><h1 id="0158" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">å‰ç‰¹äºš</h1><figure class="ko kp kq kr fd ks er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es kn"><img src="../Images/d52198fd7097b096e9ce9bb801d9398d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JiRexLOf79xRWQXBz62Pog.png"/></div></div></figure><p id="cc5a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Gitea æ˜¯ä¸€ä¸ªå¯ä»¥å®‰è£…åœ¨æœºå™¨ä¸Šçš„ git å­˜å‚¨åº“åº”ç”¨ç¨‹åºã€‚è¿™æ„å‘³ç€ä½œä¸ºæ ‡å‡†ï¼Œå­˜å‚¨åº“çš„å­˜å‚¨æ˜¯åœ¨æœºå™¨æœ¬èº«ä¸Šå®Œæˆçš„ã€‚ç„¶è€Œï¼Œéšç€é”™è¯¯çš„å‘ç”Ÿï¼Œæˆ‘å·²ç»å°†å®ƒå‡çº§åˆ°ä¸€ä¸ªå¤–ç½®ç¡¬ç›˜ï¼Œå¹¶å®šæœŸå¤‡ä»½åˆ° AWS S3ã€‚</p><p id="0ec5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">åœ¨å®¶æ‰˜ç®¡è‡ªå·±çš„å›è´­æœ‰å¾ˆå¤šå¥½å¤„ã€‚å¦‚æœåƒæˆ‘ä¸€æ ·ï¼Œä½ ç»å¸¸ç¼–è¾‘è§†é¢‘æˆ–å¤§é‡çš„å¤§å›¾ç‰‡ï¼Œé‚£ä¹ˆç”¨å»‰ä»·çš„ WiFi ä»äº’è”ç½‘ä¸Šä¸‹è½½ä¸œè¥¿å¾ˆæ…¢(10mb/s)ï¼Œä¸Šä¼ ç®€ç›´æ˜¯æ„šè ¢çš„(500kb/s)ã€‚ç„¶è€Œï¼Œæœ¬åœ°ç½‘ç»œå­˜å‚¨å…è®¸æ›´é«˜çš„ä¼ è¾“é€Ÿåº¦(æœ‰å¾…æµ‹é‡)ã€‚</p><p id="0d17" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ä½ å¯èƒ½è®¤ä¸ºå¤§æ–‡ä»¶å’Œ git æ²¡æœ‰ä»»ä½•æ„ä¹‰ã€‚ä½ å®Œå…¨æ­£ç¡®ã€‚ä»»ä½•æ¶‰åŠå¤§å‹äºŒè¿›åˆ¶æ–‡ä»¶çš„ç¼–è¾‘éƒ½ä¼šå¯¼è‡´ git repo çš„å¤§å°çˆ†ç‚¸ã€‚è¿›å…¥ stage left è§£å†³æ‰€æœ‰ git/å¤§æ–‡ä»¶é—®é¢˜:<a class="ae je" href="https://git-lfs.github.com" rel="noopener ugc nofollow" target="_blank"> Git LFS </a>(å¤§æ–‡ä»¶å­˜å‚¨)â€”â€”ä¸€ä¸ªä»¥åˆç†çš„æ–¹å¼å­˜å‚¨æŒ‡å®šæ–‡ä»¶çš„ Git æ’ä»¶ã€‚</p><p id="3f3a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">â€œGit å¤§æ–‡ä»¶å­˜å‚¨(LFS)å°†éŸ³é¢‘æ ·æœ¬ã€è§†é¢‘ã€æ•°æ®é›†å’Œå›¾å½¢ç­‰å¤§æ–‡ä»¶æ›¿æ¢ä¸º Git å†…éƒ¨çš„æ–‡æœ¬æŒ‡é’ˆï¼ŒåŒæ—¶å°†æ–‡ä»¶å†…å®¹å­˜å‚¨åœ¨ GitHub.com æˆ– GitHub Enterprise ç­‰è¿œç¨‹æœåŠ¡å™¨ä¸Šã€‚â€</em></p><p id="c621" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Git LFS æ„å‘³ç€æˆ‘æ‹¥æœ‰ä½¿ç”¨å¿ƒçˆ±çš„ Git å¤„ç†å¿…è¦çš„å¤§æ–‡ä»¶çš„æ‰€æœ‰å¥½å¤„ï¼Œå¹¶äº«å—æœ¬åœ°ç½‘ç»œçš„é«˜é€Ÿä¼ è¾“ï¼ä¸‡å²ï¼</p><figure class="ko kp kq kr fd ks er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es kz"><img src="../Images/e53f0239013ff02d1d18c94fd4627fe8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7GalwN7QnHbmcq5Q"/></div></div><figcaption class="la lb et er es lc ld bd b be z dx translated">ç”±<a class="ae je" href="https://unsplash.com/@swimstaralex?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">äºšå†å±±å¤§Â·è¾›æ©</a>åœ¨<a class="ae je" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>ä¸Šæ‹æ‘„çš„ç…§ç‰‡</figcaption></figure><p id="555a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æˆ‘å·²ç»ä»‹ç»äº† Gitea çš„ç”¨ä¾‹ï¼Œä½†æ²¡æœ‰å¯¹å®ƒæ˜¯ä»€ä¹ˆå’Œæä¾›äº†ä»€ä¹ˆè¿›è¡Œè¿‡å¤šçš„è§£é‡Šã€‚ä¸ºæ­¤ï¼Œä½ åº”è¯¥çœ‹çœ‹ Gitea å’Œå…¶ä»– Git åº“æä¾›è€…ä¹‹é—´çš„æ¯”è¾ƒã€‚</p><p id="c6f6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">è¦åˆ›å»ºæ‚¨è‡ªå·±çš„ gitea åº”ç”¨ç¨‹åºï¼Œä½¿ç”¨<code class="du le lf lg lh b">docker-compose</code>è¿è¡Œè¿™ä¸ªåŒ…å« gitea å’Œ postgres æ˜ åƒ(ç”Ÿäº§å°±ç»ªæ•°æ®åº“)çš„æ¨¡æ¿:</p><pre class="ko kp kq kr fd li lh lj lk aw ll bi"><span id="3027" class="lm jq hi lh b fi ln lo l lp lq">version: â€œ2â€</span><span id="c3b5" class="lm jq hi lh b fi lr lo l lp lq">networks:<br/>  appnet:<br/>    external: false</span><span id="d68e" class="lm jq hi lh b fi lr lo l lp lq">volumes:<br/>  gitea-app:<br/>  gitea-db:</span><span id="ae41" class="lm jq hi lh b fi lr lo l lp lq">services:</span><span id="65a1" class="lm jq hi lh b fi lr lo l lp lq">gitea-app:<br/>    image: webhippie/gitea<br/>    env_file:<br/>      - gitea.env<br/>    container_name: gitea-app<br/>    restart: always<br/>    networks<br/>      - appnet<br/>    volumes:<br/>      - ./volumes/gitea_data:/data<br/>      - ./custom:/data/gitea<br/>    ports:<br/>      - "222:22"<br/>      - "3000:3000"<br/>     depends_on:<br/>      - gitea-db</span><span id="d1c3" class="lm jq hi lh b fi lr lo l lp lq">gitea-db:<br/>    image: postgres:alpine<br/>    container_name: gitea-db<br/>    ports:<br/>      - 5432:5432<br/>    restart: always<br/>    volumes:<br/>      - ./volumes/gitea_db:/var/lib/postgresql/data<br/>    environment:<br/>      - POSTGRES_USER=gitea<br/>      - POSTGRES_PASSWORD=gitea<br/>      - POSTGRES_DB=gite<br/>    networks:<br/>      - appnet</span></pre><p id="095a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œgitea æœåŠ¡å¼•ç”¨äº†ä¸€ä¸ªæ–‡ä»¶<code class="du le lf lg lh b">gitea.env</code>ã€‚è¿™æ˜¯ gitea çš„é…ç½®æ–‡ä»¶ï¼Œå®ƒå…è®¸æˆ‘ä»¬ä»¥ä¸€ç§ä¸éœ€è¦åœ¨åº”ç”¨ç¨‹åºå†…éƒ¨è¿›è¡Œä»»ä½•è®¾ç½®çš„æ–¹å¼æ¥è®¾ç½®è¿™ä¸ª home repo è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ç›´æ¥ä»å¤‡ä»½ä¸­è¿è¡Œã€‚</p><p id="f9f4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">è¿è¡Œå®Œ<code class="du le lf lg lh b">docker-compose up</code>åï¼Œä½ åº”è¯¥å¯ä»¥åœ¨æœ¬åœ°ç½‘ç»œçš„<code class="du le lf lg lh b">raspberrypi.local:3000</code>ä¸‹è®¿é—®å¹¶ä½¿ç”¨å®ƒã€‚å¿«ä¹çš„æ—¥å­ã€‚</p><figure class="ko kp kq kr fd ks er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es ls"><img src="../Images/5801a9ccb23a47efcbc717838af8ee15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5MOqu-ArI9QekHos"/></div></div><figcaption class="la lb et er es lc ld bd b be z dx translated">ç…§ç‰‡ç”±<a class="ae je" href="https://unsplash.com/@hbtography?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">å“ˆé‡Œæ£®Â·å¸ƒç½—å¾·æœ¬ç‰¹</a>åœ¨<a class="ae je" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>ä¸Šæ‹æ‘„</figcaption></figure><h2 id="b65e" class="lm jq hi bd jr lt lu lv jv lw lx ly jz iq lz ma kd iu mb mc kh iy md me kl mf bi translated">å¤–ç½®ç¡¬ç›˜</h2><p id="22b2" class="pw-post-body-paragraph if ig hi ih b ii mg ik il im mh io ip iq mi is it iu mj iw ix iy mk ja jb jc hb bi translated">gitea å¯åŠ¨å¹¶è¿è¡Œåï¼Œæˆ‘æƒ³æ·»åŠ ä¸€ä¸ªæ¯” Micro SD å¡æ›´å¤§çš„å­˜å‚¨è®¾å¤‡ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬åªéœ€åƒè¿™æ ·å®‰è£…ä¸€ä¸ªç¡¬ç›˜é©±åŠ¨å™¨:</p><pre class="ko kp kq kr fd li lh lj lk aw ll bi"><span id="3c93" class="lm jq hi lh b fi ln lo l lp lq">sudo mount /dev/sda1 /media/hdd</span></pre><p id="5efb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ä¸€æ—¦æŒ‚è½½ï¼Œä½ å¯ä»¥å¼•ç”¨ä½ç½®<code class="du le lf lg lh b">/media/hdd</code>ï¼Œå°±åƒä½ å¼•ç”¨å…¶ä»–æ–‡ä»¶å¤¹ä¸€æ ·ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿå®šæœŸå¤‡ä»½è¯¥é©±åŠ¨å™¨çš„å†…å®¹ã€‚å¾ˆå®¹æ˜“åœ°ï¼Œæœ‰äººåˆ¶ä½œäº†ä¸€ä¸ªç å¤´å·¥äººçš„å½¢è±¡ï¼Œå®ƒå°±æ˜¯ https://github.com/istepanov/docker-backup-to-s3ã€‚ç„¶è€Œï¼Œæ­£å¦‚é¢„æœŸçš„é‚£æ ·ï¼Œè¿™ä¸ªæ˜ åƒä¸é€‚åˆ ARM æ¶æ„ï¼Œæ‰€ä»¥æˆ‘ä½¿ç”¨åŸºäº Pi çš„ Raspbian é‡æ–°æ„å»ºäº†è¿™ä¸ªæ˜ åƒã€‚</p><p id="1862" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å°†æ­¤æ·»åŠ åˆ°æˆ‘ä»¬å½“å‰çš„<code class="du le lf lg lh b">docker-compose.yml</code>ä¸­ï¼Œä¾‹å¦‚:</p><pre class="ko kp kq kr fd li lh lj lk aw ll bi"><span id="ab57" class="lm jq hi lh b fi ln lo l lp lq">services:<br/>  backup:<br/>    image: t3chflicks/backuper<br/>    environment:<br/>      - ACCESS_KEY=<br/>      - SECRET_KEY=<br/>      - S3_PATH=<br/>      - CRON_SCHEDULE=0 12 * * *<br/>    volumes:<br/>      - /media/hd:/data:ro<br/>    container_name: backup<br/>    restart: always</span><span id="2502" class="lm jq hi lh b fi lr lo l lp lq">gitea-app:<br/>    image: webhippie/gitea<br/>    env_file:<br/>      - gitea.env<br/>    container_name: gitea-app<br/>    restart: always<br/>    networks<br/>      - appnet<br/>    volumes:<br/>      - /media/hd/gitea_data:/data<br/>    ports:<br/>      - "222:22"<br/>      - "3000:3000"<br/>    depends_on:<br/>      - gitea-db</span></pre><p id="c42a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">åœ¨ Gitea é…ç½®ä¸­å¯ç”¨ Git LFS åï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ repo ä¸Šå®‰è£… Git æ’ä»¶ï¼Œå°±åƒ<code class="du le lf lg lh b">git lfs install</code>ä¸€æ ·ç®€å•ï¼Œç„¶ååƒè¿™æ ·æ ‡è®°æ–‡ä»¶:<code class="du le lf lg lh b">git lfs track "*.mp4"</code>ã€‚</p><p id="880e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ç°åœ¨ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ git repo æ¥å¤„ç†å¤§å‹åª’ä½“æ–‡ä»¶ï¼Œè¿™å¤ªæ£’äº†ã€‚</p><h2 id="5b99" class="lm jq hi bd jr lt lu lv jv lw lx ly jz iq lz ma kd iu mb mc kh iy md me kl mf bi translated">ç‰¹æ‹‰è²å…‹</h2><p id="a0ec" class="pw-post-body-paragraph if ig hi ih b ii mg ik il im mh io ip iq mi is it iu mj iw ix iy mk ja jb jc hb bi translated">æ‹¥æœ‰ä¸€ä¸ªä¸»å­˜å‚¨åº“æ˜¯å¾ˆæ£’çš„ã€‚ä½†æ˜¯ï¼Œå› ä¸ºæˆ‘ä¸æ˜¯ä¸€ä¸ªå®Œå…¨çš„éšå£«ï¼Œå¹¶ä¸”å¸Œæœ›ä¸å…¶ä»–äººåˆä½œï¼Œæ‰€ä»¥æˆ‘ç»§ç»­å‘æˆ‘çš„å›è´­åè®®æ·»åŠ å¤–éƒ¨è®¿é—®ã€‚æˆ‘ä½¿ç”¨äº†<a class="ae je" href="https://traefik.io/" rel="noopener ugc nofollow" target="_blank"> Traefik </a>ï¼Œåå‘ä»£ç†ä½¿ç”¨æ¥è‡ª<a class="ae je" href="http://letsencrypt.org" rel="noopener ugc nofollow" target="_blank">çš„è¯ä¹¦è¿›è¡Œè‡ªåŠ¨ SSL åŠ å¯†</a>ï¼Œå¹¶ä¸”æˆ‘ä½¿ç”¨äº†æ¥è‡ª<a class="ae je" href="https://www.duckdns.org/" rel="noopener ugc nofollow" target="_blank"> duckdns </a>çš„è‡ªç”±åŸŸã€‚</p><p id="9543" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æˆ‘å‘ç° Traefik æ–‡æ¡£æœ‰ç‚¹ä»¤äººå›°æƒ‘ï¼Œä½†äº‹å®è¯æ˜å®ƒéå¸¸å®¹æ˜“æ·»åŠ åˆ°å½“å‰çš„ docker-compose ä¸­ã€‚</p><pre class="ko kp kq kr fd li lh lj lk aw ll bi"><span id="ec2b" class="lm jq hi lh b fi ln lo l lp lq">version: â€œ2â€<br/>networks:<br/>  appnet:<br/>    external: false<br/>  homereponet:<br/>    external: true</span><span id="33d2" class="lm jq hi lh b fi lr lo l lp lq">volumes:<br/>  gitea-app:<br/>  gitea-db:<br/>  traefik:</span><span id="3985" class="lm jq hi lh b fi lr lo l lp lq">services:<br/>  gitea-app:<br/>    image: webhippie/gitea<br/>    env_file:<br/>      - gitea.env<br/>    container_name: gitea-app<br/>    restart: always<br/>    networks<br/>      - appnet<br/>    volumes:<br/>      - /media/hdd/gitea_data:/data<br/>    ports:<br/>      - "222:22"<br/>      - "3000:3000"<br/>    depends_on:<br/>      - gitea-db<br/>  depends_on:<br/>    - gitea-db<br/>    - traefik<br/>  labels:<br/>    - "traefik.enable=true"<br/>    - traefik.backend=gitea-app<br/>    - traefik.git.frontend.rule=Host:git.&lt;your_domain&gt;<br/>    - traefik.docker.network=homereponet<br/>    - traefik.git.port=3000</span><span id="5713" class="lm jq hi lh b fi lr lo l lp lq">gitea-db:<br/>    image: postgres:alpine<br/>    container_name: gitea-db<br/>    ports:<br/>      - 5432:5432<br/>    restart: always<br/>    volumes:<br/>      - /media/hdd/gitea_db:/var/lib/postgresql/data<br/>    environment:<br/>      - POSTGRES_USER=gitea<br/>      - POSTGRES_PASSWORD=gitea<br/>      - POSTGRES_DB=gitea<br/>    networks:<br/>     - appnet<br/>  <br/>  traefik:<br/>    image: traefik:1.7-alpine<br/>    container_name: â€œtraefikâ€<br/>    ports:<br/>      - â€œ80:80â€<br/>      - â€œ443:443â€<br/>    networks:<br/>      - homereponet<br/>    volumes:<br/>      - /var/run/docker.sock:/var/run/docker.sock<br/>      - ./traefik/traefik.toml:/traefik.toml <br/>      - ./traefik/acme:/etc/traefik/acme<br/>    restart: always</span></pre><p id="260c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">è¿™éœ€è¦ä¸€äº›é¢å¤–çš„æ­¥éª¤æ¥åˆ›å»º acme æ–‡ä»¶å¤¹å’Œç¼–è¾‘æƒé™ï¼Œä»¥åŠæ·»åŠ è¿™ä¸ª traefik.toml æ–‡ä»¶</p><pre class="ko kp kq kr fd li lh lj lk aw ll bi"><span id="6a1d" class="lm jq hi lh b fi ln lo l lp lq">debug = false<br/>logLevel = â€œERRORâ€<br/>defaultEntryPoints = [â€œhttpsâ€,â€httpâ€]</span><span id="b1eb" class="lm jq hi lh b fi lr lo l lp lq">[entryPoints]</span><span id="8f6b" class="lm jq hi lh b fi lr lo l lp lq">[entryPoints.http]<br/>address = â€œ:80â€<br/>[entryPoints.http.redirect]<br/>entryPoint = â€œhttpsâ€<br/>[entryPoints.https]<br/>address = â€œ:443â€<br/>[entryPoints.https.tls]</span><span id="1a22" class="lm jq hi lh b fi lr lo l lp lq">[retry]</span><span id="0244" class="lm jq hi lh b fi lr lo l lp lq">[docker]<br/>endpoint = â€œunix:///var/run/docker.sockâ€<br/>domain = â€œ&lt;your domain&gt;â€<br/>watch = true<br/>exposedByDefault = false</span><span id="c915" class="lm jq hi lh b fi lr lo l lp lq">[acme]<br/>email = â€œ&lt;your email&gt;â€<br/>caServer = â€œhttps://acme-v02.api.letsencrypt.org/directory"<br/>storage = â€œacme.jsonâ€<br/>entryPoint = â€œhttpsâ€<br/>onHostRule = true</span><span id="2ed8" class="lm jq hi lh b fi lr lo l lp lq">[acme.httpChallenge]<br/>entryPoint = â€œhttpâ€</span></pre><p id="5221" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ä½†æ˜¯ç°åœ¨ï¼Œåªè¦æ‚¨æš´éœ²äº†ç«¯å£ 443 å¹¶å°†æµé‡è½¬å‘åˆ°æ‚¨çš„ Piï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿé€šè¿‡æ‚¨çš„ duckdns åœ°å€è®¿é—®æ‚¨çš„ä¸»å­˜å‚¨åº“ï¼Œå¹¶ä¸”å®ƒå°†åœ¨<em class="jd"> https </em>ä¸ŠåŠ å¯†ã€‚å¤ªæ£’äº†ï¼</p><figure class="ko kp kq kr fd ks er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es ml"><img src="../Images/79e4f44b71c90ee5e7ad4095e13590c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TPubvAkPg-kKi150QLzkGg.png"/></div></div><figcaption class="la lb et er es lc ld bd b be z dx translated">æ›¿ä»£èŒ¶ä¸»é¢˜(é»‘æš—æ¨¡å¼)</figcaption></figure><h2 id="6d88" class="lm jq hi bd jr lt lu lv jv lw lx ly jz iq lz ma kd iu mb mc kh iy md me kl mf bi translated">é›„èœ‚</h2><p id="0646" class="pw-post-body-paragraph if ig hi ih b ii mg ik il im mh io ip iq mi is it iu mj iw ix iy mk ja jb jc hb bi translated">æˆ‘ä»¬ç°åœ¨åœ¨ Docker ç¯å¢ƒä¸­æ‹¥æœ‰è‡ªå·±çš„ç§æœ‰ Git å›è´­è®¾ç½®ï¼ŒåŒ…æ‹¬ Postgresã€Git LFSã€å¤–éƒ¨ç¡¬ç›˜å­˜å‚¨å’Œå¤–éƒ¨ SSL åŠ å¯†è®¿é—®ã€‚è¿™å¾ˆå¥½:æˆ‘ä»¬å¯ä»¥æ„‰å¿«åœ°å·¥ä½œåœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸Šï¼ŒçŸ¥é“æˆ‘ä»¬å¯ä»¥è½»æ¾åœ°å¤„ç†å¤§æ–‡ä»¶ï¼Œå¹¶åœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨ gitã€‚</p><p id="b5db" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ç„¶è€Œï¼Œè¿™å¹¶ä¸å®Œå…¨æ˜¯ DevOpsã€‚ä½¿ç”¨ git å¯ä»¥é€šè¿‡æ‹‰è¯·æ±‚ç­‰æ–¹å¼ä¸ºæ‚¨æä¾›ä»£ç çš„æŒç»­é›†æˆã€‚ï¼Œä½†ä¸æä¾›è¿ç»­äº¤ä»˜ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬æœŸå¾…ä¸€æ¬¾åä¸º<a class="ae je" href="https://drone.io/" rel="noopener ugc nofollow" target="_blank">æ— äººæœº</a>çš„è½¯ä»¶ã€‚</p><figure class="ko kp kq kr fd ks er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es mm"><img src="../Images/18ceffd0495d959ba51055a7a77a0758.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hPTZq_bDHmlLIBLr"/></div></div><figcaption class="la lb et er es lc ld bd b be z dx translated">åœ¨<a class="ae je" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>ä¸Šç”±<a class="ae je" href="https://unsplash.com/@imkirk?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Iewek Gnos </a>æ‹æ‘„çš„ç…§ç‰‡</figcaption></figure><p id="6621" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æˆ‘ä»¬å°†ä½¿ç”¨æ— äººæœºæ¥ç®¡ç†æˆ‘ä»¬æ„å»º Docker å®¹å™¨ã€æµ‹è¯•å’Œéƒ¨ç½²åˆ°æœºå™¨çš„ç®¡é“ã€‚</p><p id="2337" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">åƒç›®å‰ä¸ºæ­¢è®¨è®ºçš„æ‰€æœ‰å…¶ä»–æœåŠ¡ä¸€æ ·ï¼ŒDrone åœ¨ DockerHub ä¸Šæœ‰ä¸€ä¸ª<a class="ae je" href="https://hub.docker.com/r/drone/drone" rel="noopener ugc nofollow" target="_blank">å›¾åƒ</a>ã€‚è¦å°†å®ƒæ·»åŠ åˆ°æˆ‘ä»¬å½“å‰çš„è®¾ç½®ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ°æˆ‘ä»¬çš„<em class="jd"> docker-compose </em>æ–‡ä»¶ä¸­:</p><pre class="ko kp kq kr fd li lh lj lk aw ll bi"><span id="5cca" class="lm jq hi lh b fi ln lo l lp lq">services:<br/>  drone:<br/>    image: drone/drone:1-linux-arm<br/>    container_name: drone<br/>    volumes:<br/>      - /media/hdd/drone:/var/lib/drone/<br/>    restart: always<br/>    depends_on:<br/>      - gitea-app<br/>    environment:<br/>      - DRONE_OPEN=true<br/>      - DRONE_GITEA_CLIENT_ID=&lt;gitea_auth_id&gt;<br/>      - DRONE_GITEA_CLIENT_SECRET=&lt;gitea_auth_secret&gt;<br/>      - DRONE_GITEA_SERVER=http://git.&lt;your_domain&gt;<br/>      - DRONE_SERVER_HOST=drone.&lt;your_domain&gt;<br/>      - DRONE_SERVER_PROTO=https<br/>      - DRONE_TLS_AUTOCERT=false<br/>      - DRONE_RPC_SECRET=&lt;drone_runner_secret&gt;<br/>      - DRONE_AGENTS_ENABLED=true<br/>    networks:<br/>      - homereponet<br/>      - appnet<br/>    labels:<br/>      - â€œtraefik.enable=trueâ€<br/>      - traefik.backend=drone<br/>      - traefik.drone.frontend.rule=Host:drone.&lt;your_domain&gt;<br/>      - traefik.drone.port=80<br/>      - traefik.docker.network=homereponet</span><span id="5ee6" class="lm jq hi lh b fi lr lo l lp lq">runner:<br/>    container_name: runner<br/>    image: drone/drone-runner-docker:1<br/>    volumes:<br/>      - /var/run/docker.sock:/var/run/docker.sock<br/>    depends_on:<br/>      - drone<br/>    environment:<br/>      - DRONE_RPC_HOST=drone.&lt;your_domain&gt;<br/>      - DRONE_RPC_PROTO=https<br/>      - DRONE_RPC_SECRET=&lt;drone_runner_secret&gt;<br/>    restart: always<br/>    ports:<br/>      - â€œ3000:3000â€<br/>    networks:<br/>      - appnet<br/>      - homereponet</span></pre><p id="67f5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ç°åœ¨ï¼Œå½“æ‚¨å¯åŠ¨ç³»ç»Ÿå¹¶è®¿é—®<code class="du le lf lg lh b">https://drone.&lt;domain&gt; </code>æ—¶ï¼Œæ‚¨ä¼šåœ¨å°è¯•ç™»å½•æ—¶å¾—åˆ°ä¸€ä¸ªé”™è¯¯ã€‚è¿™æ˜¯å› ä¸ºæ‚¨éœ€è¦è¿è¡Œ Giteaï¼Œé¦–å…ˆåˆ›å»º OAuth åº”ç”¨ç¨‹åºï¼Œç„¶åé‡æ–°æ„å»ºæ‚¨çš„å®¹å™¨ï¼Œå°†<code class="du le lf lg lh b">DRONE_GITEA_CLIENT_SECRET</code>è®¾ç½®ä¸ºæ–°å€¼â€”â€”è¿™é‡Œçš„<a class="ae je" href="https://docs.drone.io/installation/providers/gitea/" rel="noopener ugc nofollow" target="_blank">æè¿°çš„æ˜¯</a>ã€‚</p><p id="2ca9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æ‚¨ç°åœ¨å¯ä»¥ä½¿ç”¨æ‚¨çš„ Gitea å‡­æ®ç™»å½• Droneã€‚æ¥ä¸‹æ¥ï¼Œæ‚¨åº”è¯¥é€šè¿‡ç‚¹å‡»å¤§æŒ‰é’®æ¥åŒæ­¥ Gitea çš„å­˜å‚¨åº“ã€‚ä¸‹ä¸€ä»¶ä½ æƒ³å°è¯•çš„äº‹æƒ…æ˜¯åšä¸€ä¸ªæ„å»ºï¼Œä¸ºæ­¤ä½ åº”è¯¥æ·»åŠ ä¸€ä¸ª<code class="du le lf lg lh b">.drone.yml</code>æ–‡ä»¶åˆ°ä½ çš„ repo ä¸­ï¼Œåœ¨æ¨çš„æ—¶å€™ï¼Œå®ƒåº”è¯¥è§¦å‘ä¸€ä¸ªæ„å»ºã€‚</p><figure class="ko kp kq kr fd ks er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es mn"><img src="../Images/66569efa8540167388e54391516a6a12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-QEZBWRVw9FbsdTsuetzIQ.png"/></div></div></figure><p id="302a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æ¯ä¸€æ­¥éƒ½æ˜¯åœ¨éš”ç¦»çš„ç¯å¢ƒä¸­æ„å»ºï¼Œå¹¶åœ¨æ— äººæœºä¸Šæ‰§è¡Œã€‚æ— äººæœºè¿è¡Œç¨‹åºä¸ºä¸€ç§æ¶æ„æ„å»ºï¼Œå› æ­¤æˆ‘ä»¬å°†åªåœ¨ Pi è¿è¡Œç¨‹åºä¸Šæ„å»º Raspberry Pi (arm v7)æ˜ åƒï¼Œä½†å¯¹äº x86 æ„å»ºï¼Œæˆ‘ä»¬éœ€è¦åœ¨ AWS ä¸Šéƒ¨ç½² EC2(ç¨åå°†è¯¦ç»†ä»‹ç»)ã€‚æˆ‘çš„ç¤ºä¾‹æ— äººæœºæ–‡ä»¶å¦‚ä¸‹æ‰€ç¤º:</p><pre class="ko kp kq kr fd li lh lj lk aw ll bi"><span id="2b62" class="lm jq hi lh b fi ln lo l lp lq">kind: pipeline<br/>name: commitPipeline</span><span id="c21e" class="lm jq hi lh b fi lr lo l lp lq">trigger:<br/>  event:<br/>    - push</span><span id="6377" class="lm jq hi lh b fi lr lo l lp lq">platform:<br/>  os: linux<br/>  arch: arm</span><span id="beef" class="lm jq hi lh b fi lr lo l lp lq">steps:<br/>  - name: buildsomething<br/>    image: python:alpine<br/>    commands:<br/>      - echo â€˜hello worldâ€™</span></pre><p id="2603" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ç§ï¼Œä½ ç°åœ¨æ˜¯ä¸€ä¸ªå®¶åº­å›è´­éª„å‚²çš„ä¸»äººï¼æˆ‘ä»¬ä¼šå¿½ç•¥ä¸€ä¸ªäº‹å®ï¼Œé‚£å°±æ˜¯å®ƒå¾ˆå¯èƒ½ä»ç„¶åšä¸åˆ° Gitlab å¼€ç®±å³ç”¨é‚£ä¹ˆå¤šï¼Œä½†å®ƒæ˜¯ä½ çš„(å‘œï¼Œèµ„æœ¬ä¸»ä¹‰ï¼).</p><h2 id="1606" class="lm jq hi bd jr lt lu lv jv lw lx ly jz iq lz ma kd iu mb mc kh iy md me kl mf bi translated">ç™»è®°å¤„</h2><p id="5f74" class="pw-post-body-paragraph if ig hi ih b ii mg ik il im mh io ip iq mi is it iu mj iw ix iy mk ja jb jc hb bi translated">DockerHub å¾ˆæ£’ï¼Œå°±åƒ Github å¾ˆæ£’ä¸€æ ·ã€‚è¿™æ˜¯å› ä¸ºä»–ä»¬ä¸ºäººä»¬æä¾›äº†ä¸€ä¸ªåˆ†äº«å·¥ä½œçš„åœ°æ–¹ã€‚ç„¶è€Œï¼Œæ­£å¦‚ç§äººå›è´­çš„è®ºç‚¹æ˜¯ä¸æƒ³å…±äº«å’Œå¿«é€Ÿçš„æœ¬åœ°é€Ÿåº¦ï¼Œè¿™åŒæ ·é€‚ç”¨äº Docker æ³¨å†Œä¸­å¿ƒã€‚</p><p id="e2ce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æˆ‘ä»¬å°†åˆ›å»ºè‡ªå·±çš„ç©ºé—´æ¥å­˜å‚¨æˆ‘ä»¬ä½¿ç”¨ Docker è‡ªå·±çš„æ³¨å†Œè¡¨æ˜ åƒåˆ¶ä½œçš„æ˜ åƒã€‚è¦å°†å®ƒæ·»åŠ åˆ°æˆ‘ä»¬ç°æœ‰çš„ Docker-compose æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦æ·»åŠ è¿™ä¸ªé¢å¤–çš„æœåŠ¡:</p><pre class="ko kp kq kr fd li lh lj lk aw ll bi"><span id="001b" class="lm jq hi lh b fi ln lo l lp lq">registry:<br/>  image: registry:2<br/>  container_name: registry<br/>  restart: always<br/>  networks:<br/>    - homerepone<br/>  volumes:<br/>    - ./volumes/registry:/var/lib/registr<br/>    - ./auth:/auth<br/>  labels:<br/>    - â€œtraefik.enable=trueâ€<br/>    - traefik.registry.frontend.rule=Host:registry.&lt;your_domain&gt;<br/>    - traefik.backend=registry<br/>    - traefik.docker.network=homereponet<br/>    - traefik.registry.port=5000<br/>  environment:<br/>    - REGISTRY_STORAGE_FILESYSTEM_ROOTDIRECTORY=/data<br/>    - REGISTRY_AUTH=htpasswd<br/>    - REGISTRY_AUTH_HTPASSWD_REALM=Registry<br/>    - REGISTRY_AUTH_HTPASSWD_PATH=/auth/registry.password</span></pre><p id="926a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">è¿™å¼•ç”¨äº†ä¸€ä¸ªæˆ‘ä»¬ä½¿ç”¨ apache2-utils bcrypt æ•£åˆ—å¯†ç åˆ›å»ºçš„<code class="du le lf lg lh b">auth/registry.password</code>æ–‡ä»¶ï¼Œå°±åƒè¿™é‡Œæè¿°çš„<a class="ae je" href="https://www.digitalocean.com/community/tutorials/how-to-set-up-a-private-docker-registry-on-ubuntu-18-04" rel="noopener ugc nofollow" target="_blank">ä¸€æ ·</a>ã€‚</p><p id="edd7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">è¿è¡Œæˆ‘ä»¬æ–°çš„<code class="du le lf lg lh b">docker-compose.yml</code>æ„å‘³ç€æ‚¨å¯ä»¥ä½¿ç”¨<code class="du le lf lg lh b">docker login <a class="ae je" href="https://registry.homerepo4.duckdns.org" rel="noopener ugc nofollow" target="_blank">https://registry.&lt;</a>your_domain&gt;</code>é€šè¿‡ docker cli ç™»å½•æ¥è®¿é—®æ³¨å†Œè¡¨ã€‚</p></div><div class="ab cl mo mp gp mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="hb hc hd he hf"><p id="c999" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æˆ‘ä»¬å·²ç»è®¨è®ºäº†ç®¡é“çš„å¼€å‘éƒ¨åˆ†ï¼Œåœ¨æœ¬ç³»åˆ—çš„ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºéƒ¨ç½²æ–¹æ³•ã€‚ç‚¹å‡»æŸ¥çœ‹<a class="ae je" rel="noopener" href="/@t3chflicks/home-devops-pipeline-a-junior-engineers-tale-3-4-5f61c5245934">ã€‚</a></p><p id="84d8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">å†…å®¹:</em> <a class="ae je" rel="noopener" href="/@t3chflicks/home-devops-pipeline-a-junior-engineers-tale-1-4-336ed07a6ec0"> <em class="jd"> 1 </em> </a> <em class="jd">ï¼Œ(</em> <a class="ae je" rel="noopener" href="/@t3chflicks/home-devops-pipeline-a-junior-engineers-tale-2-4-7be3e3c292c"> <em class="jd"> 2 </em> </a> <em class="jd">)ï¼Œ</em> <a class="ae je" rel="noopener" href="/@t3chflicks/home-devops-pipeline-a-junior-engineers-tale-3-4-5f61c5245934"> <em class="jd"> 3 </em> </a> <em class="jd">ï¼Œ</em> <a class="ae je" rel="noopener" href="/@t3chflicks/home-devops-pipeline-a-junior-engineers-tale-4-4-5db7c1610e3e"> <em class="jd"> 4 </em> </a></p><blockquote class="jf"><p id="d78a" class="jg jh hi bd ji jj jk jl jm jn jo jc dx translated"><a class="ae je" href="https://github.com/sk-t3ch/home-repo" rel="noopener ugc nofollow" target="_blank">ğŸ”—åœ¨ Github ä¸Šè·å– Home DevOps ç®¡é“ä»£ç ğŸ“”</a></p></blockquote><h1 id="e02b" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">æ„Ÿè°¢é˜…è¯»</h1><p id="83b2" class="pw-post-body-paragraph if ig hi ih b ii mg ik il im mh io ip iq mi is it iu mj iw ix iy mk ja jb jc hb bi translated">æˆ‘å¸Œæœ›ä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ã€‚å¦‚æœä½ å–œæ¬¢è¿™ç§é£æ ¼ï¼Œå¯ä»¥å» T3chFlicks.org çš„<a class="ae je" href="https://t3chflicks.org/Projects/home-devops-pipeline" rel="noopener ugc nofollow" target="_blank"/>çœ‹çœ‹æ›´å¤šä»¥ç§‘æŠ€ä¸ºä¸­å¿ƒçš„æ•™è‚²å†…å®¹(<a class="ae je" href="https://www.youtube.com/channel/UC0eSD-tdiJMI5GQTkMmZ-6w" rel="noopener ugc nofollow" target="_blank"> YouTube </a>ã€<a class="ae je" href="https://www.instagram.com/t3chflicks/" rel="noopener ugc nofollow" target="_blank"> Instagram </a>ã€<a class="ae je" href="https://www.facebook.com/t3chflicks" rel="noopener ugc nofollow" target="_blank">è„¸ä¹¦</a>ã€<a class="ae je" href="https://twitter.com/t3chflicks" rel="noopener ugc nofollow" target="_blank"> Twitter </a>)ã€‚</p></div></div>    
</body>
</html>