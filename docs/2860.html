<html>
<head>
<title>Middleware â€” The heart of express</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ä¸­é—´ä»¶expressçš„å¿ƒè„</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/nerd-for-tech/middleware-the-heart-of-express-671fccd24dc?source=collection_archive---------42-----------------------#2021-05-21">https://medium.com/nerd-for-tech/middleware-the-heart-of-express-671fccd24dc?source=collection_archive---------42-----------------------#2021-05-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/d6ff227548153f0b58ad970e379853dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*sBqRa6W5m4tzzs_a"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">å°¼å¤æ‹‰Â·è²å¥¥æ‹‰ä¸‡è’‚åœ¨<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>ä¸Šçš„ç…§ç‰‡</figcaption></figure><p id="c478" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Expressæ˜¯ä¸€ä¸ªéå¸¸å®¹æ˜“æ‰§è¡Œå’Œå­¦ä¹ çš„æœ€å°æ¡†æ¶ã€‚ä½†æ˜¯æ˜¯ä»€ä¹ˆè®©expresså¦‚æ­¤ç®€å•å´å¦‚æ­¤å¼ºå¤§å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ä¸­é—´ä»¶ã€‚</p></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><h2 id="cba6" class="ka kb hi bd kc kd ke kf kg kh ki kj kk jg kl km kn jk ko kp kq jo kr ks kt ku bi translated">ä½†æ˜¯ä¸­é—´ä»¶åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p id="8449" class="pw-post-body-paragraph iv iw hi ix b iy kv ja jb jc kw je jf jg kx ji jj jk ky jm jn jo kz jq jr js hb bi translated">ä¸­é—´ä»¶æ˜¯ä¸€ç§åŠŸèƒ½ã€‚è¿™æ˜¯ä¸€ä¸ªåœ¨æ”¶åˆ°è¯·æ±‚ä¹‹åã€å“åº”å‘é€ä¹‹å‰æ‰§è¡Œçš„å‡½æ•°ã€‚åœ¨å¤„ç†å®é™…è¯·æ±‚ä¹‹å‰ï¼Œå®ƒé€šå¸¸åŒ…å«é¢å¤–çš„ä¸šåŠ¡é€»è¾‘æˆ–ä»»åŠ¡ï¼Œå¦‚éªŒè¯ç­‰ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªå…³äºä¸­é—´ä»¶çš„ç®€å•ä¾‹å­ã€‚</p><pre class="la lb lc ld fd le lf lg lh aw li bi"><span id="afad" class="ka kb hi lf b fi lj lk l ll lm">const express = require("express");</span><span id="43a9" class="ka kb hi lf b fi ln lk l ll lm">const app = express();</span><span id="0768" class="ka kb hi lf b fi ln lk l ll lm">// using this function as middleware<br/>const toUpper = (req, res, next) =&gt; {</span><span id="c2e1" class="ka kb hi lf b fi ln lk l ll lm">  req.query.name = req.query.name.toUpperCase();</span><span id="bd29" class="ka kb hi lf b fi ln lk l ll lm">  // pass control to next middleware<br/>  next();</span><span id="44bb" class="ka kb hi lf b fi ln lk l ll lm">};</span><span id="2a8b" class="ka kb hi lf b fi ln lk l ll lm">app.get("/", toUpper, (req, res) =&gt; {</span><span id="fb4b" class="ka kb hi lf b fi ln lk l ll lm">  res.send(req.query.name);</span><span id="4aab" class="ka kb hi lf b fi ln lk l ll lm">});</span><span id="7574" class="ka kb hi lf b fi ln lk l ll lm">app.listen(5000, () =&gt; {</span><span id="e24d" class="ka kb hi lf b fi ln lk l ll lm">  console.log("listening on port %s", 5000);</span><span id="c716" class="ka kb hi lf b fi ln lk l ll lm">});</span></pre></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><h2 id="2997" class="ka kb hi bd kc kd ke kf kg kh ki kj kk jg kl km kn jk ko kp kq jo kr ks kt ku bi translated">ä¸‹ä¸€ä¸ªå…³é”®å­—</h2><p id="30e5" class="pw-post-body-paragraph iv iw hi ix b iy kv ja jb jc kw je jf jg kx ji jj jk ky jm jn jo kz jq jr js hb bi translated">åœ¨ä½¿ç”¨å¤šä¸ªä¸­é—´ä»¶åŠŸèƒ½æ—¶ï¼Œæœ‰ä¸€ä¸ªç‰¹æ®Šçš„å…³é”®å­—<em class="lo"> next </em>ä¼šæ´¾ä¸Šç”¨åœºã€‚æ¯å½“ä¸€ä¸ªä¸­é—´ä»¶å®Œæˆäº†å®ƒçš„å·¥ä½œï¼Œæ‚¨å¯ä»¥ä½¿ç”¨<em class="lo"> next() </em>è¯­å¥è°ƒç”¨ä¸‹ä¸€ä¸ªä¸­é—´ä»¶ã€‚å°±åƒä¸Šé¢çš„ä¾‹å­ä¸€æ ·ï¼Œå¦‚æœæ‚¨ä»ä»£ç ä¸­åˆ é™¤äº†<em class="lo"> next() </em>ï¼Œæ§åˆ¶æƒå°†ä¸ä¼šä¼ é€’ç»™ä¸‹ä¸€ä¸ªä¸­é—´ä»¶ï¼Œå®¢æˆ·ç«¯ä¹Ÿä¸ä¼šæ”¶åˆ°ä»»ä½•å“åº”ã€‚å› æ­¤ï¼Œè¯·è®°ä½ï¼Œè¦ä¹ˆä½¿ç”¨<em class="lo"> res </em>å‡½æ•°è¿›è¡Œå“åº”ï¼Œè¦ä¹ˆä½¿ç”¨<em class="lo"> next()ã€‚</em></p></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><h2 id="4299" class="ka kb hi bd kc kd ke kf kg kh ki kj kk jg kl km kn jk ko kp kq jo kr ks kt ku bi translated">ä½†æ˜¯æˆ‘ä¸ºä»€ä¹ˆè¦ç”¨ä¸­é—´ä»¶å‘¢ï¼Ÿ</h2><p id="919b" class="pw-post-body-paragraph iv iw hi ix b iy kv ja jb jc kw je jf jg kx ji jj jk ky jm jn jo kz jq jr js hb bi translated">é—®å¾—å¥½ï¼Œæ‚¨å¯èƒ½ä¼šæƒ³ï¼Œæ‰€æœ‰è¿™äº›éƒ½å¯ä»¥åœ¨å•ä¸ªå‡½æ•°ä¸­ä¸ä½¿ç”¨ä¸­é—´ä»¶å‡½æ•°çš„æƒ…å†µä¸‹å®Œæˆã€‚å—¯ï¼Œè¿™æ˜¯æ­£ç¡®çš„ï¼Œä½†æ˜¯ä½¿ç”¨ä¸­é—´ä»¶ä¿ƒè¿›äº†ä»£ç æ¨¡å—åŒ–ï¼Œå¹¶åœ¨<em class="lo"> err </em>å…³é”®å­—çš„å¸®åŠ©ä¸‹ç®€åŒ–äº†é”™è¯¯å¤„ç†ã€‚ç¨‹åºçš„æµç¨‹ä¹Ÿå˜å¾—éå¸¸å®¹æ˜“ç†è§£ï¼Œè€Œä¸æ˜¯ç†è§£ä¸€å¤§å—ä»£ç ã€‚</p><pre class="la lb lc ld fd le lf lg lh aw li bi"><span id="36b1" class="ka kb hi lf b fi lj lk l ll lm">// this function will throw error if parameter name is not defined</span><span id="b247" class="ka kb hi lf b fi ln lk l ll lm">const toUpper = (req, res, next) =&gt; {</span><span id="d094" class="ka kb hi lf b fi ln lk l ll lm">  req.query.name = req.query.name.toUpperCase();</span><span id="81e7" class="ka kb hi lf b fi ln lk l ll lm">  next();</span><span id="74be" class="ka kb hi lf b fi ln lk l ll lm">};</span><span id="c6cd" class="ka kb hi lf b fi ln lk l ll lm">const addGreeting = (err, req, res, next) =&gt; {</span><span id="0de1" class="ka kb hi lf b fi ln lk l ll lm">  // err catches the error from previous middleware<br/>  if (err) {</span><span id="d393" class="ka kb hi lf b fi ln lk l ll lm">    res.send(err.message);</span><span id="fb62" class="ka kb hi lf b fi ln lk l ll lm">  } else {</span><span id="f5c5" class="ka kb hi lf b fi ln lk l ll lm">    // send a greeting if no errors<br/>    req.query.name = "Hello " + req.query.name;</span><span id="e79d" class="ka kb hi lf b fi ln lk l ll lm">    next();</span><span id="5579" class="ka kb hi lf b fi ln lk l ll lm">  }</span><span id="36d7" class="ka kb hi lf b fi ln lk l ll lm">};</span><span id="94ea" class="ka kb hi lf b fi ln lk l ll lm">// we are passing two middleware functions here<br/>app.get("/", toUpper, addGreeting, (req, res) =&gt; {</span><span id="cc7c" class="ka kb hi lf b fi ln lk l ll lm">  res.send(req.query.name);</span><span id="3226" class="ka kb hi lf b fi ln lk l ll lm">});</span></pre></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><h2 id="ada9" class="ka kb hi bd kc kd ke kf kg kh ki kj kk jg kl km kn jk ko kp kq jo kr ks kt ku bi translated">åº“å‡½æ•°ä½œä¸ºä¸­é—´ä»¶</h2><p id="c997" class="pw-post-body-paragraph iv iw hi ix b iy kv ja jb jc kw je jf jg kx ji jj jk ky jm jn jo kz jq jr js hb bi translated">æœ‰è®¸å¤šåº“æä¾›äº†ç”¨ä½œä¸­é—´ä»¶çš„åŠŸèƒ½ã€‚é€šå¸¸ï¼Œè¿™äº›ç”¨äºåº”ç”¨ç¨‹åºçº§è·¯ç”±ï¼Œå¹¶åœ¨å®é™…ä¸šåŠ¡é€»è¾‘ä¹‹å‰å¯¹è¯·æ±‚æ‰§è¡Œæ“ä½œã€‚åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†æ¥è‡ª<em class="lo"> cors </em>å’Œ<em class="lo"> body-parser </em>åº“çš„å‡½æ•°ä½œä¸ºä¸­é—´ä»¶</p><pre class="la lb lc ld fd le lf lg lh aw li bi"><span id="659b" class="ka kb hi lf b fi lj lk l ll lm">const app = express();</span><span id="02c5" class="ka kb hi lf b fi ln lk l ll lm">// all the requests coming in the server will pass through<br/>// the below middlewares<br/>app.use(</span><span id="9daa" class="ka kb hi lf b fi ln lk l ll lm">  cors({origin: "http://localhost:3000"})</span><span id="93de" class="ka kb hi lf b fi ln lk l ll lm">);<br/>app.use(bodyParser.json());</span><span id="71df" class="ka kb hi lf b fi ln lk l ll lm"><br/>/*<br/>   ****all the other middleares and routes here****<br/>*/</span><span id="3e9f" class="ka kb hi lf b fi ln lk l ll lm"><br/>const port = 5000;</span><span id="043d" class="ka kb hi lf b fi ln lk l ll lm">app.listen(port, () =&gt; {</span><span id="b211" class="ka kb hi lf b fi ln lk l ll lm">  console.log("listening on port %s", port);</span><span id="927f" class="ka kb hi lf b fi ln lk l ll lm">});</span></pre></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><p id="40d2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">è¿™æ˜¯æ‰€æœ‰çš„ä¹¡äº²ã€‚ç•™ä¸‹æŒå£°ğŸ‘å¦‚æœä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ã€‚ä¸‹ä¸€é›†è§ã€‚</p></div></div>    
</body>
</html>