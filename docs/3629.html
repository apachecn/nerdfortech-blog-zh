<html>
<head>
<title>Realtime Polling web application with Python FastApi WebSockets, PyMongo, HTML &amp; JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ä½¿ç”¨ Python FastApi WebSocketsã€PyMongoã€HTML å’Œ JavaScript å®æ—¶è½®è¯¢ web åº”ç”¨ç¨‹åº</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/nerd-for-tech/polling-web-application-with-python-fastapi-websockets-pymongo-html-javascript-832c931eca59?source=collection_archive---------1-----------------------#2021-06-17">https://medium.com/nerd-for-tech/polling-web-application-with-python-fastapi-websockets-pymongo-html-javascript-832c931eca59?source=collection_archive---------1-----------------------#2021-06-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><blockquote class="if ig ih"><p id="13ab" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">è®©æˆ‘ä»¬é€šè¿‡ä½¿ç”¨è¿™äº›<br/> 1 æ¥æ„å»ºä¸€ä¸ªå…¨æ ˆå®æ—¶æŠ•ç¥¨ web åº”ç”¨ç¨‹åºã€‚<strong class="il hj"> Python çš„ FastApi <br/> 2ã€‚Websocketsã€‚<br/> 3ã€‚</strong>T5ã€‘py mango<br/>4ã€‚HTMLï¼ŒCSSï¼ŒJavaScript ã€‚<br/> <strong class="il hj"> 5ã€‚</strong><a class="ae jh" href="https://www.chartjs.org/" rel="noopener ugc nofollow" target="_blank"><strong class="il hj">chart . js</strong></a><strong class="il hj">(</strong>å¯¹äºè½®è¯¢å›¾ï¼Œæˆ‘ä»¬è¦ç”¨<strong class="il hj">)ã€‚</strong></p></blockquote><figure class="jj jk jl jm fd jn er es paragraph-image"><a href="https://www.freepik.com/vectors/background"><div class="er es ji"><img src="../Images/8e8f776169ed239ebbc994d29a3e58ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2-wEuz6-nQ8kJURaGWxHGw.jpeg"/></div></a><figcaption class="jq jr et er es js jt bd b be z dx translated"><a class="ae jh" href="https://www.freepik.com/vectors/background" rel="noopener ugc nofollow" target="_blank">rawpixel.com åˆ›å»ºçš„èƒŒæ™¯å‘é‡</a></figcaption></figure><p id="3e55" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jv iz ja jb jw jd je jf jg hb bi translated">åšæŒä½ï¼éš¾é“æˆ‘åˆšæ‰è¯´çš„æ˜¯<strong class="il hj"> WebSockets </strong>ğŸ¤¨ï¼Ÿ</p><h2 id="ba5c" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ju ki kj kk jv kl km kn jw ko kp kq kr bi translated">ä»¥ä¸‹æ˜¯ WebSockets çš„åŸå› :</h2><p id="3c0b" class="pw-post-body-paragraph ii ij hi il b im ks io ip iq kt is it ju ku iw ix jv kv ja jb jw kw je jf jg hb bi translated">æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Http è°ƒç”¨å°†ç”¨æˆ·çš„æŠ•ç¥¨å‘é€åˆ°æœåŠ¡å™¨ã€‚ä½†æ˜¯å¦‚æœä½ æƒ³å»ºç«‹ä¸€ä¸ªå®æ—¶çš„ç½‘ç»œåº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ WebSocketsã€‚è®©æˆ‘è§£é‡Šæ¸…æ¥š:</p><figure class="jj jk jl jm fd jn er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es kx"><img src="../Images/cf36d3de5437204f90e8d3436d0c5d97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MR93UDmIATqcAqWR8kOSww.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">Http åè®®å·¥ä½œæµ</figcaption></figure><p id="1af3" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jv iz ja jb jw jd je jf jg hb bi translated">å½“æˆ‘ä»¬ä½¿ç”¨ Http åè®®ä½œä¸ºæˆ‘ä»¬çš„æ•°æ®ä¼ è¾“æœºåˆ¶æ—¶ï¼ŒHttp åè®®æ˜¯å•å‘çš„ã€‚è¿™æ„å‘³ç€æœåŠ¡å™¨åªæœ‰åœ¨å®¢æˆ·ç«¯è¯·æ±‚æ—¶æ‰ä¼šå‘é€æ•°æ®&amp;å…³é—­è¿æ¥ã€‚<br/>å³ï¼Œå°†ä¸ºæ¯ä¸ª HTTP è¯·æ±‚åˆ›å»ºä¸€ä¸ªæ–°çš„ TCP è¿æ¥ã€‚</p><h1 id="b6c5" class="lc jy hi bd jz ld le lf kd lg lh li kh lj lk ll kk lm ln lo kn lp lq lr kq ls bi translated">WebSockets</h1><p id="7a15" class="pw-post-body-paragraph ii ij hi il b im ks io ip iq kt is it ju ku iw ix jv kv ja jb jw kw je jf jg hb bi translated"><strong class="il hj"> WebSockets </strong>æ˜¯<strong class="il hj">åŒå‘</strong>è¿æ¥ï¼Œå®ƒåˆ›å»ºä¸€ä¸ªæœ‰çŠ¶æ€åè®®ï¼Œè¿™æ„å‘³ç€å®¢æˆ·ç«¯&amp;æœåŠ¡å™¨ä¹‹é—´çš„è¿æ¥å¯ä»¥ä¿æŒæ´»åŠ¨ã€‚æ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦ä¸ºæ¯ä¸ªæœåŠ¡å™¨è¯·æ±‚åˆ›å»ºä¸€ä¸ªæ–°çš„ TCP è¿æ¥ï¼Œç›¸åæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç›¸åŒçš„è¿æ¥ã€‚</p><figure class="jj jk jl jm fd jn er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es lt"><img src="../Images/e03c849300cae59180dc0b1392560dd3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p4XqxARPFqstoloPlbT7yQ.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">WebSocket åè®®å·¥ä½œæµ</figcaption></figure><blockquote class="if ig ih"><p id="a7a5" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">æˆ‘ä»è¿™ç¯‡ç²¾å½©çš„æ–‡ç« (ä»€ä¹ˆæ˜¯ web socketï¼Œå®ƒä¸ HTTP æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ)ï¼ŒæŸ¥çœ‹æ­¤<a class="ae jh" href="https://www.geeksforgeeks.org/what-is-web-socket-and-how-it-is-different-from-the-http/" rel="noopener ugc nofollow" target="_blank">æ¡</a></p></blockquote><h1 id="61bc" class="lc jy hi bd jz ld le lf kd lg lh li kh lj lk ll kk lm ln lo kn lp lq lr kq ls bi translated">ä½¿ç”¨ FastAPI Websocketsã€Html å’Œ JS è½®è¯¢ç½‘ç«™</h1><p id="9f59" class="pw-post-body-paragraph ii ij hi il b im ks io ip iq kt is it ju ku iw ix jv kv ja jb jw kw je jf jg hb bi translated">æˆ‘ä»¬ç”¨ Python çš„<strong class="il hj"> FastAPI WebSockets &amp; Htmlï¼Œjs(å°¤å…¶æ˜¯ chart.js)æ­å»ºä¸€ä¸ªæŠ«è¨ vs æ±‰å ¡æŠ•ç¥¨ç½‘ç«™ã€‚</strong></p><p id="1560" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jv iz ja jb jw jd je jf jg hb bi translated">è¿™æ˜¯æˆ‘ä»¬è¾“å‡ºçš„å›¾åƒã€‚</p><figure class="jj jk jl jm fd jn er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es lu"><img src="../Images/f71cfdef42af565d0a550a272a04b768.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-t_-LoQLwWBgW4rRRcPbcQ.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">æ¯”è¨ vs æ±‰å ¡å®æ—¶è½®è¯¢åº”ç”¨ç¨‹åºç¤ºä¾‹è¾“å‡º</figcaption></figure><h2 id="26aa" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ju ki kj kk jv kl km kn jw ko kp kq kr bi translated">æˆ‘ä»¬å°†é¦–å…ˆæ„å»ºæˆ‘ä»¬çš„åç«¯</h2><p id="f5aa" class="pw-post-body-paragraph ii ij hi il b im ks io ip iq kt is it ju ku iw ix jv kv ja jb jw kw je jf jg hb bi translated">æ³¨æ„:åœ¨åˆ›å»ºæˆ‘ä»¬çš„é¡¹ç›®ä¹‹å‰ã€‚æˆ‘åªæ˜¯æƒ³è®©ä½ çŸ¥é“ï¼Œåœ¨è¿™ä¸ªé¡¹ç›®ä¸­ï¼Œæˆ‘å°†åªä½¿ç”¨ 3 ä¸ªæ–‡ä»¶ã€‚<br/> 1ã€‚application.py(è¿™é‡Œæˆ‘å†™ websocket apisï¼Œæ˜¯ M <strong class="il hj"> iddleware </strong>)ã€‚<br/> 2ã€‚pizzaVsburger.html(è¿™é‡Œæˆ‘å°†å†™ html ä»£ç ï¼Œæ˜¾ç¤ºå¦‚ä¸Šå›¾çš„æ¡å½¢å›¾ï¼Œå®ƒæ˜¯<strong class="il hj">å‰ç«¯</strong>)ã€‚<br/> 3ã€‚main.js(è¿™é‡Œå°†ç¼–å†™æˆ‘ä»¬çš„ javascript åŠŸèƒ½)ã€‚<br/> 4ã€‚æˆ‘å°†ä½¿ç”¨ MongoDB ä½œä¸ºæˆ‘ä»¬çš„æ•°æ®åº“ï¼Œæ¥å­˜å‚¨æˆ‘ä»¬çš„ç”¨æˆ·æŠ•ç¥¨ã€‚(<strong class="il hj">åç«¯</strong>)</p><p id="1b96" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jv iz ja jb jw jd je jf jg hb bi translated">æˆ‘å°†åå¤ä¿®æ”¹è¿™ä¸‰ä¸ªæ–‡ä»¶ä¸­çš„ä»£ç ã€‚ä½ åœ¨è¿™é‡Œçœ‹åˆ°çš„ä»»ä½•ä»£ç å—ï¼Œå®ƒä»¬åªå±äºè¿™äº›æ–‡ä»¶ã€‚æˆ‘è¿˜ä¼šæåˆ°ä»£ç å—æ‰€å±çš„æ–‡ä»¶åã€‚</p><h2 id="6a2d" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ju ki kj kk jv kl km kn jw ko kp kq kr bi translated">è®¾ç½®é¡¹ç›®çš„è™šæ‹Ÿç¯å¢ƒ</h2><p id="8683" class="pw-post-body-paragraph ii ij hi il b im ks io ip iq kt is it ju ku iw ix jv kv ja jb jw kw je jf jg hb bi translated">è®©æˆ‘ä»¬åˆ›å»ºåä¸º<strong class="il hj"> pizzaVsburger </strong>çš„é¡¹ç›®æ–‡ä»¶å¤¹ã€‚åœ¨è¯¥æ–‡ä»¶å¤¹ä¸­ï¼Œæˆ‘ä»¬å°†è®¾ç½®é¡¹ç›®çš„è™šæ‹Ÿç¯å¢ƒã€‚<br/>æˆ‘å‡è®¾ä½ å·²ç»åœ¨æœ¬åœ°æœºå™¨ä¸Šå®‰è£…äº†<strong class="il hj">python</strong>&amp;<strong class="il hj">virtualenv</strong>ã€‚å¦‚æœæ²¡æœ‰ï¼Œè¯·æŒ‰ç…§æœ¬æŒ‡å—è¿›è¡Œå®‰è£…ã€‚<br/>ç„¶åæˆ‘ä»¬å°†åˆ›å»ºæˆ‘ä»¬çš„<strong class="il hj">åç«¯è™šæ‹Ÿç¯å¢ƒ</strong>ï¼Œå…¶ä¸­å°†å®‰è£…æ‚¨é¡¹ç›®çš„æ‰€æœ‰åç«¯ python ä¾èµ–é¡¹ã€‚<br/>è¿è¡Œè¯¥å‘½ä»¤:</p><pre class="jj jk jl jm fd lv lw lx ly aw lz bi"><span id="bac5" class="jx jy hi lw b fi ma mb l mc md">virtualenv backend</span></pre><p id="0b73" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jv iz ja jb jw jd je jf jg hb bi translated">è¿è¡Œè¯¥å‘½ä»¤åï¼Œå°†åˆ›å»ºåŒ…å« 2 ä¸ªå­æ–‡ä»¶å¤¹(Lib &amp; Scripts)&amp; a . git ignore &amp; pyvenv . CFG æ–‡ä»¶çš„åç«¯æ–‡ä»¶å¤¹</p><p id="8b89" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jv iz ja jb jw jd je jf jg hb bi translated">æˆ‘ä»¬éœ€è¦å®‰è£…ä¸€äº›ä¾èµ–é¡¹ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç¼–å†™æˆ‘ä»¬çš„åç«¯ APIã€‚åœ¨å‘½ä»¤æç¤ºç¬¦ä¸‹è¿è¡Œè¿™äº›å‘½ä»¤ã€‚</p><pre class="jj jk jl jm fd lv lw lx ly aw lz bi"><span id="a0a6" class="jx jy hi lw b fi ma mb l mc md">backend\Scripts\activate<br/>pip install fastapi "uvicorn[standard]" numpy</span></pre><p id="9d7e" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jv iz ja jb jw jd je jf jg hb bi translated"><strong class="il hj"> FastAPI </strong>ç¼–å†™æˆ‘ä»¬çš„åç«¯ API&amp;<strong class="il hj">uvicon</strong>ä¸ºæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºåˆ›å»º ASGI æœåŠ¡å™¨ã€‚</p><h2 id="45b2" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ju ki kj kk jv kl km kn jw ko kp kq kr bi translated">ä½¿ç”¨ FastAPI ç¼–å†™ WebSocket APIs</h2><p id="7bbf" class="pw-post-body-paragraph ii ij hi il b im ks io ip iq kt is it ju ku iw ix jv kv ja jb jw kw je jf jg hb bi translated">æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦åœ¨åç«¯æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ª<strong class="il hj"> application.py </strong>æ–‡ä»¶ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å°†ç¼–å†™æˆ‘ä»¬çš„ WebSocket APIsã€‚</p><p id="1068" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jv iz ja jb jw jd je jf jg hb bi translated">æˆ‘æ­£åœ¨è®¾ç½®ä¸ MongoDB å®¢æˆ·ç«¯çš„è¿æ¥ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å­˜å‚¨ç”¨æˆ·æŠ•ç¥¨å¹¶åˆå§‹åŒ–åº”ç”¨ç¨‹åºã€‚</p><pre class="jj jk jl jm fd lv lw lx ly aw lz bi"><span id="eb05" class="jx jy hi lw b fi ma mb l mc md">from fastapi import <strong class="lw hj">FastAPI</strong><br/>from pymongo import <strong class="lw hj">MongoClient</strong><br/><br/><strong class="lw hj"># App initialization</strong><br/>app = FastAPI()<br/><br/><strong class="lw hj"># Setting up connection with MongoDB</strong><br/><strong class="lw hj">client</strong> = MongoClient("mongodb://localhost:27017/")<br/><strong class="lw hj">database </strong>= client["pizzaVsburger"]<br/><strong class="lw hj"># database's table which stores the user votes.<br/>collection </strong>= database["votes"] </span></pre><blockquote class="if ig ih"><p id="a5f6" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">æˆ‘ä»¬å·²ç»è¿æ¥äº†<strong class="il hj"> MongoDB </strong>ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªé»˜è®¤ç«¯ç‚¹ï¼Œå®ƒè¿”å›æˆ‘ä»¬çš„æŠ•ç¥¨<strong class="il hj"> html é¡µé¢</strong> &amp;æˆ‘å°†å…¶å‘½åä¸º pizzaVsburger.html<strong class="il hj"/>ã€‚</p><p id="98bb" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä»<strong class="il hj"> fastapi.templating </strong>ä¸­å¯¼å…¥å¹¶ä½¿ç”¨<strong class="il hj"> Jinja2Templates </strong>æ¥è¿”å› html æ–‡ä»¶ä½œä¸ºè¾“å‡ºã€‚</p></blockquote><pre class="jj jk jl jm fd lv lw lx ly aw lz bi"><span id="27e5" class="jx jy hi lw b fi ma mb l mc md">from fastapi import FastAPI<strong class="lw hj"><br/></strong>from fastapi.templating import Jinja2Templates<br/>from pymongo import MongoClient<br/><br/><strong class="lw hj"># App initialization</strong><br/>app = FastAPI()<br/><br/><strong class="lw hj"># Setting up connection with MongoDB</strong><br/><strong class="lw hj">client</strong> = MongoClient("mongodb://localhost:27017/")<br/><strong class="lw hj">database </strong>= client["pizzaVsburger"]<br/><strong class="lw hj"># database's table which stores the user votes.<br/>collection </strong>= database["votes"]</span><span id="b960" class="jx jy hi lw b fi me mb l mc md"><strong class="lw hj"># Templates directory, in which our html &amp; javascript files are stored.</strong><br/>templates = Jinja2Templates(directory="templates")<br/>app.mount("/templates", StaticFiles(directory="templates", html=True), name="templates")</span><span id="02e4" class="jx jy hi lw b fi me mb l mc md"><strong class="lw hj"># API which returns HTML file as response.<br/></strong>@app.websocket("/")<br/>async def get(request: Request):<br/><strong class="lw hj">    # Here in list 1 represent pizza's vote &amp; 0 represents burger's.<br/></strong>    votes = [1,0]<br/>    return templates.TemplateResponse("pizzaVsburger.html", {'request': request, 'votes', })</span></pre><p id="efc6" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jv iz ja jb jw jd je jf jg hb bi translated">è®©æˆ‘ä»¬è¿è¡Œä¸Šé¢çš„ä»£ç ï¼Œæ£€æŸ¥ä¸‹é¢çš„å‘½ä»¤ã€‚</p><pre class="jj jk jl jm fd lv lw lx ly aw lz bi"><span id="7f07" class="jx jy hi lw b fi ma mb l mc md">uvicorn application:app --reload</span></pre><p id="8867" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jv iz ja jb jw jd je jf jg hb bi translated">è¿è¡Œä¸Šè¿°ä»£ç åï¼Œapplication.py æ–‡ä»¶åœ¨<strong class="il hj">é»˜è®¤ç«¯å£ 8000 </strong>ä¸Šè¿è¡Œã€‚</p><figure class="jj jk jl jm fd jn er es paragraph-image"><div class="er es mf"><img src="../Images/606f8c105e0e957f52e0bdd75fed9f9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1350/format:webp/1*a7iuC6X3HCjt_EodCBKSkw.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">ä½¿ç”¨ uvicorn åœ¨æœ¬åœ°è¿è¡Œ fastapi</figcaption></figure><p id="c8ed" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jv iz ja jb jw jd je jf jg hb bi translated">ä¸‹é¢æ˜¯ç‚¹å‡»<a class="ae jh" href="http://localhost:8000" rel="noopener ugc nofollow" target="_blank"> http://localhost:8000 </a>åçš„è¾“å‡º</p><figure class="jj jk jl jm fd jn er es paragraph-image"><div class="er es mg"><img src="../Images/e21ad06e101f805de269ba0ddee5d1ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1284/format:webp/1*eyAtA_x8R5jzDEbq4kadow.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">æŠ«è¨ä¸æ±‰å ¡æŠ•ç¥¨åº”ç”¨ç¨‹åºå‡ºé”™</figcaption></figure><p id="f7f3" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jv iz ja jb jw jd je jf jg hb bi translated">å¦‚æœæˆ‘ä»¬åœ¨æ¨¡æ¿ç›®å½•ä¸­æœ‰<strong class="il hj">pizzaVsburger.html</strong>æ–‡ä»¶ï¼Œä¸Šé¢çš„ä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦åˆ›å»º<strong class="il hj">æ¨¡æ¿</strong>æ–‡ä»¶å¤¹åœ¨åå°ç›®å½•ã€pizzaVsburger.htmlã€‘ä¸­æ·»åŠ <strong class="il hj">æ–‡ä»¶</strong>åœ¨é‡Œé¢ã€‚</p><h2 id="d9c8" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ju ki kj kk jv kl km kn jw ko kp kq kr bi translated">è®©æˆ‘ä»¬ä¸ºæŠ•ç¥¨åº”ç”¨ç¨‹åºç¼–å†™ HTML ä»£ç </h2><p id="84b8" class="pw-post-body-paragraph ii ij hi il b im ks io ip iq kt is it ju ku iw ix jv kv ja jb jw kw je jf jg hb bi translated">åˆ›å»º<strong class="il hj">pizzaVsburger.html æ–‡ä»¶åï¼Œ</strong>æ·»åŠ è¿™æ®µä»£ç ã€‚è¿™æ˜¯æˆ‘ä»¬é¡¹ç›®çš„å‰ç«¯éƒ¨åˆ†ã€‚</p><pre class="jj jk jl jm fd lv lw lx ly aw lz bi"><span id="c621" class="jx jy hi lw b fi ma mb l mc md">&lt;html lang="en"&gt;<br/>   &lt;head&gt;<br/>      &lt;title&gt;Pizza Vs Burger&lt;/title&gt;<br/>      &lt;script src="./templates/js/main.js"&gt;&lt;/script&gt;<br/>   &lt;/head&gt;<br/>   &lt;body&gt;<br/>      &lt;div style="width:50%; display: block; margin: 0px auto; text-align: center;"&gt;<br/>         &lt;h1&gt;Legendary Battle&lt;/h1&gt;<br/>      &lt;d<br/>   &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="bed0" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jv iz ja jb jw jd je jf jg hb bi translated">è®©æˆ‘ä»¬åˆ·æ–°é¡µé¢ï¼Œç„¶åæˆ‘ä»¬å¾—åˆ°è¿™ä¸ª</p><figure class="jj jk jl jm fd jn er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es mh"><img src="../Images/f061c10bf82e37ed1b6857e2c5d32015.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*30wcSUsFrYjw82kWM-B5kg.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">æ¯”è¨ vs æ±‰å ¡æŠ•ç¥¨ web åº”ç”¨ç¨‹åºçš„åŸºæœ¬ Html é¡µé¢ã€‚</figcaption></figure><p id="43c4" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jv iz ja jb jw jd je jf jg hb bi translated">å®é™…å·¥ä½œå¼€å§‹äº†ã€‚æˆ‘ä»¬å·²ç»å‡†å¤‡å¥½äº† websocket &amp; html é¡µé¢ï¼Œå‰©ä¸‹çš„å·¥ä½œæ˜¯ä¸€ä¸ªæ¡å½¢å›¾ï¼Œå®ƒæ˜¾ç¤ºäº†æŠ•ç¥¨&amp;ä¸€ä¸ªåœ¨ MongDB ä¸­å­˜å‚¨æ•°æ®(ç”¨æˆ·æŠ•ç¥¨)çš„ç«¯ç‚¹ã€‚</p><h2 id="ea33" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ju ki kj kk jv kl km kn jw ko kp kq kr bi translated">è®©æˆ‘ä»¬ç¼–å†™ä¸€ä¸ª APIï¼Œå®ƒå°†æŠ•ç¥¨å­˜å‚¨åœ¨ MongoDB çš„æŠ•ç¥¨è¡¨ä¸­ã€‚å°†è¿™äº›å†…å®¹æ·»åŠ åˆ° application.py æ–‡ä»¶ä¸­</h2><pre class="jj jk jl jm fd lv lw lx ly aw lz bi"><span id="3767" class="jx jy hi lw b fi ma mb l mc md">@app.websocket("/sendVote")<br/>async def user_vote(websocket: WebSocket):<br/>    <strong class="lw hj"><em class="ik">"""<br/>    This is a websocket method, which responds to the call /sendVote.<br/>    Client will use this websocket api as a medium to send their votes.<br/>    """</em></strong><em class="ik"><br/>    </em>await websocket.accept()<br/>    try:<br/>        while True:<br/>            data = await websocket.receive()<br/>            if data['type'] != 'websocket.disconnect':<br/>                vote = {<br/>                    'pizza': 1,<br/>                    'burger': 0<br/>                } if data['text'] == 'pizza' else {<br/>                    'pizza': 0,<br/>                    'burger': 1<br/>                }<br/>                add_vote(vote)<br/>            <br/>            await websocket.send_json(data)<br/>    except Exception as ex:<br/>        return ex</span><span id="7874" class="jx jy hi lw b fi me mb l mc md">def add_vote(vote):<br/>    <strong class="lw hj"><em class="ik">"""<br/>    This method stores the user votes in 'votes' table of pizzaVsburger database in MongoDB<br/>    """</em></strong><em class="ik"><br/>    </em>collection.insert_one(vote)</span></pre><p id="c36d" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jv iz ja jb jw jd je jf jg hb bi translated">ä»ä¸Šé¢çš„ä»£ç ä¸­ï¼Œå½“æˆ‘ä»¬ç‚¹å‡»ä¸Šé¢çš„ç«¯ç‚¹â€œ/sendVoteâ€æ—¶ï¼Œæˆ‘ä»¬ä» javascript ä¸­å‘é€â€œpizzaâ€æˆ–â€œburgerâ€ä½œä¸º<strong class="il hj">æ•°æ®[â€˜textâ€™]çš„</strong>å€¼ã€‚<br/>æˆ‘ä»¬åœ¨<strong class="il hj"> main.js </strong>ä¸­çš„ javascript ä»£ç ã€‚</p><pre class="jj jk jl jm fd lv lw lx ly aw lz bi"><span id="e3ab" class="jx jy hi lw b fi ma mb l mc md">var ws = new WebSocket("ws://localhost:8000/sendVote");</span><span id="46e0" class="jx jy hi lw b fi me mb l mc md">/**<br/>Function will be called on clicking vote button from pizzaVsburger.html<br/>*/<br/>function myVote(voteTo) {<br/>    var vote = voteTo === 'pizza' ? 0 : 1;<br/>    pollingChart.data.datasets[0].data[vote] += 1;<br/>    pollingChart.update();<br/>    sendMessage(voteTo);<br/>}<br/><br/>/**<br/>Function will send the vote to server by using websocket.<br/>*/<br/>function sendMessage(votedTo) {<br/>    ws.send(votedTo);<br/>    event.preventDefault();<br/>}</span></pre><p id="3280" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jv iz ja jb jw jd je jf jg hb bi translated">æˆ‘ä»¬é€šè¿‡å•å‡»æŒ‰é’®ä» html é¡µé¢è°ƒç”¨ myVote('string ')æ–¹æ³•ã€‚</p><pre class="jj jk jl jm fd lv lw lx ly aw lz bi"><span id="1438" class="jx jy hi lw b fi ma mb l mc md">&lt;html lang="en"&gt;<br/>   &lt;head&gt;<br/>      &lt;title&gt;Pizza Vs Burger&lt;/title&gt;<br/>      &lt;script src="./templates/js/main.js"&gt;&lt;/script&gt;<br/>   &lt;/head&gt;<br/>   &lt;body&gt;<br/>      &lt;div style="width:50%; display: block; margin: 0px auto; text-align: center;"&gt;<br/>         &lt;h1&gt;Legendary Battle&lt;/h1&gt;<br/>         &lt;br&gt;<br/>         &lt;button onclick="myVote('pizza')"&gt;Pizza&lt;/button&gt;<br/>         &lt;button onclick="myVote('burger')"&gt;Burger&lt;/button&gt;<br/>      &lt;div&gt;<br/>   &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="b890" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jv iz ja jb jw jd je jf jg hb bi translated">è¾“å‡º:</p><figure class="jj jk jl jm fd jn er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es mi"><img src="../Images/cc1950bbe8588a927c95952d21485953.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yfmgZ5Ia81cbBs21EKgmVg.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">å·¥ä½œæ¯”è¨ vs æ±‰å ¡ web åº”ç”¨ç¨‹åºï¼Œå…¶ä¸­æ²¡æœ‰å›¾è¡¨</figcaption></figure><p id="3b32" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jv iz ja jb jw jd je jf jg hb bi translated">å¦‚æœæˆ‘ç‚¹å‡»<strong class="il hj"> Pizza </strong>æŒ‰é’®ï¼Œå®ƒå°†è°ƒç”¨ main.js æ–‡ä»¶ä¸­çš„ my vote(â€˜Pizzaâ€™)ã€‚ç„¶å myVote æ–¹æ³•è¦è°ƒç”¨ sendMessage(vote)æ–¹æ³•ï¼Œå®é™…ä¸Šæ˜¯ç”¨æ•°æ®['text']æ‰“ websocket çš„ api " <strong class="il hj"> /sendVote </strong>"ä½œä¸º' pizza 'ã€‚<br/>ç„¶ååœ¨æœåŠ¡å™¨ä¸­ï¼ŒsendVote api è¦æ·»åŠ â€œæŠ«è¨æ ä¸­çš„ 1â€&amp;â€œæ±‰å ¡æ ä¸­çš„ 0â€ã€‚</p><p id="0860" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jv iz ja jb jw jd je jf jg hb bi translated">æˆ‘æ­£åœ¨ä½¿ç”¨<a class="ae jh" href="https://www.mongodb.com/cloud/atlas/lp/try2?utm_source=google&amp;utm_campaign=gs_footprint_row_search_brand_phrase_intent_test_atlas_desktop&amp;utm_term=mongodb&amp;utm_medium=cpc_paid_search&amp;utm_ad=p&amp;utm_ad_campaign_id=11295578158&amp;gclid=CjwKCAjw_JuGBhBkEiwA1xmbRUnChPOdeSEEPxVbCh-3mnuWBuWff5FiVHkQ8rYhKtW3P4F_VTbf0BoCczkQAvD_BwE" rel="noopener ugc nofollow" target="_blank"><strong class="il hj">MongoDB Compass</strong></a>ï¼Œåœ¨æˆ‘ä»¬çš„æ•°æ®åº“ä¸­æŸ¥çœ‹æˆ‘çš„æŠ•ç¥¨ã€‚</p><figure class="jj jk jl jm fd jn er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es mj"><img src="../Images/15012fbc495dcc52a44dfaa5db18f51c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZwwghMDvagPG6uEcRJAQIQ.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">æ˜¾ç¤º pizzaVsburger æ•°æ®åº“çš„ MongoDB æŒ‡å—é’ˆ</figcaption></figure><figure class="jj jk jl jm fd jn er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es mk"><img src="../Images/18b96541ff23cb0cf4025a15c0b727fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DbCdXAulJ6nOB_wBYp-GUQ.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">é€‰ç¥¨é›†åˆå­˜å‚¨åœ¨ MongoDB çš„ pizzaVsburger æ•°æ®åº“ä¸­</figcaption></figure><p id="6d93" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jv iz ja jb jw jd je jf jg hb bi translated">æ‰€ä»¥ï¼Œæˆ‘åœ¨æˆ‘ä»¬çš„ html é¡µé¢ä¸­éšæœºç‚¹å‡»äº†æŠ«è¨å’Œæ±‰å ¡æŒ‰é’®ï¼Œæˆ‘å°†è¿™äº›æŠ•ç¥¨å­˜å‚¨åœ¨æˆ‘ä»¬çš„ MongoDB ä¸­</p><figure class="jj jk jl jm fd jn er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es ml"><img src="../Images/6b5536f8b23b38bcf7b9fbaf6beeaaaa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OBJ_0YyzFh8va_Awh52UEw.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">å­˜å‚¨åœ¨æŠ•ç¥¨é›†åˆ(MongoDB)ä¸­çš„ç”¨æˆ·æŠ•ç¥¨</figcaption></figure><p id="a447" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jv iz ja jb jw jd je jf jg hb bi translated">é…·ï¼Œå·¥ä½œæ­£å¸¸ï¼ï¼ğŸ˜</p><h2 id="524d" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ju ki kj kk jv kl km kn jw ko kp kq kr bi translated">è®©æˆ‘ä»¬ä½¿ç”¨ Chart.js åœ¨ html é¡µé¢ä¸­åˆ›å»ºä¸€ä¸ªæ¡å½¢å›¾</h2><p id="b307" class="pw-post-body-paragraph ii ij hi il b im ks io ip iq kt is it ju ku iw ix jv kv ja jb jw kw je jf jg hb bi translated">æˆ‘ä»¬åœ¨å‰ç«¯æœ‰æŠ•ç¥¨æŒ‰é’®ï¼ŒAPI ä½œä¸ºä¸­é—´ä»¶ï¼ŒMongoDB ä½œä¸ºåç«¯ã€‚ç°åœ¨æˆ‘ä»¬éœ€è¦åœ¨ pizzaVsburger.html é¡µé¢ä¸­å¯è§†åŒ–æŠ•ç¥¨ã€‚</p><p id="44de" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jv iz ja jb jw jd je jf jg hb bi translated">æˆ‘ç”¨çš„æ˜¯<a class="ae jh" href="https://www.chartjs.org/" rel="noopener ugc nofollow" target="_blank"> chart.js(æ˜¯å¼€æºçš„ HTML5 charts lib) </a>ã€‚Chart.js æ˜¯ä¸€ä¸ªå¾ˆæ£’çš„ javascript åº“ï¼Œå®ƒä¸ºç½‘ç«™æä¾›äº†ç®€å•ã€çµæ´»çš„ javascript å›¾è¡¨ã€‚</p><p id="a5f8" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jv iz ja jb jw jd je jf jg hb bi translated">é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åœ¨æˆ‘ä»¬çš„<strong class="il hj">pizzaVsburger.html æ–‡ä»¶</strong>ä¸­æ·»åŠ è¿™äº›è¡Œã€‚</p><pre class="jj jk jl jm fd lv lw lx ly aw lz bi"><span id="c1ef" class="jx jy hi lw b fi ma mb l mc md">&lt;html lang="en"&gt;<br/>   &lt;head&gt;<br/>      &lt;title&gt;Pizza Vs Burger&lt;/title&gt;<br/>      &lt;link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"&gt;<br/>      &lt;style&gt;<br/>         .btn-primary {<br/>            margin: 6px;<br/>            background: #fff;<br/>            color: #000;<br/>            border: 1px solid black;<br/>         }<br/>      &lt;/style&gt;<br/>      &lt;script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.bundle.min.js"&gt;&lt;/script&gt;<br/>      &lt;script src="https://cdn.jsdelivr.net/gh/emn178/chartjs-plugin-labels/src/chartjs-plugin-labels.js"&gt;&lt;/script&gt;<br/>      &lt;script src="./templates/js/main.js"&gt;&lt;/script&gt;<br/>   &lt;/head&gt;<br/>   &lt;body translate="no"&gt;<br/>      &lt;div style="width:50%; display: block; margin: 0px auto; text-align: center;"&gt;<br/>         &lt;h1&gt;Legendary Battle&lt;/h1&gt;<br/>         &lt;br&gt;<br/>         &lt;canvas id="mycanvas"&gt;&lt;/canvas&gt;<br/>         &lt;div class="row"&gt;<br/>         &lt;button class="btn btn-primary col" onclick="myVote('pizza')"&gt;<br/>            Vote Pizza<br/>         &lt;/button&gt;<br/>         &lt;button class="btn btn-primary col" onclick="myVote('burger')"&gt;Vote Burger&lt;/button&gt;<br/>         &lt;/div&gt;<br/>      &lt;/div&gt;<br/>      &lt;script&gt;<br/>         setUpChart({{ votes }})<br/>      &lt;/script&gt;<br/>   &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="ae84" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jv iz ja jb jw jd je jf jg hb bi translated">åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä½¿ç”¨äº† chart.js æä¾›çš„ bootstrap å’Œå‡ ä¸ª javascript æ–‡ä»¶ã€‚<br/>æˆ‘ä»¬éœ€è¦ä» application.py çš„é»˜è®¤ get æ–¹æ³•å‘é€{ { votes } },&amp;æ˜¾ç¤ºæˆ‘ä»¬æŠ•ç¥¨çš„æ¡å½¢å›¾ï¼Œ<strong class="il hj">ä¿®æ”¹</strong> <strong class="il hj"> main.js </strong>æ–‡ä»¶å¦‚ä¸‹ã€‚</p><pre class="jj jk jl jm fd lv lw lx ly aw lz bi"><span id="9b52" class="jx jy hi lw b fi ma mb l mc md">pollingChart;<br/><br/>function setUpChart(dataVotes) {<br/>var ctx_live = document.getElementById("mycanvas");<br/>         var myChart = new Chart(ctx_live, {<br/>         type: 'bar',<br/>           data: {<br/>             labels: ['Pizza', 'Burger'],<br/>             datasets: [{<br/>               label: 'Pizza Vs Burger',<br/>               data: <strong class="lw hj">dataVotes</strong>,<br/>               fill: false,<br/>               backgroundColor: ['#00eefa','#37dbff'],<br/>               borderColor: '#000',<br/>               borderWidth: 1<br/>             }]<br/>           },<br/>           options: {<br/>             plugins: {<br/>               labels: {<br/>                 render: 'image',<br/>                 textMargin: -130,<br/>                 images: [<br/>                   {<br/>                     src: 'https://image.freepik.com/free-vector/cute-pizza-cartoon-vector-icon-illustration-fast-food-icon-concept-flat-cartoon-style_138676-2588.jpg',<br/>                     width: 120,<br/>                     height: 120<br/>                   },<br/>                   {<br/>                     src: 'https://image.freepik.com/free-vector/cute-burger-holding-knife-fork-cartoon-fast-food-icon-concept-isolated-flat-cartoon-style_138676-2204.jpg',<br/>                     width: 120,<br/>                     height: 120<br/>                   }<br/>                 ]<br/>               }<br/>             },<br/>             scales: {<br/>               yAxes: [{<br/>                 ticks: {<br/>                   beginAtZero: true<br/>                 }<br/>               }]<br/>             }<br/>           }<br/>         });<br/><br/>pollingChart = myChart;<br/>}</span></pre><p id="6dd5" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jv iz ja jb jw jd je jf jg hb bi translated">ä»ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬æ­£åœ¨è®¾ç½®æˆ‘ä»¬çš„æ¡å½¢å›¾&amp;ä»<strong class="il hj"/><a class="ae jh" href="https://freepik.com" rel="noopener ugc nofollow" target="_blank"><strong class="il hj">ã€freepik.comã€‘</strong></a><strong class="il hj">(ä½ å¯ä»¥ä»è¿™ä¸ªç½‘ç«™è·å¾—å…è´¹çš„&amp;é«˜çº§å›¾ç‰‡)åœ¨æˆ‘ä»¬çš„æ¡å½¢å›¾ä¸Šæ·»åŠ å›¾ç‰‡ã€‚<br/> </strong> <br/>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œå‡½æ•°<strong class="il hj"> setUpChart(dataVotes) </strong>å°†æŠŠ dataVotes ä½œä¸ºè¾“å…¥ã€‚è¿™é‡Œçš„ dataVotes å€¼å°†æ˜¯ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªå€¼çš„æ•°ç»„ã€‚<br/> <strong class="il hj"> dataVotes =ã€æŠ«è¨æŠ•ç¥¨æ•°ï¼Œæ±‰å ¡æŠ•ç¥¨æ•°ã€‘ã€‚<br/> </strong> &amp;æˆ‘ä»¬ä» websocket api ä¸­æ£€ç´¢å®ƒä»¬ã€‚è®©æˆ‘ä»¬åœ¨æˆ‘ä»¬çš„<strong class="il hj">åº”ç”¨ç¨‹åºä¸­æ·»åŠ è¿™äº›è¡Œ</strong></p><pre class="jj jk jl jm fd lv lw lx ly aw lz bi"><span id="82d2" class="jx jy hi lw b fi ma mb l mc md">def get_votes():<br/>  <strong class="lw hj">  <em class="ik">"""<br/>    Method returns all the votes from 'votes' table of pizzaVsburger database in MongoDB<br/>    """</em></strong><em class="ik"><br/>    </em>x = [vote for vote in collection.find()]<br/>    return x</span></pre><p id="b663" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jv iz ja jb jw jd je jf jg hb bi translated">&amp;æˆ‘ä»¬å°† user_vote æ–¹æ³•&amp; default get æ–¹æ³•ä¿®æ”¹ä¸º</p><pre class="jj jk jl jm fd lv lw lx ly aw lz bi"><span id="a993" class="jx jy hi lw b fi ma mb l mc md">@app.get("/")<br/>async def get(request: Request):<br/>    <strong class="lw hj"><em class="ik">"""<br/>    GET method to return html page, when user hit's the endpoint '/'.<br/>    This method first gets all the votes from the votes table from Mongo Database<br/>    &amp; counts the votes for Pizza &amp; Burger &amp; return html file the votes in a single list.<br/>    output format: votes = [(pizza votes),(burger votes)]<br/>    """</em></strong><em class="ik"><br/>    </em>votes = [[x['pizza'], x['burger']] for i, x in enumerate(get_votes())]</span><span id="c9cf" class="jx jy hi lw b fi me mb l mc md">    user_votes = np.array(votes)<br/>    response = np.sum(user_votes, 0)<br/>    votes = list(response)</span><span id="ac43" class="jx jy hi lw b fi me mb l mc md">    return templates.TemplateResponse("pizzaVsburger.html", {'request': request, 'votes': votes})</span><span id="f5a6" class="jx jy hi lw b fi me mb l mc md">"""-------------------------------------------------------------"""</span><span id="eca0" class="jx jy hi lw b fi me mb l mc md">@app.websocket("/sendVote")<br/>async def user_vote(websocket: WebSocket):<br/>    <strong class="lw hj"><em class="ik">"""<br/>    This is a websocket method, which responds to the call /sendVote.<br/>    Client will use this websocket api as a medium to send their votes.<br/>    """</em></strong><em class="ik"><br/>    </em>await websocket.accept()<br/>    try:<br/>        while True:<br/>            data = await websocket.receive()<br/>            if data['type'] != 'websocket.disconnect':<br/>                vote = {<br/>                    'pizza': 1,<br/>                    'burger': 0<br/>                } if data['text'] == 'pizza' else {<br/>                    'pizza': 0,<br/>                    'burger': 1<br/>                }<br/>                add_vote(vote)<br/>            else:<br/>                data = get_votes()<br/>            await websocket.send_json(data)<br/>    except Exception as ex:<br/>        return ex</span></pre><h2 id="1d4f" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ju ki kj kk jv kl km kn jw ko kp kq kr bi translated">æœ€åï¼Œè¿™æ˜¯è¾“å‡º</h2><figure class="jj jk jl jm fd jn er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es mm"><img src="../Images/7ed8fc36c61c3042fbffcd9ac93ee8b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*noW6nx5YrTjwlajvUGDwqg.gif"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">æ¯”è¨ä¸æ±‰å ¡çš„æœ€ç»ˆè¾“å‡º gif å›¾åƒ</figcaption></figure><p id="7a5f" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jv iz ja jb jw jd je jf jg hb bi translated">æ­¤å¤„æ˜¯è¯¥é¡¹ç›®çš„ Github å›è´­é“¾æ¥<a class="ae jh" href="https://github.com/vinaynvd/pizzaVsburger" rel="noopener ugc nofollow" target="_blank">ğŸ˜€</a>ã€‚</p><h2 id="49e7" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ju ki kj kk jv kl km kn jw ko kp kq kr bi translated">ç»“è®º:</h2><p id="b246" class="pw-post-body-paragraph ii ij hi il b im ks io ip iq kt is it ju ku iw ix jv kv ja jb jw kw je jf jg hb bi translated">æˆ‘ä»¬å»ºç«‹äº†å¯æ€•çš„å®æ—¶æ¯”è¨é¥¼å¯¹æ±‰å ¡æŠ•ç¥¨ç½‘ç«™ã€‚æ‚¨å¯ä»¥ç”¨è¿™ç§æ–¹å¼æ„å»ºå‡ºè‰²çš„å®æ—¶ web åº”ç”¨ç¨‹åºã€‚æå‡ºä½ é…·çš„å®æ—¶ç½‘ç»œåº”ç”¨çš„æƒ³æ³•ï¼Œå¹¶åœ¨è¿™é‡Œå‘è¡¨è¯„è®ºã€‚</p><p id="35b1" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jv iz ja jb jw jd je jf jg hb bi translated">å¦‚æœä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œæƒ³è¡¨è¾¾ä¸€äº›çˆ±å’Œæ”¯æŒï¼Œè¯·ç»™æˆ‘ä¹°ä¸€æ¯â˜•å’–å•¡ğŸ˜€</p><figure class="jj jk jl jm fd jn er es paragraph-image"><a href="https://www.buymeacoffee.com/vinaynvd"><div class="er es mn"><img src="../Images/d56406ef45ed1b62a42b5e1c12718758.png" data-original-src="https://miro.medium.com/v2/resize:fit:340/format:webp/0*BKfsxBMXLRY5i-Zc.png"/></div></a><figcaption class="jq jr et er es js jt bd b be z dx translated"><a class="ae jh" href="https://www.buymeacoffee.com/vinaynvd" rel="noopener ugc nofollow" target="_blank">https://www.buymeacoffee.com/vinaynvd</a></figcaption></figure></div></div>    
</body>
</html>