# Python ä¸­çš„å¤šé‡å¤„ç†

> åŸæ–‡ï¼š<https://medium.com/nerd-for-tech/multiprocessing-in-python-ef567a35189a?source=collection_archive---------12----------------------->

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†åˆ†äº«æˆ‘æ˜¯å¦‚ä½•åœ¨ Python è„šæœ¬ä¸­ä½¿ç”¨å¤šé‡å¤„ç†çš„ã€‚åœ¨æ—©æœŸï¼Œå½“æˆ‘çŸ¥é“å¤šå¤„ç†çš„æ¦‚å¿µï¼Œä½†ä¸çŸ¥é“å¦‚ä½•ç¡®åˆ‡åœ°ä½¿ç”¨å®ƒæ¥ä½¿ Python è„šæœ¬è¿è¡Œå¾—æ›´å¿«æ—¶ï¼Œæˆ‘æŒ£æ‰äº†å¾ˆä¹…ã€‚

![](img/68f8ba77945aa44f97c677b3128dbdb5.png)

çº¿æ€§è¿è¡Œ python è„šæœ¬ä¸­çš„æ–¹æ³•æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œäº‹å®ä¸Šï¼Œè¿™è¦ç®€å•å¾—å¤šâ€¦ç¼–å†™æ–¹æ³•æ¥å®Œæˆç‰¹å®šçš„ä»»åŠ¡ï¼Œé€ä¸ªè°ƒç”¨å®ƒä»¬å¹¶ä»æ¯ä¸ªæ–¹æ³•ä¸­æ”¶é›†æ•°æ®ï¼Œå°±å¤§åŠŸå‘Šæˆäº†ã€‚ä½†åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™æ˜¯ä¸€ç§è€—æ—¶çš„æ–¹æ³•ã€‚

> å¤šé‡å¤„ç†æ¥äº†â€¦

å½“æˆ‘å¼€å§‹ä½¿ç”¨å¤šé‡å¤„ç†ç¼–å†™è„šæœ¬æ—¶ï¼Œæˆ‘ä¸å¾—ä¸å¤„ç†ä¸€äº›äº‹æƒ…ã€‚è®©æˆ‘ä»¬å…ˆæŠŠå®ƒä»¬è®°ä¸‹æ¥ã€‚
1ã€‚å°†è„šæœ¬æ‹†åˆ†æˆå¯ä»¥å¹¶è¡Œè¿è¡Œçš„ä»»åŠ¡ã€‚
2ã€‚æ­£ç¡®åœ°æ‰§è¡Œè¿™äº›æ–¹æ³•ï¼Œå¹¶å°†å®ƒä»¬ä¸ä¸»æµç¨‹ç»“åˆèµ·æ¥ã€‚
3ã€‚ç®¡ç†è¿›ç¨‹é—´çš„å…±äº«æ•°æ®(åˆ—è¡¨ã€é˜Ÿåˆ—ã€è¿”å›å€¼)ã€‚
4ã€‚ç®¡ç†ä¸åŒè¿›ç¨‹çš„æ—¥å¿—è®°å½•ã€‚

![](img/e844493ec5ebd6f376ee3763aa07c258.png)

æ˜¯çš„ï¼Œä¸€å¼€å§‹è¿™è®©æˆ‘å¾ˆå›°æƒ‘ã€‚ä½†æ˜¯åœ¨æˆ‘çš„å¯¼å¸ˆçš„å¸®åŠ©ä¸‹ï¼Œå¾ˆæ˜æ˜¾ï¼Œæ˜¯ StackOverflowğŸ˜›æˆ‘æƒ³åˆ°äº†ä¸€ä¸ªè§£å†³åŠæ³•ã€‚æ‰€ä»¥æˆ‘ä»¬æ¥æ¢ç´¢ä¸€ä¸‹ã€‚

# **1ã€‚å°†è„šæœ¬æ‹†åˆ†æˆå¯ä»¥å¹¶è¡Œè¿è¡Œçš„ä»»åŠ¡ã€‚**

è¿™æ˜¯æœ€æ£˜æ‰‹çš„éƒ¨åˆ†ï¼Œå› ä¸ºä¸€å¼€å§‹ï¼Œæˆ‘ç”šè‡³æ‰¾ä¸åˆ°ä¸€å¯¹å¯ä»¥å¹¶è¡Œè¿è¡Œçš„æ–¹æ³•ã€‚è®©æˆ‘ä»¬ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­â€”â€”

å‡è®¾æ‚¨æƒ³è¦ç”Ÿæˆä¸€ä¸ªä» 1 åˆ° 20 çš„æ•°å­—åˆ—è¡¨ï¼Œç„¶åå‘åˆ—è¡¨ä¸­çš„æ¯ä¸ªæ•°å­—æ·»åŠ ä¸€ä¸ªä» 10â€“20 çš„éšæœºæ•´æ•°ï¼Œç„¶åå°†åˆ—è¡¨è½¬æ¢ä¸ºä¸€ä¸ªé›†åˆï¼Œè¿™æ ·åœ¨æœ€ç»ˆè¾“å‡ºä¸­å°±ä¸ä¼šæœ‰é‡å¤çš„æ•°å­—ã€‚

![](img/d6b1d8b4317cf8cfa3e2c795fcacb8db.png)

æˆ‘ä»¬å°†åˆ›å»º 3 ä¸ªæ–¹æ³•æ¥åˆ†å‰²è¿™é¡¹ä»»åŠ¡ï¼Œä¸€ä¸ªæ–¹æ³•å°†ç”Ÿæˆä¸€ä¸ªä» 1 åˆ° 20 çš„æ•°å­—åˆ—è¡¨ï¼Œç„¶åå¦ä¸€ä¸ªæ–¹æ³•å°†å‘åˆ—è¡¨ä¸­çš„æ¯ä¸ªæ•°å­—æ·»åŠ éšæœºæ•°ï¼Œç„¶åä¸€ä¸ªæ–¹æ³•å°†åˆ—è¡¨è½¬æ¢ä¸ºé›†åˆã€‚ç°åœ¨çš„é—®é¢˜æ˜¯ï¼Œæœ‰æ²¡æœ‰åŠæ³•å¹¶è¡Œè¿è¡Œè¿™äº›æ–¹æ³•ï¼Ÿï¼ŸğŸ˜• ğŸ’­

> å¦‚æœæˆ‘ä»¬çš„ç¬¬äºŒä¸ªæ–¹æ³•( **add_random** )ä¸å¿…ç­‰å¾…ç¬¬ä¸€ä¸ªæ–¹æ³•( **generate_numbers_list** )å®Œæˆï¼Œå¹¶ä¸”åªè¦ç”Ÿæˆä¸€ä¸ªæ•°å­—ï¼Œç¬¬äºŒä¸ªæ–¹æ³•å°±å¯ä»¥å¼€å§‹å¤„ç†è¯¥æ•°å­—ï¼Œå³ç”Ÿæˆä¸€ä¸ªéšæœºæ•°å¹¶æ·»åŠ åˆ°å…¶ä¸­ï¼Œé‚£ä¼šæ€ä¹ˆæ ·ï¼Ÿ

æˆ‘ä»¬å°†å†æ·»åŠ ä¸¤ä¸ªæ–¹æ³•ï¼Œä¸€ä¸ªåœ¨å¼€å§‹ï¼Œå³ logger æ–¹æ³•ï¼Œå¦ä¸€ä¸ªåœ¨ **convert_to_set** ()æ–¹æ³•ä¹‹å‰ï¼Œè¯¥æ–¹æ³•å°†æ”¶é›†æ‰€æœ‰æ•°æ®æµå¹¶åˆ›å»ºä¸€ä¸ªæœ€ç»ˆåˆ—è¡¨ï¼Œè¯¥åˆ—è¡¨å°†å‡†å¤‡å¥½è½¬æ¢ä¸º setã€‚å› ä¸ºå°†åˆ—è¡¨è½¬æ¢ä¸ºé›†åˆéœ€è¦æ‰€æœ‰æ•°æ®åŒæ—¶è¿›è¡Œï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½å¹¶è¡ŒåŒ–è¯¥æ–¹æ³•ã€‚

ç°åœ¨ï¼Œæµç¨‹å°†ä¼šæ˜¯â€”

![](img/459950169583188c4cf03701967936a0.png)

ç°åœ¨ï¼Œè¿™ 4 ç§æ–¹æ³•å°†å¹¶è¡Œè¿è¡Œã€‚(ç”Ÿæˆæ•°å­—åˆ—è¡¨ï¼Œéšæœºæ·»åŠ ï¼Œæ•°å­—åˆ—è¡¨ï¼Œæ‰“å°æ—¥å¿—)

```
def generate_numbers_list():
    LOGGER_QUEUE.put("Number generation Started")
    for x in range(1, 21):
        NUMBERS_QUEUE.put(x)
        time.sleep(5)
```

```
def add_random():
    LOGGER_QUEUE.put("Number addition Started")
    while True:
        num = randint(10, 20)
        if not NUMBERS_QUEUE.empty():
            x = NUMBERS_QUEUE.get()
            LOGGER_QUEUE.put(f"add_random - {x}")
            RANDINT_QUEUE.put(x+num)
```

```
def numbers_list(final_list):
    LOGGER_QUEUE.put("list conversion Started")
    while True:
        if not RANDINT_QUEUE.empty():
            x = RANDINT_QUEUE.get()
            LOGGER_QUEUE.put(f"appending - {x}")
            final_list.append(x)
```

**generate_numbers_list** ()å°†ç”Ÿæˆä» 1 åˆ° 20 çš„æ•°å­—åˆ—è¡¨ã€‚ä¸ºäº†ä½¿å®ƒæ›´è€—æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ  time.sleep(5)åœ¨ç”Ÿæˆæ¯ä¸ªæ•°å­—åç¡çœ  5 ç§’é’Ÿã€‚ç°åœ¨ï¼Œåªè¦å®ƒç”Ÿæˆä¸€ä¸ªæ•°å­—ï¼Œå®ƒå°±ä¼šå°†è¯¥æ•°å­—æ·»åŠ åˆ°åä¸ºâ€”â€”NUMBERS _ Queue çš„å¤šå¤„ç†é˜Ÿåˆ—ä¸­ï¼Œè¯¥é˜Ÿåˆ—æ­£è¢«ä¸‹ä¸€ä¸ªæ–¹æ³•ç›‘å¬ï¼Œå³ **add_random** ()
åªè¦é˜Ÿåˆ—ä¸­æœ‰ä¸€ä¸ªæ•°å­—å¯ç”¨ï¼Œadd_random å°±ä¼šå°†ä¸€ä¸ªéšæœºæ•°æ·»åŠ åˆ°è¯¥é˜Ÿåˆ—ä¸­ï¼Œå¹¶å°†å…¶æ”¾å…¥ RANDINT_QUEUEã€‚æ¥ä¸‹æ¥ï¼Œå®ƒè¢«ä¸‹ä¸€ä¸ªæ–¹æ³• **numbers_list** ()ç›‘å¬ï¼Œå¹¶æ”¶é›†æ•°æ®ä»¥åˆ›å»ºæœ€ç»ˆåˆ—è¡¨ã€‚

# **2ã€‚æ­£ç¡®åœ°æ‰§è¡Œè¿™äº›æ–¹æ³•ï¼Œå¹¶å°†å®ƒä»¬ä¸ä¸»æµç¨‹ç»“åˆèµ·æ¥ã€‚**

æ‚¨å¯ä»¥ä¸ºæ¯ç§æ–¹æ³•åˆ›å»ºä¸€ä¸ªæµç¨‹ï¼Œç„¶åå¯åŠ¨å®ƒã€‚

```
generate_numbers_process = Process(target=generate_numbers_list)
    add_random_process = Process(target=add_random)
    numbers_list_process = Process(target=numbers_list)
    generate_numbers_process.start()
    add_random_process.start()
    numbers_list_process.start()
    generate_numbers_process.join()
    add_random_process.join()
    numbers_list_process.join()
```

æ¯ä¸ªè¿›ç¨‹éƒ½éœ€è¦ Joinï¼Œä»¥ä¾¿å®ƒä»¬ä¸ä¸»æ–¹æ³•è¿æ¥ï¼Œå¹¶ä¸”ä¸»æ–¹æ³•ä¸ä¼šåœ¨æ²¡æœ‰å…¶è¿›ç¨‹çš„æƒ…å†µä¸‹é€€å‡ºã€‚

# **3ã€‚ç®¡ç†è¿›ç¨‹é—´çš„å…±äº«æ•°æ®(åˆ—è¡¨ã€é˜Ÿåˆ—ã€è¿”å›å€¼)ã€‚**

æˆ‘ä»¬å°†å¯¹å…±äº«æ•°æ®ä½¿ç”¨å¤šå¤„ç†é˜Ÿåˆ—å’Œåˆ—è¡¨ã€‚

```
from multiprocessing import Process, Queue, Manager
NUMBERS_QUEUE = Queue()
RANDINT_QUEUE = Queue()
LOGGER_QUEUE = Queue()shared_list = Manager().list()
```

# **4ã€‚ç®¡ç†ä¸åŒè¿›ç¨‹çš„æ—¥å¿—è®°å½•ã€‚**

ç”±äºæ‰€æœ‰çš„æ–¹æ³•éƒ½æ˜¯å¹¶è¡Œè¿è¡Œçš„ï¼Œå¦‚æœæˆ‘ä»¬ç›´æ¥åœ¨æ¯ä¸ªæ–¹æ³•ä¸­å†™å…¥ logging.info()ï¼Œé‚£ä¹ˆæ—¥å¿—å°†ä¼šå¼€å§‹æ‰“å°ï¼Œè€Œæ²¡æœ‰ä»»ä½•æ­£ç¡®çš„é¡ºåºã€‚å› æ­¤ï¼Œä¸ºäº†æŒ‰é¡ºåºæ‰“å°æ—¥å¿—ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªæ–¹æ³•( **print_logs** ())ï¼Œè¯¥æ–¹æ³•å°†ç›‘å¬æˆ‘ä»¬ç¤ºä¾‹ä¸­çš„ Queue- LOGGER_QUEUEï¼Œåªè¦é˜Ÿåˆ—ä¸­æœ‰ä»»ä½•æ—¥å¿—ï¼Œå®ƒå°±ä¼šè®°å½•å®ƒã€‚

```
def print_logs():
    while True:
        if not LOGGER_QUEUE.empty():
            x = LOGGER_QUEUE.get()
            logging.info(x)
```

ç°åœ¨ï¼Œç”±äºæ–¹æ³•æ­£åœ¨ç›‘å¬å¤šé‡å¤„ç†é˜Ÿåˆ—ï¼Œå¦‚æœæ²¡æœ‰æ¥è‡ªæºæ–¹æ³•çš„æ•°æ®ç»“æŸçš„ä¿¡å·ï¼Œå®ƒä»¬å°†æ— é™æœŸç­‰å¾…ã€‚

![](img/2ccd0df43ac8c468a151f6537823ec6b.png)

ä¸ºäº†å¤„ç†è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å°†åœ¨æ¯ä¸ªé˜Ÿåˆ—çš„æœ«å°¾æ·»åŠ ä¸€ä¸ªæ ‡å¿—ï¼Œä¸€æ—¦é‡åˆ°è¯¥æ ‡å¿—ï¼Œä¾¦å¬æ–¹æ³•å°†åœæ­¢ä»é˜Ÿåˆ—ä¸­æå–æ•°æ®ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œè¯¥æ ‡å¿—å°†æ˜¯â€œendâ€å­—ç¬¦ä¸²ï¼Œç„¶åç»§ç»­æ£€æŸ¥é˜Ÿåˆ—ä¸­çš„â€œendâ€å­—ç¬¦ä¸²ï¼Œå¹¶æ‰“ç ´å¾ªç¯ã€‚

```
NUMBERS_QUEUE.put("end")
RANDINT_QUEUE.put("end")
LOGGER_QUEUE.put("end")while True:
    if not RANDINT_QUEUE.empty():
        if QUEUE.get() == "end":
            break
```

è¿™æ˜¯æˆ‘åˆ›å»ºçš„ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œç”¨æ¥è§£é‡Šæˆ‘åœ¨ python ä¸­ä½¿ç”¨å¤šå¤„ç†çš„ç­–ç•¥ã€‚*æˆ‘çš„ç”¨ä¾‹æ˜¯ä»ä¸€ä¸ª API è·å–æ•°æ®ï¼Œå°†å…¶æ ¼å¼åŒ–ï¼Œç„¶åå­˜å‚¨åœ¨ s3 ä¸­ã€‚*

éšæ„æŸ¥çœ‹æ•´ä¸ªè„šæœ¬â€”[https://github . com/kuldeepkr 16/python-scripts/blob/main/multip _ techniques . py](https://github.com/kuldeepkr16/python-scripts/blob/main/multip_techniques.py)
æ¬¢è¿åé¦ˆã€‚ğŸ˜„