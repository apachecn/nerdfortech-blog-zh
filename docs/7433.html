<html>
<head>
<title>AWS Lambda Typescript(Charity Web App) â€” Handling S3 file upload event from Lambda function</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AWS Lambda Typescript(Charity Web App)-ä» Lambda å‡½æ•°å¤„ç† S3 æ–‡ä»¶ä¸Šä¼ äº‹ä»¶</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/nerd-for-tech/aws-lambda-typescript-charity-web-app-handling-s3-file-upload-event-from-lambda-function-58b154c04bed?source=collection_archive---------1-----------------------#2022-10-26">https://medium.com/nerd-for-tech/aws-lambda-typescript-charity-web-app-handling-s3-file-upload-event-from-lambda-function-58b154c04bed?source=collection_archive---------1-----------------------#2022-10-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="d8f3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å˜¿ä¼™è®¡ä»¬ï¼ï¼ï¼ï¼Œè¿™å°†æ˜¯æˆ‘çš„æ…ˆå–„ç½‘ç»œåº”ç”¨ç¨‹åºçš„æœ€åä¸€ä¸ªæ•™ç¨‹ã€‚ä¸ºäº†å®Œæˆæ•´ä¸ªé¡¹ç›®ï¼Œä¸‹ä¸€æ­¥å°†æ˜¯å®æ–½èµåŠ©å•†ç»†èŠ‚éƒ¨åˆ†ã€‚é‚£å°†æ˜¯è®¸å¤šé‡å¤çš„å·¥ä½œï¼Œæ‰€ä»¥æˆ‘ä¸ä¼šè®©ä½ åŒçƒ¦çš„ã€‚å¦‚æœä½ å¾ˆå¥½å¥‡ï¼Œå¯ä»¥å»é¡¹ç›®ç›¸å…³çš„ Github é“¾æ¥ï¼ŒæŸ¥çœ‹æ•´ä¸ªå®ç°ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»æ¶µç›–äº†ä¸ Reactã€AWS Lambdaã€AWS SAMã€AWS DynamoDB å’Œ AWS S3 ç›¸å…³çš„è®¸å¤šé¢†åŸŸã€‚äº‹ä¸å®œè¿Ÿï¼Œè®©æˆ‘ä»¬ç›´æ¥è·³åˆ° Lambda å‡½æ•°ä¸­ S3 æ–‡ä»¶ä¸Šä¼ äº‹ä»¶å¤„ç†çš„å®ç°ã€‚ä½¿ç”¨ä»¥ä¸‹é“¾æ¥æŸ¥çœ‹ä¸æ­¤é¡¹ç›®ç›¸å…³çš„ä»¥å‰æ•™ç¨‹ã€‚</p><div class="jd je ez fb jf"><div role="button" tabindex="0" class="ab bv ff cb dy jg jh bn ji jj jk"><div class="jl l"><div class="ab q"><div class="l di"><img alt="Dimuthu Wickramanayake" class="l de bw jm jn du" src="../Images/099c92eba7c0ef5b0373ba4d36052ba2.png" width="20" height="20" loading="lazy" data-original-src="https://miro.medium.com/v2/resize:fill:40:40/1*LsIMaDB2-AJKz28n02h_IQ.jpeg"/><div class="dr bw l jm jn ds n aw dt"/></div><div class="gg l dw"><p class="bd b fp z dy dz ea eb ec ed ee ef dx translated">è¿ªç©†å›¾Â·ç»´å…‹æ‹‰é©¬é‚£äºšå…‹</p></div></div><div class="jq jr fg l"><h2 class="bd hj qr qs dy qt ea eb qu ed ef hh bi translated">ç”¨ Typescript ç³»åˆ—ä½œå‡ºååº”(æ…ˆå–„ç½‘ç»œåº”ç”¨)</h2></div><div class="ab q"><div class="l dw"><a class="bd b be z bi qv au qw qx qy ng qz an fx fy ra rb rc gb gc gd de bk ge" href="https://billa-code.medium.com/list/react-with-typescript-seriescharity-web-app-6f45ca471f54?source=post_page-----58b154c04bed--------------------------------" rel="noopener follow" target="_top">View list</a></div><div class="rd l dw"><span class="bd b fp z dx">7 stories</span></div></div></div><div class="kd dh ke dy ab kf dw di"><div class="di jv bv jw jx"><div class="dh l"><img alt="" class="dh" src="../Images/ace19c3ad1c0f8dc12620ff352fd2b11.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/1*QhAfunLq4rh0VrChbXUtZA.png"/></div></div><div class="di jv bv jy jz ka"><div class="dh l"><img alt="" class="dh" src="../Images/23deda9e9ca42920182e5a94707a12e7.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/1*vBIWr2bx7SaHJveT97Xg9g.png"/></div></div><div class="di bv kb kc ka"><div class="dh l"><img alt="" class="dh" src="../Images/16523ac1bf719cb2bc80e1cc1ec44297.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/1*53lYwBkgmaFRow1Erxl06Q.png"/></div></div></div></div></div><div class="jd je ez fb jf"><div role="button" tabindex="0" class="ab bv ff cb dy jg jh bn ji jj jk"><div class="jl l"><div class="ab q"><div class="l di"><img alt="Dimuthu Wickramanayake" class="l de bw jm jn du" src="../Images/099c92eba7c0ef5b0373ba4d36052ba2.png" width="20" height="20" loading="lazy" data-original-src="https://miro.medium.com/v2/resize:fill:40:40/1*LsIMaDB2-AJKz28n02h_IQ.jpeg"/><div class="dr bw l jm jn ds n aw dt"/></div><div class="gg l dw"><p class="bd b fp z dy dz ea eb ec ed ee ef dx translated"><a class="ae af ag ah ai aj ak al am an ao ap aq ar as" href="https://billa-code.medium.com/?source=post_page-----58b154c04bed--------------------------------" rel="noopener follow" target="_top">è¿ªå§†å›¾Â·ç»´å…‹æ‹‰é©¬é‚£äºšå…‹</a></p></div></div><div class="jq jr fg l"><h2 class="bd hj qr qs dy qt ea eb qu ed ef hh bi translated">AWS Lambda(æ…ˆå–„ç½‘ç»œåº”ç”¨)ç³»åˆ—</h2></div><div class="ab q"><div class="l dw"><a class="bd b be z bi qv au qw qx qy ng qz an fx fy ra rb rc gb gc gd de bk ge" href="https://billa-code.medium.com/list/aws-lambda-charity-webapp-series-cd878238f932?source=post_page-----58b154c04bed--------------------------------" rel="noopener follow" target="_top">View list</a></div><div class="rd l dw"><span class="bd b fp z dx">5 stories</span></div></div></div><div class="kd dh ke dy ab kf dw di"><div class="di jv bv jw jx"><div class="dh l"><img alt="" class="dh" src="../Images/5e5d417a4f8e977dff5a6564ccf48d39.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/1*ZMefBLP2MRSPDwmix-Z0Mw.png"/></div></div><div class="di jv bv jy jz ka"><div class="dh l"><img alt="" class="dh" src="../Images/75f2267185bffd78647008c578e838b9.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/1*myAvjQPuBRWl1INX8ZjhAg.png"/></div></div><div class="di bv kb kc ka"><div class="dh l"><img alt="" class="dh" src="../Images/fa6bf2ff659d1783bd38eee735f02f2d.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/1*Mu1FtEnLQw7sXtrpNJmSHQ.png"/></div></div></div></div></div><p id="4a5f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ä½œä¸ºç¬¬ä¸€æ­¥ï¼Œè®©æˆ‘ä»¬è‡´åŠ›äºä¸ S3 æ¡¶ç›¸å…³çš„åŸºç¡€è®¾æ–½ã€‚ä¸ä¹‹å‰çš„æ•™ç¨‹ç±»ä¼¼ï¼Œæˆ‘ä»¬æ›´æ–°äº† template.yml æ–‡ä»¶ä¸­çš„åŸºç¡€ç»“æ„ç»†èŠ‚ã€‚åœ¨æ·»åŠ äº† S3 å­˜å‚¨æ¡¶ç»†èŠ‚å’Œä¸ä¹‹ç›¸å…³çš„äº‹ä»¶ç»†èŠ‚ä¹‹åï¼Œæ–‡ä»¶åº”è¯¥æ˜¯è¿™æ ·çš„ã€‚</p><pre class="kk kl km kn fd ko kp kq kr aw kj bi"><span id="0621" class="ks kt hi kp b fi ku kv l kw kx">AWSTemplateFormatVersion: '2010-09-09'<br/>Transform: AWS::Serverless-2016-10-31<br/>Description: serendib-scholarship-ws<br/>Globals:<br/>  Function:<br/>    Timeout: 3<br/><br/>Resources:<br/>  StudentFunction:<br/>    Type: AWS::Serverless::Function<br/>    Properties:<br/>      CodeUri: student/<br/>      Handler: app.lambdaHandler<br/>      Runtime: nodejs16.x<br/>      Architectures:<br/>        - x86_64<br/>      Policies:<br/>        - DynamoDBCrudPolicy:<br/>            TableName: !Ref SampleTable<br/>        <strong class="kp hj">- S3CrudPolicy:<br/>            BucketName: !Ref FileBucket</strong><br/>      Environment:<br/>        Variables:<br/>          SAMPLE_TABLE: !Ref SampleTable<br/>          <strong class="kp hj">FILE_BUCKET: !Ref FileBucket</strong><br/>      Events:<br/>        Student:<br/>          Type: Api<br/>          Properties:<br/>            Path: /student<br/>            Method: get<br/>        <strong class="kp hj">FileUpload:<br/>          Type: S3<br/>          Properties:<br/>            Bucket: !Ref FileBucket<br/>            Events:<br/>              - 's3:ObjectCreated:*'</strong><br/><br/>    Metadata:<br/>      BuildMethod: esbuild<br/>      BuildProperties:<br/>        Minify: true<br/>        Target: "es2020"<br/>        EntryPoints: <br/>        - app.ts<br/><br/>  <strong class="kp hj">FileBucket:<br/>    Type: 'AWS::S3::Bucket'</strong><br/><br/>  SampleTable:<br/>    Type: AWS::Serverless::SimpleTable<br/>    Properties:<br/>      PrimaryKey:<br/>        Name: id<br/>        Type: String<br/>      ProvisionedThroughput:<br/>        ReadCapacityUnits: 2<br/>        WriteCapacityUnits: 2<br/><br/>Outputs:<br/>  WebEndpoint:<br/>    Description: "API Gateway endpoint URL for Prod stage"<br/>    Value: !Sub "https://${ServerlessRestApi}.execute-api.${AWS::Region}.amazonaws.com/Prod/"</span></pre><p id="74ee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æ‚¨å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬æ­£åœ¨æ•æ‰ S3 çš„å¯¹è±¡åˆ›å»ºäº‹ä»¶ã€‚ç°åœ¨è®©æˆ‘ä»¬åœ¨ env.json æ–‡ä»¶ä¸­å®šä¹‰<strong class="ih hj"> FILE_BUCKET </strong>ç¯å¢ƒå˜é‡ã€‚</p><pre class="kk kl km kn fd ko kp kq kr aw kj bi"><span id="326d" class="ks kt hi kp b fi ku kv l kw kx">{<br/>    "StudentFunction": {<br/>        "SAMPLE_TABLE": "serendib-student",<br/>        "FILE_BUCKET": "serendib-ui"<br/>    }<br/>}</span></pre><p id="1375" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ç°åœ¨è®©æˆ‘ä»¬å¼€å§‹å®ç°ã€‚æ‰€ä»¥åœ¨ app.ts æ–‡ä»¶ä¸­ï¼Œæˆ‘å°†æ£€æŸ¥è§¦å‘ Lambda å‡½æ•°çš„äº‹ä»¶æ˜¯å¦æœ‰ httpMethodã€‚å¦‚æœæœ‰ï¼Œå®ƒå°†è¢«è§†ä¸ºæ­£å¸¸çš„ API ç½‘å…³å®ç°ï¼Œå¦åˆ™å®ƒå°†è¢«è§†ä¸º S3 äº‹ä»¶è§¦å‘å™¨ã€‚ç°åœ¨æˆ‘è¦åšçš„æ˜¯æ•æ‰æ–°åˆ›å»ºçš„æ–‡ä»¶çš„åç§°ï¼Œè¿™æ˜¯äº‹ä»¶å¯¹è±¡ä¸­çš„é”®ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘éœ€è¦ä¸è¯¥æ–‡ä»¶ç›¸å…³çš„å­¦ç”Ÿçš„ IDã€‚ç°åœ¨æˆ‘å°†ç¡¬ç¼–ç è¿™ä¸ªï¼Œä½†æˆ‘ä¼šç»™ä½ ä¸€ä¸ªå¯èƒ½çš„è§£å†³æ–¹æ¡ˆã€‚è¿™æ ·åšä¹‹åï¼Œæˆ‘å°†ä¸ºå­¦ç”Ÿè°ƒç”¨ DynamoDB æ›´æ–°ã€‚åœ¨è°ƒç”¨ update ä¹‹å‰ï¼Œæˆ‘å°†é¦–å…ˆè·å–è¯¥é¡¹ï¼Œç„¶åä¸ºå®ƒæ›´æ–°æ–‡ä»¶æ•°ç»„ã€‚æˆ‘è¿™æ ·åšæ˜¯å› ä¸ºæ–‡ä»¶å¯ä»¥æœ‰å¤šä¸ªå€¼ã€‚ä»¥ä¸‹æ˜¯æ‰‹æŸ„çš„æ“ä½œéƒ¨åˆ†ã€‚</p><pre class="kk kl km kn fd ko kp kq kr aw kj bi"><span id="8d79" class="ks kt hi kp b fi ku kv l kw kx">} else if (event['Records'][<em class="ky">0</em>]['s3']) {<br/>    const key = event['Records'][<em class="ky">0</em>]['s3']['object']['key'];<br/>    const id = "f682386e-e34f-4d9f-b6f4-9398fb6a131d";<br/>    results = await updateStudentFileName(key, id);<br/>}</span></pre><p id="48b9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ä¸‹é¢æ˜¯ updateStudentFileName å‡½æ•°ã€‚</p><pre class="kk kl km kn fd ko kp kq kr aw kj bi"><span id="5577" class="ks kt hi kp b fi ku kv l kw kx">const updateStudentFileName = async (key: string, id: string) =&gt; {<br/>    console.log(key);<br/><br/>    try {<br/>        const paramsGet = {<br/>            TableName: tableName,<br/>            Key: marshall({ id: id })<br/>        };<br/><br/>        const { Item } = await client.send(new GetItemCommand(paramsGet));<br/>        const item = unmarshall(Item);<br/>        console.log(item.files);<br/>        const files = item.files ? [...item.files, {name: key}] : [{name: key}]<br/><br/>        const params = {<br/>          TableName: tableName,<br/>          Item: {<br/>            id: id,<br/>            files: files,<br/>            name: item.name,<br/>            age: item.age<br/>          }<br/>        };<br/><br/>        const docClient = DynamoDBDocumentClient.from(client);<br/><br/>        let res = await docClient.send(new PutCommand(params));<br/>        console.log(res)<br/>    <br/>        return res;<br/>    } catch(e) {<br/>        console.error(e);<br/>        throw e;<br/>    }<br/>}</span></pre><p id="ccc0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æ‚¨å¯èƒ½ä¼šçœ‹åˆ° updateStudents å‡½æ•°ä¸æ­¤å‡½æ•°ä¹‹é—´çš„åŒºåˆ«ã€‚æˆ‘ä½¿ç”¨äº†å¦ä¸€ä¸ªå‡½æ•°ä¸­çš„ä¸€ä¸ªæ–°å‡½æ•°æ¥å±•ç¤ºå¦ä¸€ç§æ–¹æ³•ã€‚ä¸ºäº†é€‚åº”è¿™ä¸€ç‚¹ï¼Œæˆ‘å¿…é¡»æ›´æ–° package.json æ–‡ä»¶ä»¥åŒ…å«ä¾èµ–å…³ç³»ã€‚DynamoDBDocumentClient å’Œ PutCommand å°±æ˜¯æ¥è‡ªè¿™ä¸ªä¾èµ–å…³ç³»ã€‚</p><pre class="kk kl km kn fd ko kp kq kr aw kj bi"><span id="c1e7" class="ks kt hi kp b fi ku kv l kw kx">{<br/>  "name": "student",<br/>  "version": "1.0.0",<br/>  "description": "Student service for serendib scholarship ws",<br/>  "main": "app.js",<br/>  "repository": "https://github.com/deBilla/serendib-scholarship-ws/student",<br/>  "author": "SAM CLI",<br/>  "license": "MIT",<br/>  "dependencies": {<br/>    "@aws-sdk/client-dynamodb": "3.194.0",<br/>    "@aws-sdk/util-dynamodb": "3.194.0",<br/>    "@aws-sdk/lib-dynamodb": "3.194.0",<br/>    "esbuild": "^0.14.14"<br/>  },<br/>  "scripts": {<br/>    "unit": "jest",<br/>    "lint": "eslint '*.ts' --quiet --fix",<br/>    "compile": "tsc",<br/>    "test": "npm run compile &amp;&amp; npm run unit"<br/>  },<br/>  "devDependencies": {<br/>    "@types/aws-lambda": "^8.10.92",<br/>    "@types/jest": "^27.4.0",<br/>    "@types/node": "^17.0.13",<br/>    "@typescript-eslint/eslint-plugin": "^5.10.2",<br/>    "@typescript-eslint/parser": "^5.10.2",<br/>    "esbuild-jest": "^0.5.0",<br/>    "eslint": "^8.8.0",<br/>    "eslint-config-prettier": "^8.3.0",<br/>    "eslint-plugin-prettier": "^4.0.0",<br/>    "jest": "^27.5.0",<br/>    "prettier": "^2.5.1",<br/>    "ts-node": "^10.4.0",<br/>    "typescript": "^4.5.5"<br/>  }<br/>}</span></pre><p id="90fe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å¥½ğŸ‘Œã€‚ç°åœ¨å·®ä¸å¤šç»“æŸäº†ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹ app.ts ä¸­çš„å…¨éƒ¨ä»£ç ã€‚</p><pre class="kk kl km kn fd ko kp kq kr aw kj bi"><span id="12c0" class="ks kt hi kp b fi ku kv l kw kx">import { APIGatewayProxyEvent, APIGatewayProxyResult } from 'aws-lambda';<br/>import { DynamoDBClient,  ScanCommand, PutItemCommand, GetItemCommand, DeleteItemCommand, UpdateItemCommand } from "@aws-sdk/client-dynamodb";<br/>import { DynamoDBDocumentClient, PutCommand } from "@aws-sdk/lib-dynamodb";<br/>import { marshall, unmarshall } from "@aws-sdk/util-dynamodb";<br/>import { v4 as uuidv4 } from 'uuid';<br/><br/>const tableName = process.env.SAMPLE_TABLE;<br/>const client = new DynamoDBClient({ region: "us-east-1" });<br/><br/>export const lambdaHandler = async (event: APIGatewayProxyEvent): Promise&lt;APIGatewayProxyResult&gt; =&gt; {<br/>    let results: any;<br/>    let response: APIGatewayProxyResult;<br/><br/>    try {<br/>        if (event.httpMethod) {<br/>            switch (event.httpMethod) {<br/>                case 'GET':<br/>                    if (event.pathParameters.id != <em class="ky">null</em>) {<br/>                        results = await getStudent(event.pathParameters.id);<br/>                    } else {<br/>                        results = await getStudents();<br/>                    }<br/>                    <br/>                    break;<br/>                case 'POST':<br/>                    results = await createStudents(event);<br/>                    break;<br/>                case 'PUT':<br/>                    results = await updateStudents(event)<br/>                    break;<br/>                case 'DELETE':<br/>                    results = await deleteStudents(event.pathParameters.id)<br/>                    break;<br/>                default:<br/>                    throw new Error('Unidentified event!!!');<br/>            }<br/>        } else if (event['Records'][<em class="ky">0</em>]['s3']) {<br/>            const key = event['Records'][<em class="ky">0</em>]['s3']['object']['key'];<br/>            const id = "f682386e-e34f-4d9f-b6f4-9398fb6a131d";<br/>            results = await updateStudentFileName(key, id);<br/>        }<br/>        <br/>        response = {<br/>            statusCode: <em class="ky">200</em>,<br/>            body: JSON.stringify({<br/>                message: results,<br/>            }),<br/>        };<br/>    } catch (err: unknown) {<br/>        console.log(err);<br/>        response = {<br/>            statusCode: <em class="ky">500</em>,<br/>            body: JSON.stringify({<br/>                message: err instanceof Error ? err.message : 'some error happened',<br/>            }),<br/>        };<br/>    }<br/><br/>    return response;<br/>};<br/><br/>const getStudents = async () =&gt; {<br/>    try {<br/>        const params = {<br/>            TableName : tableName<br/>        };<br/>        const { Items } = await client.send(new ScanCommand(params));<br/><br/>        return Items;<br/>    } catch (e) {<br/>        throw e;<br/>    }<br/>}<br/><br/>const getStudent = async (studentId: string) =&gt; {<br/>    try {<br/>        const params = {<br/>            TableName: tableName,<br/>            Key: marshall({ id: studentId })<br/>        };<br/><br/>        const { Item } = await client.send(new GetItemCommand(params));<br/><br/>        return (Item) ? unmarshall(Item) : {};<br/>    } catch(e) {<br/>        throw e;<br/>    }<br/>}<br/><br/>const createStudents = async (event: APIGatewayProxyEvent) =&gt; {<br/>    try {<br/>        const student = JSON.parse(event.body);<br/>        const studentId = uuidv4();<br/>        student.id = studentId;<br/><br/>        const params = {<br/>            TableName: tableName,<br/>            Item: marshall(student || {})<br/>        };<br/><br/>        return await client.send(new PutItemCommand(params));<br/>    } catch(e) {<br/>        throw e;<br/>    }<br/>}<br/><br/>const updateStudents = async (event: APIGatewayProxyEvent) =&gt; {<br/>    try {<br/>        const requestBody = JSON.parse(event.body);<br/>        const objKeys = Object.keys(requestBody);   <br/>    <br/>        const params = {<br/>          TableName: tableName,<br/>          Key: marshall({ id: event.pathParameters.id }),<br/>          UpdateExpression: `SET ${objKeys.map((_, index) =&gt; `#key${index} = :value${index}`).join(", ")}`,<br/>          ExpressionAttributeNames: objKeys.reduce((acc, key, index) =&gt; ({<br/>              ...acc,<br/>              [`#key${index}`]: key,<br/>          }), {}),<br/>          ExpressionAttributeValues: marshall(objKeys.reduce((acc, key, index) =&gt; ({<br/>              ...acc,<br/>              [`:value${index}`]: requestBody[key],<br/>          }), {})),<br/>        };<br/>    <br/>        return await client.send(new UpdateItemCommand(params));<br/>    } catch(e) {<br/>        console.error(e);<br/>        throw e;<br/>    }<br/>}<br/><br/>const updateStudentFileName = async (key: string, id: string) =&gt; {<br/>    console.log(key);<br/><br/>    try {<br/>        const paramsGet = {<br/>            TableName: tableName,<br/>            Key: marshall({ id: id })<br/>        };<br/><br/>        const { Item } = await client.send(new GetItemCommand(paramsGet));<br/>        const item = unmarshall(Item);<br/>        console.log(item.files);<br/>        const files = item.files ? [...item.files, {name: key}] : [{name: key}]<br/><br/>        const params = {<br/>          TableName: tableName,<br/>          Item: {<br/>            id: id,<br/>            files: files,<br/>            name: item.name,<br/>            age: item.age<br/>          }<br/>        };<br/><br/>        const docClient = DynamoDBDocumentClient.from(client);<br/><br/>        let res = await docClient.send(new PutCommand(params));<br/>        console.log(res)<br/>    <br/>        return res;<br/>    } catch(e) {<br/>        console.error(e);<br/>        throw e;<br/>    }<br/>}<br/><br/>const deleteStudents = async (studentId: string) =&gt; {<br/>    try {<br/>        const params = {<br/>          TableName: tableName,<br/>          Key: marshall({ id: studentId }),<br/>        };<br/>    <br/>        return await client.send(new DeleteItemCommand(params));<br/>    } catch(e) {<br/>        throw e;<br/>    }<br/>}</span></pre><p id="ecd3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ç°åœ¨ï¼Œè¦åœ¨æœ¬åœ°è§¦å‘è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¿…é¡»æœ‰ä¸€ä¸ªç”±æˆ‘ä»¬åˆ›å»ºçš„ S3 äº‹ä»¶ã€‚ä»¥ä¸‹æ˜¯å–è‡ª AWS ç¤ºä¾‹ä»£ç åº“çš„ä¸€ä¸ªå®˜æ–¹äº‹ä»¶ã€‚å°†è¯¥æ–‡ä»¶ä¿å­˜ä¸º events æ–‡ä»¶å¤¹ä¸­çš„ s3event.jsonã€‚</p><pre class="kk kl km kn fd ko kp kq kr aw kj bi"><span id="9b52" class="ks kt hi kp b fi ku kv l kw kx">{<br/>    "Records": [<br/>        {<br/>            "eventVersion": "2.0", <br/>            "eventName": "ObjectCreated:Put", <br/>            "eventTime": "1970-01-01T00:00:00.000Z", <br/>            "userIdentity": {<br/>                "principalId": "EXAMPLE"<br/>            }, <br/>            "eventSource": "aws:s3", <br/>            "requestParameters": {<br/>                "sourceIPAddress": "127.0.0.1"<br/>            }, <br/>            "s3": {<br/>                "configurationId": "testConfigRule", <br/>                "object": {<br/>                    "eTag": "1c43a0c9dcc31572b5e49c0b42f8b17f", <br/>                    "key": "prabhashi.png", <br/>                    "sequencer": "0A1B2C3D4E5F678901", <br/>                    "size": 1024<br/>                }, <br/>                "bucket": {<br/>                    "ownerIdentity": {<br/>                        "principalId": "EXAMPLE"<br/>                    }, <br/>                    "name": "serendib-ui", <br/>                    "arn": "arn:aws:s3:::serendib-ui"<br/>                }, <br/>                "s3SchemaVersion": "1.0"<br/>            }, <br/>            "responseElements": {<br/>                "x-amz-id-2": "EXAMPLE123/5678abcdefghijklambdaisawesome/mnopqrstuvwxyzABCDEFGH", <br/>                "x-amz-request-id": "EXAMPLE123456789"<br/>            }, <br/>            "awsRegion": "us-east-1"<br/>        }<br/>    ]<br/>}</span></pre><p id="237a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æœ€åä¸€æ­¥ï¼Œè°ƒç”¨ SAM invoke æ¥è¿è¡Œè¯¥äº‹ä»¶ã€‚</p><pre class="kk kl km kn fd ko kp kq kr aw kj bi"><span id="fb92" class="ks kt hi kp b fi ku kv l kw kx">sam local invoke StudentFunction --event events/s3event.json --env-vars env.json</span></pre><p id="bf4c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ç°åœ¨ä½ åº”è¯¥å¾—åˆ°è¿™æ ·çš„ä¸œè¥¿ã€‚</p><pre class="kk kl km kn fd ko kp kq kr aw kj bi"><span id="151c" class="ks kt hi kp b fi ku kv l kw kx">START RequestId: 22d0b73e-25cf-42b4-a661-ca095f297ca5 Version: $LATEST<br/>2022-10-26T12:31:46.694Z        22d0b73e-25cf-42b4-a661-ca095f297ca5    INFO    prabhashi.png<br/>2022-10-26T12:31:47.879Z        22d0b73e-25cf-42b4-a661-ca095f297ca5    INFO    [ { name: 'prabhashi.png' }, { name: 'prabhashi.png' } ]<br/>} ItemCollectionMetrics: undefined4BGVP83BVV4KQNSO5AEMVJF66Q9ASUAAJG',  INFO    {<br/>END RequestId: 22d0b73e-25cf-42b4-a661-ca095f297ca5<br/>REPORT RequestId: 22d0b73e-25cf-42b4-a661-ca095f297ca5  Init Duration: 0.21 ms  Duration: 1616.00 ms    Billed Duration: 1616 ms        Memory Size: 128 MB     Max Memory Used: 128 MB<br/>{"statusCode":200,"body":"{\"message\":{\"$metadata\":{\"httpStatusCode\":200,\"requestId\":\"0IVRUNGTHVDDH5C32G4BGVP83BVV4KQNSO5AEMVJF66Q9ASUAAJG\",\"attempts\":1,\"totalRetryDelay\":0}}}"}%</span></pre><p id="3835" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å¦‚æœæ‚¨è½¬åˆ° DynamoDB è¡¨ï¼Œåº”è¯¥ä¼šçœ‹åˆ°æ›´æ–°åçš„åˆ—ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p><figure class="kk kl km kn fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es kz"><img src="../Images/08f22ac5bf3790eb92b6cf4ac4058388.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZMefBLP2MRSPDwmix-Z0Mw.png"/></div></div></figure><p id="e696" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å¾ˆé…·å§ã€‚ç°åœ¨å¦‚æœä½ åšä¸€ä¸ª<code class="du lg lh li kp b">sam deploy</code>ã€‚è¿™å°†æ˜¯å»äº‘ï¼Œä½ çš„åº”ç”¨ç¨‹åºå°†å®Œå…¨åŠŸèƒ½ã€‚ä¹‹å‰æˆ‘å‘Šè¯‰è¿‡ä½ æˆ‘æœ‰ä¸€ä¸ªä»æ–‡ä»¶åä¸­è·å–å­¦å·çš„æ–¹æ³•ã€‚</p><p id="26ba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="ky">â€œæˆ‘å°†æŠŠ studentId æ·»åŠ åˆ°æ–‡ä»¶åä¸­ï¼Œå½“åœ¨è¿™é‡Œæ£€ç´¢å®ƒæ—¶ï¼Œæˆ‘å°†æ·»åŠ ä»å®ƒé‚£é‡Œè·å– Idã€‚â€</em></p><p id="65bb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æˆ‘æƒ³è¿™å·²ç»å®Œæˆäº†ã€‚å¦‚æœä½ æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·åœ¨è¿™é‡Œç•™è¨€ã€‚æˆ‘ä¼šå›ç­”ä»»ä½•é—®é¢˜ã€‚æ„Ÿè°¢ä½ ä»¬é˜…è¯»è¿™äº›ï¼Œå¹¶å¸Œæœ›åœ¨æœªæ¥ä¸ä½ ä»¬è§é¢ï¼Œæœ‰å¦ä¸€ä¸ªå¾ˆé…·çš„é¡¹ç›®ã€‚ç›´åˆ°é‚£æ—¶å¿«ä¹ç¼–ç ï¼ï¼ï¼ã€‚</p></div></div>    
</body>
</html>