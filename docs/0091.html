<html>
<head>
<title>Home DevOps Pipeline: A junior engineerâ€™s tale (3/4)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">å®¶åº­å¼€å‘ç®¡é“:ä¸€ä¸ªåˆçº§å·¥ç¨‹å¸ˆçš„æ•…äº‹(3/4)</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/nerd-for-tech/home-devops-pipeline-a-junior-engineers-tale-3-4-5f61c5245934?source=collection_archive---------2-----------------------#2020-02-12">https://medium.com/nerd-for-tech/home-devops-pipeline-a-junior-engineers-tale-3-4-5f61c5245934?source=collection_archive---------2-----------------------#2020-02-12</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="217a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">å†…å®¹:</em> <a class="ae je" rel="noopener" href="/@t3chflicks/home-devops-pipeline-a-junior-engineers-tale-1-4-336ed07a6ec0"> <em class="jd"> 1 </em> </a> <em class="jd">ï¼Œ</em> <a class="ae je" rel="noopener" href="/@t3chflicks/home-devops-pipeline-a-junior-engineers-tale-2-4-7be3e3c292c"> <em class="jd"> 2 </em> </a> <em class="jd">ï¼Œ(</em> <a class="ae je" rel="noopener" href="/@t3chflicks/home-devops-pipeline-a-junior-engineers-tale-3-4-5f61c5245934"> <em class="jd"> 3 </em> </a> <em class="jd">)ï¼Œ</em> <a class="ae je" rel="noopener" href="/@t3chflicks/home-devops-pipeline-a-junior-engineers-tale-4-4-5db7c1610e3e"> <em class="jd"> 4 </em> </a></p><p id="3006" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">åœ¨è¿™ä¸€ç³»åˆ—æ–‡ç« ä¸­ï¼Œæˆ‘å°†è§£é‡Šæˆ‘æ˜¯å¦‚ä½•ä½¿ç”¨å‡ ä¸ª Raspberry Pis å’Œè®¸å¤šè½¯ä»¶æ„å»ºè‡ªå·±çš„å®¶åº­å¼€å‘ç¯å¢ƒçš„ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†ä»‹ç»ç®¡é“çš„éƒ¨ç½²éƒ¨åˆ†ã€‚</p><blockquote class="jf"><p id="aa62" class="jg jh hi bd ji jj jk jl jm jn jo jc dx translated"><a class="ae je" href="https://github.com/sk-t3ch/home-repo" rel="noopener ugc nofollow" target="_blank">ğŸ”—åœ¨ Github ä¸Šè·å– Home DevOps ç®¡é“ä»£ç ğŸ“”</a></p></blockquote><h1 id="b76d" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">éƒ¨ç½²</h1><h2 id="f553" class="kn jq hi bd jr ko kp kq jv kr ks kt jz iq ku kv kd iu kw kx kh iy ky kz kl la bi translated">Ansible</h2><p id="da9e" class="pw-post-body-paragraph if ig hi ih b ii lb ik il im lc io ip iq ld is it iu le iw ix iy lf ja jb jc hb bi translated">å…³äº Drone çš„å¦ä¸€ä¸ªä¼Ÿå¤§çš„äº‹æƒ…æ˜¯å¯ç”¨çš„æ’ä»¶<a class="ae je" href="http://plugins.drone.io" rel="noopener ugc nofollow" target="_blank">â€”â€”æˆ‘ä»¬å°†ä½¿ç”¨</a><a class="ae je" href="https://docs.ansible.com/ansible/latest/user_guide/basic_concepts.html" rel="noopener ugc nofollow" target="_blank"> Ansible </a>æ’ä»¶ä½œä¸ºåœ¨å¤šå°æœºå™¨ä¸Šè¿è¡Œ ssh å‘½ä»¤çš„å·¥å…·ã€‚æˆ‘ä»¬ä¹Ÿå°†åˆ©ç”¨<a class="ae je" href="https://docs.drone.io/secret/repository/" rel="noopener ugc nofollow" target="_blank">æ— äººæœºæœºå¯†</a>ä½œä¸ºå®‰å…¨éƒ¨ç½²æŸäº›é…ç½®å€¼çš„æ–¹æ³•ã€‚</p><p id="702e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æˆ‘è§è¿‡çš„ä¸€èˆ¬éƒ¨ç½²æ–¹æ³•é€šå¸¸åŒ…æ‹¬å‘å¸ƒåˆ° AWSï¼Œç„¶åç¥å¥‡çš„äº‹æƒ…å‘ç”Ÿäº†ï¼Œä½¿ç”¨äº‘å½¢æˆæ¨¡æ¿ï¼Œä½ çš„æ ˆå°±åˆ›å»ºå¥½äº†ã€‚</p><p id="a00b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ç„¶è€Œï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨æˆ¿å±‹å›è´­ä¸­ä¿ç•™æˆ¿å±‹ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¸Œæœ›éƒ¨ç½²åˆ°æœ¬åœ°ç½‘ç»œä¸Šçš„ç‰¹å®šæœºå™¨ä¸Šã€‚å¯¹æˆ‘æ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªè´Ÿè½½çš„å…¶ä»– Raspberry Pis å¯ä»¥åšå¾ˆå¤šäº‹æƒ…ï¼Œä»æ§åˆ¶æˆ‘çš„ 3D æ‰“å°æœºï¼Œåˆ°ä½œä¸º CCTV æ‘„åƒæœºçš„ç½‘ç»œå·¥ä½œã€‚</p><p id="37a3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†åƒè¿™æ ·ä½¿ç”¨ Ansible:</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="914c" class="kn jq hi ll b fi lp lq l lr ls">kind: pipeline<br/>name: commitPipeline</span><span id="c880" class="kn jq hi ll b fi lt lq l lr ls">trigger:<br/>  event:<br/>     - push</span><span id="275b" class="kn jq hi ll b fi lt lq l lr ls">platform:<br/>  os: linux<br/>  arch: arm</span><span id="e993" class="kn jq hi ll b fi lt lq l lr ls">steps:<br/>  - name: trigger-rebuild-of-image<br/>    image: plugins/ansible:1<br/>    environment:<br/>      repo_username:<br/>        from_secret: repo_username<br/>      repo_password:<br/>        from_secret: repo_password<br/>    settings:<br/>      private_key:<br/>        from_secret: ansible_private_key<br/>      playbook: ansible/playbook.yml<br/>      inventory: ansible/inventory.yml</span></pre><p id="7be8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Ansible æ‰§è¡Œçš„åŠ¨ä½œåœ¨<code class="du lu lv lw ll b">playbook.yml</code>ä¸­æ‰¾åˆ°ï¼Œæˆ‘ä»¬æƒ³è¦åœ¨å…¶ä¸Šæ‰§è¡Œçš„æœºå™¨åœ¨<code class="du lu lv lw ll b">inventory.yml</code>ä¸­æè¿°:</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="e0f2" class="kn jq hi ll b fi lp lq l lr ls"># playbook.yml<br/>- hosts: cameras</span><span id="e450" class="kn jq hi ll b fi lt lq l lr ls">tasks:</span><span id="e7c6" class="kn jq hi ll b fi lt lq l lr ls">- name: .ssh directory<br/>  file:<br/>    path: ~/.ssh<br/>    owner: pi<br/>    group: pi<br/>    state: directory</span><span id="6742" class="kn jq hi ll b fi lt lq l lr ls">- name: put key in<br/>  copy:<br/>    content: "{{ lookup('env','ansible_private_key') }}"<br/>    dest: ~/.ssh/deploy_key<br/>    owner: pi<br/>    group: pi<br/>    mode: 0600<br/>    become: pi</span><span id="7657" class="kn jq hi ll b fi lt lq l lr ls">- name: clone the repo<br/>  git:  <br/>    repo: ssh://git@git.&lt;domain&gt;/&lt;username&gt;/cctv.git<br/>    dest: /home/pi/cctv<br/>    key_file: ~/.ssh/deploy_key<br/>    accept_hostkey: yes<br/>    force: yes</span><span id="13ed" class="kn jq hi ll b fi lt lq l lr ls">- name: Rebuild docker image<br/>   shell:<br/>   cmd: docker-compose up --remove-orphans --force-recreate --build -d<br/>  chdir: /home/pi/cctv</span><span id="2712" class="kn jq hi ll b fi lt lq l lr ls">- name: remove private key<br/>   shell:<br/>   cmd: rm ~/.ssh/deploy_key</span></pre><p id="ca29" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å’Œ</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="1471" class="kn jq hi ll b fi lp lq l lr ls"># invetory.yml<br/>all:<br/>  hosts:<br/>    drone.&lt;domain&gt;:<br/>  children:<br/>    cameras:<br/>      hosts:<br/>        192.168.0.41:<br/>        192.168.0.42:<br/>      vars:<br/>        ansible_ssh_user: pi</span></pre><p id="4d03" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æ„Ÿè°¢ ansibleï¼Œæˆ‘çš„ CCTV æ‘„åƒæœºæ›´æ–°éƒ¨ç½²æµç¨‹å¤§å¤§ç®€åŒ–äº†ã€‚</p><figure class="lg lh li lj fd lx"><div class="bz dy l di"><div class="ly lz l"/></div></figure><h2 id="d722" class="kn jq hi bd jr ko kp kq jv kr ks kt jz iq ku kv kd iu kw kx kh iy ky kz kl la bi translated">éƒ¨ç½²åˆ° AWS</h2><p id="f61e" class="pw-post-body-paragraph if ig hi ih b ii lb ik il im lc io ip iq ld is it iu le iw ix iy lf ja jb jc hb bi translated">åœ¨å®¶éƒ¨ç½²å¾ˆæœ‰è¶£ï¼Œä¹Ÿå¾ˆæ£’ï¼Œä½†è®­ç»ƒè½®å¿…é¡»è„±è½ã€‚ç°å®ä¸–ç•Œä¸­çš„å¼€å‘æ¶‰åŠåˆ°äº‘ï¼Œåœ¨æˆ‘å·¥ä½œçš„å…¬å¸ï¼Œè¿™æ„å‘³ç€ AWSã€‚</p><p id="f5a9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å°†æ‚¨çš„æœåŠ¡éƒ¨ç½²åˆ° AWS EC2 æœºå™¨ä¹Ÿåº”è¯¥æœ‰ä¸€ä¸ªæµ‹è¯•æ­¥éª¤ï¼Œä½†æ˜¯æœ€å¸¸è§çš„æ¶æ„(x86)ä¸ Raspberry Pi ä¸Šçš„ arm æ¶æ„éå¸¸ä¸åŒã€‚å¦‚æœæˆ‘ä»¬çš„æ„å»ºå°†è¢«éƒ¨ç½²åˆ° x86 æœºå™¨ä¸Šï¼Œæˆ‘ä»¬ä¸åº”è¯¥ä½¿ç”¨ arm æœºå™¨æ¥æµ‹è¯•å®ƒä»¬ã€‚æˆ‘ä»¬å¿…é¡»éƒ¨ç½² x86 æ— äººé©¾é©¶é£æœºã€‚</p><p id="6f42" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ç„¶è€Œï¼Œæƒ…èŠ‚å†æ¬¡æ‰­æ›²ï¼Œä¸ºäº†ä½¿ç”¨æˆ‘ä»¬çš„ç¯å¢ƒéƒ¨ç½²æ— äººæœº x86 runnerï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä»…é’ˆå¯¹ x86 è€Œé arm æ„å»ºçš„æ— äººæœº/äº‘ç¼–é˜Ÿæ˜ åƒã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥è‡ªå·±é‡å»ºå®ƒï¼Œå°±åƒæˆ‘åœ¨æˆ‘çš„<a class="ae je" href="https://github.com/sk-t3ch/home-repo" rel="noopener ugc nofollow" target="_blank">ä»£ç </a>ä¸­å±•ç¤ºçš„é‚£æ ·ã€‚åƒä¸€ä¸ªå¥½å­©å­ä¸€æ ·ï¼Œæˆ‘ä¹Ÿåœ¨ dockerhub ä¸Šå‘å¸ƒäº†<a class="ae je" href="https://hub.docker.com/r/t3chflicks/aws-cfn" rel="noopener ugc nofollow" target="_blank">çš„å›¾ç‰‡</a>ä¾›ä»–äººä½¿ç”¨ã€‚</p><figure class="lg lh li lj fd lx er es paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="er es ma"><img src="../Images/ab88159faa978001759e62fc3a23a987.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*MvIcm-Vt6cAwJ__y"/></div></div><figcaption class="mh mi et er es mj mk bd b be z dx translated">ç…§ç‰‡ç”±<a class="ae je" href="https://unsplash.com/@waguluz_?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">å®‰å¾·é‡Œäºšæ–¯Â·ç“¦æ ¼çº³</a>åœ¨<a class="ae je" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>æ‹æ‘„</figcaption></figure><p id="d94f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ä½¿ç”¨å®ƒï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥åƒè¿™æ ·éƒ¨ç½² AWS æœºå™¨:</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="d0d5" class="kn jq hi ll b fi lp lq l lr ls">kind: pipeline<br/>name: commitPipeline</span><span id="76a4" class="kn jq hi ll b fi lt lq l lr ls">trigger:<br/>  event:<br/>    - push</span><span id="70d0" class="kn jq hi ll b fi lt lq l lr ls">platform:<br/>  os: linux<br/>  arch: arm</span><span id="8947" class="kn jq hi ll b fi lt lq l lr ls">steps:<br/>  - name: validate-seeder-infrastructure<br/>    image: registry.&lt;domain&gt;/aws-cfn<br/>    settings:<br/>      mode: validate<br/>      template: infrastructure.yml<br/>    environment:<br/>      AWS_ACCESS_KEY_ID:<br/>        from_secret: aws_id<br/>      AWS_SECRET_ACCESS_KEY:<br/>        from_secret: aws_key</span></pre><p id="bace" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">éƒ¨ç½²å®Œæˆåï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨. drone.yml ä¸­æŒ‡å®šæ¶æ„æˆ–åˆ é™¤ä»»ä½•æ¶æ„å£°æ˜æ¥è¿è¡Œ x86 æ„å»ºï¼Œå› ä¸º x86 æ˜¯é»˜è®¤çš„ã€‚</p><p id="072f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æˆ‘è¿˜åœ¨è¿™é‡Œé‡å»ºäº†ä¸€ä¸ª AWS-CLI æ˜ åƒ<a class="ae je" href="https://hub.docker.com/r/t3chflicks/aws-cli" rel="noopener ugc nofollow" target="_blank"/>ã€‚</p></div><div class="ab cl ml mm gp mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="hb hc hd he hf"><p id="fd7c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æˆ‘ä»¬å·²ç»ä»‹ç»äº†ç®¡é“çš„éƒ¨ç½²éƒ¨åˆ†ï¼Œåœ¨æœ¬ç³»åˆ—çš„ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»ç›‘æ§æ–¹æ³•å¹¶è®¨è®ºä¸€äº›é—®é¢˜ã€‚åœ¨è¿™é‡ŒæŸ¥çœ‹<a class="ae je" rel="noopener" href="/@t3chflicks/home-devops-pipeline-a-junior-engineers-tale-4-4-5db7c1610e3e"/>ã€‚</p><p id="fbf4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">å†…å®¹:</em> <a class="ae je" rel="noopener" href="/@t3chflicks/home-devops-pipeline-a-junior-engineers-tale-1-4-336ed07a6ec0"> <em class="jd"> 1 </em> </a> <em class="jd">ï¼Œ</em> <a class="ae je" rel="noopener" href="/@t3chflicks/home-devops-pipeline-a-junior-engineers-tale-2-4-7be3e3c292c"> <em class="jd"> 2 </em> </a> <em class="jd">ï¼Œ(</em> <a class="ae je" rel="noopener" href="/@t3chflicks/home-devops-pipeline-a-junior-engineers-tale-3-4-5f61c5245934"> <em class="jd"> 3 </em> </a> <em class="jd">)ï¼Œ</em> <a class="ae je" rel="noopener" href="/@t3chflicks/home-devops-pipeline-a-junior-engineers-tale-4-4-5db7c1610e3e"> <em class="jd"> 4 </em> </a></p><blockquote class="jf"><p id="e3de" class="jg jh hi bd ji jj jk jl jm jn jo jc dx translated"><a class="ae je" href="https://github.com/sk-t3ch/home-repo" rel="noopener ugc nofollow" target="_blank">ğŸ”—åœ¨ Github ä¸Šè·å– Home DevOps ç®¡é“ä»£ç ğŸ“”</a></p></blockquote><h1 id="2184" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">æ„Ÿè°¢é˜…è¯»</h1><p id="83b2" class="pw-post-body-paragraph if ig hi ih b ii lb ik il im lc io ip iq ld is it iu le iw ix iy lf ja jb jc hb bi translated">æˆ‘å¸Œæœ›ä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ã€‚å¦‚æœä½ å–œæ¬¢è¿™ç§é£æ ¼ï¼Œå¯ä»¥å»çœ‹çœ‹<a class="ae je" href="https://t3chflicks.org/Projects/home-devops-pipeline" rel="noopener ugc nofollow" target="_blank">T3chFlicks.org</a>äº†è§£æ›´å¤šä¸“æ³¨äºç§‘æŠ€çš„æ•™è‚²å†…å®¹(<a class="ae je" href="https://www.youtube.com/channel/UC0eSD-tdiJMI5GQTkMmZ-6w" rel="noopener ugc nofollow" target="_blank"> YouTube </a>ã€<a class="ae je" href="https://www.instagram.com/t3chflicks/" rel="noopener ugc nofollow" target="_blank"> Instagram </a>ã€<a class="ae je" href="https://www.facebook.com/t3chflicks" rel="noopener ugc nofollow" target="_blank">è„¸ä¹¦</a>ã€<a class="ae je" href="https://twitter.com/t3chflicks" rel="noopener ugc nofollow" target="_blank"> Twitter </a>)ã€‚</p></div></div>    
</body>
</html>