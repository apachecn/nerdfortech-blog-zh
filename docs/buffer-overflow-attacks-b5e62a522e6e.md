# ç¼“å†²åŒºæº¢å‡ºæ”»å‡»

> åŸæ–‡ï¼š<https://medium.com/nerd-for-tech/buffer-overflow-attacks-b5e62a522e6e?source=collection_archive---------10----------------------->

ç”¨ç®€å•çš„ä¾‹å­ç†è§£ç¼“å†²åŒºæº¢å‡ºæ”»å‡»

**ä»€ä¹ˆæ˜¯ç¼“å†²ï¼Ÿ**

åœ¨è®¡ç®—æœºå†…å­˜ä¸­ï¼Œç¼“å†²åŒºæ˜¯ä¸€ä¸ªå›ºå®šå¤§å°çš„ä¸´æ—¶å­˜å‚¨åŒºåŸŸã€‚å®ƒå¯ä»¥ç”¨äºåœ¨ä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶å­˜å‚¨æ•°æ®ï¼Œæˆ–è€…ä¸´æ—¶å­˜å‚¨ç”¨æˆ·è¾“å…¥ï¼Œç›´åˆ°å®ƒè¢«ä¼ è¾“åˆ°ä¸“ç”¨çš„å­˜å‚¨åŒºåŸŸã€‚

**ä»€ä¹ˆæ˜¯ç¼“å†²åŒºæº¢å‡ºï¼Ÿ**

å½“ç¨‹åºè¯•å›¾å‘ç¼“å†²åŒºå†™å…¥è¶…è¿‡ç¼“å†²åŒºå¤§å°çš„æ•°æ®é‡æ—¶ï¼Œè¿™æ˜¯ä¸€ç§ä¸å¯»å¸¸çš„è¡Œä¸ºã€‚å› æ­¤ï¼Œç¼“å†²åŒºçš„ç›¸é‚»å­˜å‚¨ä½ç½®è¢«è¦†ç›–ã€‚è¿™ç§å¼‚å¸¸ç§°ä¸ºç¼“å†²åŒºæº¢å‡ºã€‚

**ç¼“å†²åŒºæº¢å‡ºçš„ç±»å‹**

é€šå¸¸ä¼šå‘ç”Ÿä¸‰ç§ç±»å‹çš„ç¼“å†²åŒºæº¢å‡ºã€‚å®ƒä»¬å¦‚ä¸‹æ‰€ç¤º:

1 åŸºäºå †æ ˆçš„ç¼“å†²åŒºæº¢å‡º

2 åŸºäºå †çš„ç¼“å†²åŒºæº¢å‡º

3 å…¨å±€ç¼“å†²åŒºæº¢å‡º

> æ³¨æ„:åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†è€ƒè™‘éå¸¸ç®€å•çš„ç¨‹åºæ¥ç†è§£ 3 ç§ç±»å‹çš„ç¼“å†²åŒºæº¢å‡ºæ”»å‡»ï¼Œå®é™…ä¸Šæ”»å‡»å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚è¦ç†è§£å®é™…çš„ç¼“å†²åŒºæº¢å‡ºï¼Œéœ€è¦äº†è§£å¯„å­˜å™¨åŠå…¶æ“ä½œæ–¹å¼ã€‚

**åŸºäºå †æ ˆçš„ç¼“å†²åŒºæº¢å‡º**

æˆ‘ä»¬å°†è€ƒè™‘ç”¨ C è¯­è¨€æ¥æ¼”ç¤ºè¿™ç§æ”»å‡»ã€‚C ä¸­æœ‰å‡ ä¸ªæ˜“å—ç¼“å†²åŒºæº¢å‡ºæ”»å‡»çš„å†…ç½®å‡½æ•°ï¼Œå¦‚ gets()ã€strcpy()ã€‚gets()ç”¨äºè·å–ç”¨æˆ·è¾“å…¥ï¼Œstrcpy()ç”¨äºå°†ä¸€ä¸ªå­—ç¬¦ä¸²å¤åˆ¶åˆ°å¦ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚gets()å‡½æ•°åœ¨æ¥å—ç”¨æˆ·è¾“å…¥æ—¶ä¸æ£€æŸ¥æ•°ç»„è¾¹ç•Œï¼Œè€Œåªæ˜¯æ¥å—ç”¨æˆ·è¾“å…¥çš„æ‰€æœ‰è¾“å…¥å­—ç¬¦ï¼Œä¸ strcpy()å‡½æ•°æ£€æŸ¥æ•°ç»„è¾¹ç•Œå¹¶åªæ˜¯å°†ä¸€ä¸ªå­—ç¬¦ä¸²å¤åˆ¶åˆ°å¦ä¸€ä¸ªå­—ç¬¦ä¸²çš„æ–¹å¼ç›¸åŒã€‚è¿™å¯èƒ½å¯¼è‡´ç¼“å†²åŒºæº¢å‡ºã€‚ä¸‹é¢çš„ C ç¨‹åºæ¼”ç¤ºäº†åŒæ ·çš„æƒ…å†µã€‚åœ¨ä¸‹é¢ç»™å‡ºçš„ C ä»£ç ä¸­ï¼Œä¸€ä¸ªå¤§å°ä¸º 3 çš„å˜é‡å­—ç¬¦ä¸²è¢«å£°æ˜å¹¶åˆå§‹åŒ–ä¸º 9ï¼Œå¦ä¸€ä¸ªå¤§å°ä¸º 4 çš„å˜é‡ç¼“å†²åŒºè¢«å£°æ˜å¹¶åˆå§‹åŒ–ä¸ºç©ºå­—ç¬¦ä¸²ã€‚åœ¨è¾“å‡ºä¸­å¯ä»¥è§‚å¯Ÿåˆ°ï¼Œstring å’Œ buffer å…·æœ‰ç›¸é‚»çš„å†…å­˜åŒºåŸŸï¼Œè¿™ä½¿å¾—å®ƒå®¹æ˜“å—åˆ°ç¼“å†²åŒºæº¢å‡ºæ”»å‡»ã€‚è·å–(ç¼“å†²åŒº)ï¼›ç”¨äºæ¥æ”¶ç”¨æˆ·çš„è¾“å…¥ã€‚æ¶æ„æ”»å‡»è€…ä¸ºäº†åˆ©ç”¨æ­¤æ¼æ´ï¼Œä¼šè¾“å…¥è¶…è¿‡ç¼“å†²åŒºæ‰€èƒ½å®¹çº³çš„å¤§å°çš„è¾“å…¥ï¼Œå¦‚è¾“å…¥å¤§å°ä¸º 6 (>4)çš„è¾“å‡ºæ‰€ç¤ºï¼Œè¿™ä¼šå¯¼è‡´ç¼“å†²åŒºæº¢å‡ºå’Œå­—ç¬¦ä¸²ä¸­çš„æ•°æ®è¢«è¦†ç›–ã€‚å¯ä»¥è§‚å¯Ÿåˆ°ï¼Œå­—ç¬¦ä¸²ä¸­çš„æ•°æ®å·²è¢«æ›´æ”¹ä¸º ckã€‚è¿™æ˜¯å› ä¸ºè¾“å…¥â€œattackâ€çš„å¤§å°æ˜¯ 6ï¼Œç¼“å†²åŒºçš„å¤§å°æ˜¯ 4ï¼Œæ‰€ä»¥è¾“å…¥â€œattackâ€çš„æœ€å 2 ä¸ªå­—ç¬¦ä¼šæº¢å‡ºå¹¶è¢«å¤åˆ¶åˆ° stringã€‚

```
include<stdio.h>
#include<string.h>
**int** main()
{
 **char** string[3] = "9";
 **char** buffer[4] = " ";
 printf("Buffer[4] Memory Allocation: \n");
 **for**(**int** i=0;i<4;i++)
 {
 printf("%d %u\n",i,&buffer[i]);
 }
 printf("\nString[3] Memory Allocation: \n");
 **for**(**int** i=0;i<3;i++)
 {
 printf("%d %u\n",i,&string[i]);
 }
 printf("\n\nBefore Attack >> Buffer: %s String:%s\n",buffer,string);
 printf("\n\nPerforming the Attack....\n");
 *//strcpy(buffer,"Attack");*
 printf("Enter the input:");
 gets(buffer);
 printf("After Attack >> Buffer: %s String:%s\n",buffer,string);
 printf("\n\nReinitializing variables and securing the code....\n");
 strcpy(string,"9");
 strcpy(buffer," ");
 printf("Reinitialized >> Buffer: %s String:%s\n",buffer,string);
 printf("\n\nPerforming the Attack....\n");
 *//strcpy_s(buffer,4,"Attack");*
 printf("Enter the input:");
 fgets(buffer,4,stdin);
 printf("After Attack >> Buffer: %s String:%s\n",buffer,string);
 **return** 0;
}
```

![](img/34524cc43fbce1f133f2b6db15bf649b.png)

åŸºäºå †æ ˆçš„ç¼“å†²åŒºæº¢å‡º

> æ³¨æ„:æ‚¨å¯ä»¥åˆ é™¤ç¨‹åºä¸­çš„æ³¨é‡Šï¼Œçœ‹çœ‹ strcpy()å‡½æ•°å¦‚ä½•å®¹æ˜“å—åˆ°ç¼“å†²åŒºæº¢å‡ºçš„æ”»å‡»ã€‚

ä»è¾“å‡ºä¸­å¯ä»¥çœ‹å‡ºï¼Œå½“ä½¿ç”¨ fgets()å‡½æ•°æ‰§è¡Œæ”»å‡»æ—¶ï¼Œç”±äºæ²¡æœ‰ç¼“å†²åŒºæº¢å‡ºï¼Œæ‰€ä»¥æ”»å‡»æ²¡æœ‰æˆåŠŸã€‚è¿™æ˜¯å› ä¸º fgets()å‡½æ•°ä¸ gets()å‡½æ•°ä¸åŒï¼Œå®ƒåªæ¥å—å°äºæˆ–ç­‰äºå­˜å‚¨è¾“å…¥çš„å˜é‡å¤§å°çš„è¾“å…¥å­—ç¬¦ã€‚fgets()åœ¨å…¶å‚æ•°ä¸­å–å˜é‡çš„æœ€å¤§å€¼ã€‚å› æ­¤ï¼Œä»è¾“å‡ºä¸­å¯ä»¥çœ‹å‡ºï¼Œå®ƒåªå°†â€œattâ€ä½œä¸ºè¾“å…¥ï¼Œå¹¶æ‹’ç»æ¥è‡ªè¾“å…¥çš„â€œackâ€ã€‚ç”±äºå­˜å‚¨çš„æœ€åä¸€ä¸ªå­—ç¬¦æ˜¯â€œ\0â€ï¼Œå› æ­¤åªæ¥å—ä¸‰ä¸ªå­—ç¬¦â€œattâ€ã€‚åŒæ ·ï¼Œstrcpy()ä¸æ£€æŸ¥æ•°ç»„è¾¹ç•Œï¼Œç›´æ¥å°†ä¸€ä¸ªå­—ç¬¦ä¸²å¤åˆ¶åˆ°å¦ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¦‚æœæºå­—ç¬¦ä¸²æ¯”ç›®æ ‡å­—ç¬¦ä¸²å¤§ï¼Œå°±ä¼šå¯¼è‡´ç¼“å†²åŒºæº¢å‡ºã€‚ä¸ºäº†é˜²æ­¢è¿™ç§æƒ…å†µå‘ç”Ÿï¼Œåº”è¯¥ä½¿ç”¨ strcpy_s()ã€‚strcpy_s()å°†ç›®æ ‡å­—ç¬¦ä¸²çš„æœ€å¤§å¤§å°ä½œä¸ºå‚æ•°ï¼Œå¦‚æœå®ƒå‘ç°æºå­—ç¬¦ä¸²çš„å¤§å°å¤§äºç›®æ ‡å­—ç¬¦ä¸²çš„å¤§å°ï¼Œå®ƒä¸ä¼šå°†ä¸€ä¸ªå­—ç¬¦å¤åˆ¶åˆ°ç›®æ ‡å­—ç¬¦ä¸²ï¼Œä»è€Œé˜²æ­¢ç¼“å†²åŒºæº¢å‡º

**åŸºäºå †çš„ç¼“å†²åŒºæº¢å‡º**

åŸºäºå †çš„ç¼“å†²åŒºæº¢å‡ºä»¥ç›¸åŒçš„æ–¹å¼å‘ç”Ÿï¼Œä¸åŒä¹‹å¤„åœ¨äºè¿™é‡Œä»¥åŠ¨æ€æ–¹å¼ä¸ºç¼“å†²åŒºåˆ†é…å†…å­˜ã€‚æ‰€ä»¥æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªç®€å•çš„ C ç¨‹åºã€‚

```
#include<stdio.h>
#include<stdlib.h>
#include<string.h>
**int** main()
{
 **char** *buffer;
 buffer = (**char***)malloc(5***sizeof**(**char**));
 **char** *string;
 string = (**char***)malloc(5***sizeof**(**char**));
 printf("Heap Overflow Attack: \n\n");
 printf("Memory Addresses of String and Buffer: \n");
 printf("String: %p \n", string);
 printf("Buffer: %p \n\n", buffer);
 printf("Performing attack using strcpy().........\n\n");
 *//strcpy(buffer,"abcdefghijklmnopqrstuvwxyz1234567890");*
 gets(buffer);
 printf("Buffer overflowed and overwrites empty String:\n");
 printf("String: %s \n\n", string);
 printf("Reinitializing Variables to empty string:\n");
 strcpy(string, " ");
 strcpy(buffer, " ");
 printf("String: %s \n", string);
 printf("Buffer: %s \n\n", buffer);
 printf("Performing attack using strcpy_s().......\n\n");
 *//strcpy_s(buffer, 5, "abcdefghijklmnopqrstuvwxyz1234567890");*
 fgets(buffer,5,stdin);
 printf("No overflow:\n");
 printf("String: %s", string);
 **return** 0;
}
```

![](img/1000197141e5ad45f8c25bcd4f27f0bd.png)

åŸºäºå †çš„ç¼“å†²åŒºæº¢å‡º

å¯è§ gets()å’Œ strcpy()å‡½æ•°æœ‰å¤šä¸å®‰å…¨ã€‚

**å…¨å±€ç¼“å†²åŒºæº¢å‡º**

è¿™é‡Œï¼Œç¼“å†²åŒºå…·æœ‰å…¨å±€èŒƒå›´ã€‚

```
#include<stdlib.h>
#include<stdio.h>
#include<string.h>
**char** access;
**char** buffer[4]; *//global buffer*
**int** main(**int** argc, **char** **argv)
{
 **char** *A = argv[1];
 **char** *B = "pass";
 access = 'n';
 strcpy(buffer,A);
 *//strcpy_s(buffer,4,A);*
 **if** (strcmp(buffer,B)==0)
 {
 access = 'y';
 }
 **if**(access == 'y')
 {
 printf("\nThis is a secret");
 }
 **else**
 {
 printf("\nAccess Denied");
 }
**return** 0;
}
```

![](img/a0a7ab4f878da369bd714d18266f6293.png)

å…¨å±€ç¼“å†²åŒºæº¢å‡º

ä»ä¸Šé¢çš„ç¨‹åºä¸­å¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬è¯•å›¾æº¢å‡ºå…¨å±€å£°æ˜çš„ç¼“å†²åŒºã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å£°æ˜äº†ä¸€ä¸ªå…¨å±€å˜é‡â€œaccess â€,å®ƒå°†ç”¨äºæ‰§è¡Œè®¿é—®æ§åˆ¶ã€‚è¿˜æœ‰ï¼Œè¿˜æœ‰ä¸€ä¸ªå…¨å±€ç¼“å†²åŒºâ€œbufferâ€ã€‚å½“ä½¿ç”¨ strcpy()å°†å‘½ä»¤è¡Œå‚æ•°å¤åˆ¶åˆ°â€œbufferâ€æ—¶ï¼Œç¼“å†²åŒºå¯èƒ½ä¼šæº¢å‡ºã€‚å› æ­¤ï¼Œæ­£å¦‚åœ¨è¾“å‡ºä¸­çœ‹åˆ°çš„ï¼Œå½“æˆ‘ä»¬ç»™å®šè¾“å…¥ä¸ºâ€œabcyyyyyyyyyyâ€æ—¶ï¼Œå®ƒå°†æº¢å‡ºï¼Œå¹¶ä¸”â€œyâ€å°†åœ¨â€œaccessâ€å˜é‡ä¸­è¢«è¦†ç›–ï¼Œè¿™å°†éæ³•è®¿é—®ä»£ç çš„å¯†ç ä¿æŠ¤éƒ¨åˆ†ã€‚

**ç»“è®º**

å¯ä»¥å¾—å‡ºè¿™æ ·çš„ç»“è®º:å¦‚æœä½¿ç”¨ä¸å‡€åŒ–ç”¨æˆ·è¾“å…¥çš„æ˜“å—æ”»å‡»çš„å‡½æ•°ï¼Œç¼“å†²åŒºæº¢å‡ºæ”»å‡»å¾ˆå®¹æ˜“è¢«åˆ©ç”¨ï¼Œå¹¶å¯èƒ½å¯¼è‡´ç¾éš¾æ€§çš„ç ´åã€‚å› æ­¤ï¼Œä¸ºäº†é˜²æ­¢è¿™äº›æ”»å‡»çš„å‘ç”Ÿï¼Œæœ€å¥½ä½¿ç”¨ fgets()å’Œ strcpy_s()ä¹‹ç±»çš„å‡½æ•°æ¥å‡€åŒ–ç”¨æˆ·è¾“å…¥ã€‚åº”è¯¥ä½¿ç”¨ strcpy()æˆ– strcpy()æ¥é˜²æ­¢ç¼“å†²åŒºæº¢å‡ºæ”»å‡»ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ strcpy()ã€‚å¦å¤–ï¼Œåº”è¯¥ä½¿ç”¨ strcmp()æ¥ä»£æ›¿ strcmp()ã€‚

å¯¹äºä»»ä½•æŠ€æœ¯æˆ–å…¶ä»–é”™è¯¯ï¼Œéšæ—¶ä¸æˆ‘è”ç³»ï¼Œä»¥ä¾¿è¿›ä¸€æ­¥çš„è¯»è€…å—ç›Šã€‚

æ„Ÿè°¢æ‚¨çš„é˜…è¯»ã€‚çŸ¥è¯†å°±æ˜¯åŠ›é‡ï¼Œæ‰€ä»¥ä¸æ–­è·å–ï¼ğŸ˜ˆ

åœ¨ [GitHub](https://github.com/gandhidevansh) ä¸Šå…³æ³¨æˆ‘å§ï¼