<html>
<head>
<title>Terraform Import Existing AWS Resources</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Terraform å¯¼å…¥ç°æœ‰ AWS èµ„æº</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/nerd-for-tech/terraform-import-existing-aws-resources-c1f1b4b19f87?source=collection_archive---------0-----------------------#2021-04-10">https://medium.com/nerd-for-tech/terraform-import-existing-aws-resources-c1f1b4b19f87?source=collection_archive---------0-----------------------#2021-04-10</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/a6fd54db6d0fdb3c5e58cdd89a30e41e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f8s0aV5vLBL7I-Gpg1R6AA.jpeg"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">è¿˜æœ‰â€¦ä¹Ÿè®¸æ˜¯é«˜çº§çš„ğŸ˜‚</figcaption></figure><div class=""/><p id="11e3" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">ä½¿ç”¨å˜é‡å’Œæ¡ä»¶è¯­å¥</p><h1 id="086f" class="js jt hx bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">åœ¨æˆ‘ä»¬å¼€å§‹ä¹‹å‰â€¦</h1><p id="b67f" class="pw-post-body-paragraph iu iv hx iw b ix kq iz ja jb kr jd je jf ks jh ji jj kt jl jm jn ku jp jq jr hb bi translated">ç¡®ä¿æ‚¨æœ‰ä¸€ä¸ª AWS å¸æˆ·ï¼Œä»¥ä¾¿åœ¨æ‚¨è‡ªå·±çš„ç¯å¢ƒä¸­è¿›è¡Œæµ‹è¯•ã€‚ä½ è¿˜éœ€è¦çŸ¥é“å¦‚ä½•ç¼–å†™ä¸€äº›åŸºæœ¬çš„åœ°å½¢ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­[å¤§éƒ¨åˆ†]æˆ‘ä»¬ä¸ä¼šå†™é«˜çº§çš„åœ°å½¢ã€‚äº‹å®ä¸Šï¼Œåœ¨è¿™ç¯‡æ–‡ç« å‘è¡¨å‰å‡ å¤©ï¼Œæˆ‘è‡ªå·±ä»æœªåœ¨ terraform å†…éƒ¨ç¼–å†™è¿‡æ¡ä»¶è¯­å¥ï¼Œç›´åˆ°å·¥ä½œä¸­å‡ºç°äº†æŸç§æƒ…å†µã€‚</p><p id="c9b3" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><em class="kv">ä½¿ç”¨æ¡ˆä¾‹:</em></p><p id="8ffb" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">æ‚¨çš„å·¥ä½œåœºæ‰€æœ€è¿‘(åƒå¤§å¤šæ•°å…¬å¸ä¸€æ ·)é‡‡ç”¨åŸºç¡€è®¾æ–½ä½œä¸ºä»£ç (ä»¥äº‘ä¸å¯çŸ¥çš„å½¢å¼)å·¥å…· Terraformã€‚æœ€è¿‘ï¼Œå·²ç»ä½¿ç”¨æ¨¡å—(å¯é‡ç”¨ä»£ç )åœ¨ terraform ä¸­å»ºç«‹äº†åŸºç¡€è®¾æ–½ï¼Œä½†æ˜¯æ‚¨ç°åœ¨éœ€è¦å°†æ‰€æœ‰ ec2 å®ä¾‹ã€rds æ•°æ®åº“å’Œå¼¹æ€§ IP å¯¼å…¥åˆ°æ‚¨çš„å­˜å‚¨åº“ä¸­ã€‚</p><p id="f48a" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">ä»¤äººæ¬£æ…°çš„æ˜¯ï¼ŒHashiCorp æœ‰å¾ˆå¥½çš„æ–‡æ¡£ï¼Œæˆ‘ä»¬å°†å‚è€ƒè¿™äº›æ–‡æ¡£ã€‚</p><h1 id="5f31" class="js jt hx bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated"><strong class="ak">è°ƒæ•™</strong></h1><p id="ebf8" class="pw-post-body-paragraph iu iv hx iw b ix kq iz ja jb kr jd je jf ks jh ji jj kt jl jm jn ku jp jq jr hb bi translated">åœ¨æˆ‘çš„ AWS å¸æˆ·ä¸­ï¼Œæˆ‘å·²ç»æ‰‹åŠ¨å¯åŠ¨äº† 2 ä¸ª ec2 å®ä¾‹(t2.micro â€”å…è´¹å±‚)ã€ä¸€ä¸ªå…è´¹å±‚ MySQL rds å®ä¾‹å’Œ 2 ä¸ªå¼¹æ€§ IPã€‚</p><figure class="kx ky kz la fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es kw"><img src="../Images/397b6d7d20c6a47f8792c9b73f036389.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tslsJwmJPd4SDSjUnTLNpw.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">ec2 å®ä¾‹</figcaption></figure><figure class="kx ky kz la fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lb"><img src="../Images/fb16ae23d29297de11b6da79b4043d82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4dBmxYnbPp_vq7i3NgXE6w.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">å¼¹æ€§ ips</figcaption></figure><figure class="kx ky kz la fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lc"><img src="../Images/a71892f681688d07968148d60a282815.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K-qrG7KSh1j7A798Bqp3mQ.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">rds MySQL å®ä¾‹</figcaption></figure><h1 id="89fd" class="js jt hx bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">åœ°å½¢æ¨¡å—</h1><p id="5e07" class="pw-post-body-paragraph iu iv hx iw b ix kq iz ja jb kr jd je jf ks jh ji jj kt jl jm jn ku jp jq jr hb bi translated">è®¸å¤šå…¬å¸ä½¿ç”¨è¢«ç§°ä¸ºå¯é‡ç”¨ä»£ç çš„æ¨¡å—ã€‚æ¨¡å—çœ‹èµ·æ¥æ›´æ•´æ´ï¼Œä½†æ˜¯â€œå­æ¨¡å—â€ä¹Ÿç§°ä¸ºèµ„æºå—é…ç½®æ˜¯æ¨¡å—(çˆ¶æ¨¡å—)çš„åŠ¨åŠ›ï¼Œæˆ‘å°†ç®€è¦åœ°æŒ‡å‡ºçˆ¶æ¨¡å—å’Œå­æ¨¡å—çš„åŒºåˆ«ã€‚è®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹æˆ‘ä»¬çš„åœ°å½¢ä»£ç ã€‚å¯¼å…¥åï¼Œå½“æˆ‘ä»¬ä» terraform è®¡åˆ’ä¸­è·å¾—æ›´å¤šè¯¦ç»†ä¿¡æ¯æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æˆ‘ä»¬çš„ terraform é…ç½®è¿›è¡Œæ›´æ”¹å’Œæ·»åŠ ã€‚</p><pre class="kx ky kz la fd ld le lf lg aw lh bi"><span id="c6f0" class="li jt hx le b fi lj lk l ll lm"># --- ec2 instance resources --- #</span><span id="99a0" class="li jt hx le b fi ln lk l ll lm">resource "aws_instance" "tfimportec2" {<br/>ami = var.ami[var.region]<br/>#ami IS REGION SPECIFIC - please check which region you are in if you receive an error<br/>instance_type = var.instance_override == false ? var.instance_type : var.no_instance_type_change<br/>key_name = "tf-demo"<br/>}</span><span id="8c4c" class="li jt hx le b fi ln lk l ll lm">resource "aws_eip" "tfeip1" {<br/>vpc = true <br/>tags = {<br/>  Name = "Tf-eip"<br/> }<br/>}</span><span id="7c78" class="li jt hx le b fi ln lk l ll lm">resource "aws_eip_association" "eip_assoc1" {<br/>instance_id   = aws_instance.tfimportec2.id<br/>allocation_id = aws_eip.tfeip1.id<br/>}</span><span id="00c4" class="li jt hx le b fi ln lk l ll lm"># --- Rds instance resource--- #</span><span id="3b56" class="li jt hx le b fi ln lk l ll lm">resource "aws_db_instance" "tfdatabase" {<br/>engine         = "mysql"<br/>engine_version = "8.0.20"<br/>instance_class = "db.t2.micro"<br/>name           = "tf-import-mysql"<br/>allocated_storage = 20<br/>availability_zone = "us-east-1c"<br/>skip_final_snapshot = true<br/>backup_retention_period = 0<br/>apply_immediately = true<br/>username = var.username</span></pre><p id="1f02" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä¸ªåŸºçº¿ä»£ç (å®ƒå¯èƒ½ä¼šå‡ºé”™ï¼Œä½†æ˜¯æˆ‘ä»¬ä¼šåœ¨å‡ºç°é”™è¯¯æ—¶å¤„ç†å®ƒ)</p><h1 id="e030" class="js jt hx bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">åœ°å½¢æ¡ä»¶å¥</h1><div class="hh hi ez fb hj lo"><a href="https://www.terraform.io/docs/language/expressions/conditionals.html" rel="noopener  ugc nofollow" target="_blank"><div class="lp ab dw"><div class="lq ab lr cl cj ls"><h2 class="bd hy fi z dy lt ea eb lu ed ef hw bi translated">æ¡ä»¶è¡¨è¾¾å¼-é…ç½®è¯­è¨€- Terraform</h2><div class="lv l"><h3 class="bd b fi z dy lt ea eb lu ed ef dx translated">å®è·µ:å°è¯• HashiCorp Learn ä¸Šçš„åˆ›å»ºåŠ¨æ€è¡¨è¾¾å¼æ•™ç¨‹ã€‚æ¡ä»¶è¡¨è¾¾å¼ä½¿ç”¨â€¦çš„å€¼</h3></div><div class="lw l"><p class="bd b fp z dy lt ea eb lu ed ef dx translated">www.terraform.io</p></div></div><div class="lx l"><div class="ly l lz ma mb lx mc hp lo"/></div></div></a></div><p id="0aeb" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">è¿™æ˜¯ä½¿ç”¨å˜é‡ã€å€¼æˆ– null æ¥å®Œæˆä¸åŒå¯¼å…¥æƒ…å†µçš„å…³é”®ã€‚</p><p id="659a" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">ä½¿ç”¨æ¡ˆä¾‹:</p><p id="e51c" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">æ‚¨çš„å…¬å¸æœ‰ä¸€ä¸ªä½¿ç”¨æ—§å®ä¾‹ç±»å‹çš„æ—§å®¢æˆ·ã€‚æ‚¨ä¸æƒ³åœæ­¢å®ƒä»¬çš„ ec2 å®ä¾‹æˆ–å¼ºåˆ¶é‡æ–°åˆ›å»ºï¼Œæ‰€ä»¥æ‚¨éœ€è¦ä¸€ä¸ªå€¼æ¥è¦†ç›–å®ƒã€‚Terraform conditional ä½¿ç”¨ç®€å•çš„é€»è¾‘æ¥å®ç°è¿™ä¸ªç›®æ ‡ã€‚æˆ‘ä»¬å°†æ¶µç›–æ¡ä»¶çš„ä¸€ä¸ªé€‰é¡¹ï¼Œä»¥å…æ··æ·†:</p><pre class="kx ky kz la fd ld le lf lg aw lh bi"><span id="c4ac" class="li jt hx le b fi lj lk l ll lm">condition ? true_val : false_val</span></pre><p id="e761" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">è®©æˆ‘ä»¬å°†å…¶ä¸ aws_instance èµ„æºçš„ instance_type å±æ€§è¿›è¡Œæ¯”è¾ƒã€‚</p><pre class="kx ky kz la fd ld le lf lg aw lh bi"><span id="61ea" class="li jt hx le b fi lj lk l ll lm">instance_type = var.instance_override == false ? var.instance_type : var.set_instance_type</span></pre><p id="9552" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">è§£é‡Š:æˆ‘ä»¬çš„ instance_type çš„å€¼å°†ç­‰äºå˜é‡ instance_override çš„å€¼(è¿™æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ç±»å‹â€”çœŸ/å‡)ï¼Œå®ƒç­‰äºâ€œå‡â€ç„¶å(ï¼Ÿ)terraform å°†è¯„ä¼°å¹¶é€‰æ‹©æ­£ç¡®çš„é™ˆè¿°(ä½äº:)ã€‚å¦‚æœ instance_override çš„å€¼ç­‰äºâ€œtrue â€,åˆ™è¯¥è¯­å¥å°†è¢«å‘ˆç°ä¸º falseï¼Œå¹¶ä¸ºæˆ‘ä»¬æä¾› var.set_instance_type çš„å€¼æˆ– false è¯­å¥:var.set_instance_type æˆ–(:)çš„ right</p><p id="35e9" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦è¦†ç›–å½“å‰çš„å®ä¾‹ç±»å‹ï¼Œå°† var.instance_override è®¾ç½®ä¸º trueï¼Œå¹¶å°† set_instance_type çš„å˜é‡æ›´æ”¹ä¸ºç±»ä¼¼ t3.micro çš„å€¼ã€‚</p><pre class="kx ky kz la fd ld le lf lg aw lh bi"><span id="f23b" class="li jt hx le b fi lj lk l ll lm"># --- Partent Module Variables ---child module variables should be empty or default to false ---</span><span id="5b06" class="li jt hx le b fi ln lk l ll lm">variable "instance_override" {<br/>type = bool<br/>default = true<br/>}</span><span id="6bad" class="li jt hx le b fi ln lk l ll lm">variable "instance_type" {<br/>type = string<br/>default = "t3.micro"<br/>}</span></pre><p id="2da2" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">æ–°åœ°å½¢å›¾:</p><pre class="kx ky kz la fd ld le lf lg aw lh bi"><span id="f987" class="li jt hx le b fi lj lk l ll lm"># module.instance.aws_instance.tfimportec2[0] will be updated in-place<br/>  ~ resource "aws_instance" "tfimportec2" {<br/>        id                           = "i-078654854b88d8fe8"<br/>      ~ instance_type                = "t2.micro" -&gt; "t3.micro"<br/>        tags                         = {<br/>            "Name"              = "ec2One"<br/>            "Terraform Managed" = "False"<br/>        }<br/>        # (27 unchanged attributes hidden)</span><span id="94cc" class="li jt hx le b fi ln lk l ll lm"># (6 unchanged blocks hidden)<br/>    }</span></pre><p id="c6cc" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">ç°åœ¨è®©æˆ‘ä»¬å¼€å§‹å°† ec2 å®ä¾‹å¯¼å…¥åˆ°æ¨¡å—ä¸­â€¦ä¸‹é¢é¦–å…ˆæ˜¯çˆ¶æ¨¡å—ã€‚</p><pre class="kx ky kz la fd ld le lf lg aw lh bi"><span id="5c45" class="li jt hx le b fi lj lk l ll lm"># --- PARENT MODULE --- this calls on the child module which contains the meat and potatoes of the config --- #</span><span id="085f" class="li jt hx le b fi ln lk l ll lm">module "instance" {<br/>source = "../"</span><span id="f435" class="li jt hx le b fi ln lk l ll lm">#note: if you are using a git repo you can use the same link from the clone/download option for the source attribute above, but it will only read from master. Check terraform doucmentation on how to read from branches other than master</span><span id="e189" class="li jt hx le b fi ln lk l ll lm">instance_override = var.instance_override <br/># or you can just enter the boolen value above true or false</span><span id="c528" class="li jt hx le b fi ln lk l ll lm">set_instance_type = var.set_instance_type<br/># or you can enter the instance_type in "string" format</span><span id="906a" class="li jt hx le b fi ln lk l ll lm">region = var.region<br/>#or you can enter the region in "string" format<br/>}</span></pre><p id="b9a2" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">æ³¨æ„:å­æ¨¡å—å˜é‡å–ä»£çˆ¶æ¨¡å—å˜é‡ï¼Œé™¤éå®ƒä»¬åœ¨æ¨¡å—å—ä¸­æ˜ç¡®å®šä¹‰ã€‚æœ€ä½³å®è·µæ˜¯è®©å­æ¨¡å—å˜é‡ä¸º null æˆ–ç©º" "ï¼Œè¿™æ ·æ‚¨å°±å¯ä»¥åœ¨çˆ¶æ¨¡å—å˜é‡ä¸­è®¾ç½®å®ƒä»¬ã€‚</p><p id="cd2a" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">å¯¼å…¥æˆ‘ä»¬çš„ AWS èµ„æºçš„å‘½ä»¤:</p><p id="fa03" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><a class="ae md" href="https://www.terraform.io/docs/cli/commands/import.html" rel="noopener ugc nofollow" target="_blank">https://www.terraform.io/docs/cli/commands/import.html</a></p><pre class="kx ky kz la fd ld le lf lg aw lh bi"><span id="332d" class="li jt hx le b fi lj lk l ll lm">terraform init</span></pre><p id="77fc" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">Ec2 å¯¼å…¥:</p><pre class="kx ky kz la fd ld le lf lg aw lh bi"><span id="0e5d" class="li jt hx le b fi lj lk l ll lm">terraform import module.&lt;module name&gt;.aws_instance.&lt;instance name from tf&gt; &lt;instance id from aws&gt;</span><span id="68cf" class="li jt hx le b fi ln lk l ll lm">terraform import module.instance.aws_instance.tfimportec2 i-078654854b88d8fe8</span><span id="e336" class="li jt hx le b fi ln lk l ll lm">Elastic ip assocaited with the instance:</span><span id="0d5b" class="li jt hx le b fi ln lk l ll lm">terraform import module.instance.aws_eip.tfeip1 eipalloc-0f6e1a3dc02ffdf90</span><span id="e65f" class="li jt hx le b fi ln lk l ll lm">terraform import module.instance.aws_eip_association.eip_assoc1 eipassoc-098a46cff0b605ded</span></pre><p id="e1ef" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">ç°åœ¨å°è¯•å¯¼å…¥ä¸Šè¿° 3 ä¸ªèµ„æºâ€¦</p><p id="2a0c" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">åœ¨æˆ‘ä»¬å¯¼å…¥ä¹‹å‰ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°æˆ‘ç›®å‰åœ¨ terraform çŠ¶æ€ä¸‹æ²¡æœ‰èµ„æº</p><figure class="kx ky kz la fd hk er es paragraph-image"><div class="er es me"><img src="../Images/811b30dbbaf67b10f4c70fd441416f39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1296/format:webp/1*4mO_phnfju0di8Wd_er2vg.png"/></div></figure><p id="3732" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">ç°åœ¨å¯¼å…¥ ec2 å®ä¾‹ï¼Œç„¶åè¿è¡Œ:</p><pre class="kx ky kz la fd ld le lf lg aw lh bi"><span id="222b" class="li jt hx le b fi lj lk l ll lm">terraform state list</span></pre><p id="300d" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">å˜£ï¼æˆ‘ä»¬è¿›å»äº†</p><pre class="kx ky kz la fd ld le lf lg aw lh bi"><span id="1eb1" class="li jt hx le b fi lj lk l ll lm">~/Desktop/tfimporttest/modules -- terraform import module.instance.aws_instance.tfimportec2 i-078654854b88d8fe8<br/>module.instance.aws_instance.tfimportec2: Importing from ID "i-078654854b88d8fe8"...<br/>module.instance.aws_instance.tfimportec2: Import prepared!<br/>  Prepared aws_instance for import<br/>module.instance.aws_instance.tfimportec2: Refreshing state... [id=i-078654854b88d8fe8]</span><span id="4f16" class="li jt hx le b fi ln lk l ll lm">Import successful!</span><span id="3ee7" class="li jt hx le b fi ln lk l ll lm">The resources that were imported are shown above. These resources are now in<br/>your Terraform state and will henceforth be managed by Terraform.</span><span id="d0ed" class="li jt hx le b fi ln lk l ll lm">~/Desktop/tfimporttest/modules -- terraform state list<br/>module.instance.aws_instance.tfimportec2 </span></pre><p id="0255" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">ç°åœ¨è¿è¡Œ terraform è®¡åˆ’ï¼Œç„¶åæ‚¨å¯ä»¥æ·»åŠ ä»»ä½•å±æ€§æ¥æ»¡è¶³è¯¥è®¡åˆ’ã€‚ä½ è¦çœ‹åˆ°æ›´æ–°åˆ°ä½ä¸æ˜¯<strong class="iw hy"> <em class="kv">æ›¿æ¢</em> </strong>æˆ–è€…<strong class="iw hy">#éƒ¨é˜Ÿæ›¿æ¢ã€‚</strong></p><pre class="kx ky kz la fd ld le lf lg aw lh bi"><span id="ad5f" class="li jt hx le b fi lj lk l ll lm"># module.instance.aws_instance.tfimportec2 will be updated in-place<br/>  ~ resource "aws_instance" "tfimportec2" {<br/>      - iam_instance_profile         = "Ec2Full" -&gt; null<br/>        id                           = "i-078654854b88d8fe8"<br/>      ~ tags                         = {<br/>          - "Name"              = "ec2One" -&gt; null<br/>          - "Terraform Managed" = "False" -&gt; null<br/>        }<br/>        # (27 unchanged attributes hidden)</span><span id="c6a5" class="li jt hx le b fi ln lk l ll lm"># (6 unchanged blocks hidden)<br/>    }<br/></span></pre><figure class="kx ky kz la fd hk er es paragraph-image"><div class="er es mf"><img src="../Images/3c15aa0832a3c7ecacfcfa559d89cb50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1288/format:webp/1*VYuy9sw0PPKRFkFCYk7gOA.png"/></div></figure><p id="b55a" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">æ‚¨å°†åœ¨ä¸Šé¢çš„èµ„æºè®¡åˆ’ä¸­çœ‹åˆ°ï¼Œæˆ‘ä»¬éœ€è¦åœ¨èµ„æºé…ç½®ä¸­æ·»åŠ ä¸€äº›ä¸œè¥¿ï¼Œä»¥é˜²æ­¢åˆ é™¤ä¸€äº›å±æ€§(ä¾‹å¦‚ï¼Œæ ‡ç­¾ï¼Œæˆ‘æ˜¯å®ä¾‹é…ç½®æ–‡ä»¶)</p><p id="f733" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">æ–°é…ç½®:</p><pre class="kx ky kz la fd ld le lf lg aw lh bi"><span id="d1ee" class="li jt hx le b fi lj lk l ll lm"># --- CHILD MODULE --- #<br/>resource "aws_instance" "tfimportec2" {<br/>iam_instance_profile  = "Ec2Full"<br/>ami = var.ami[var.region]<br/>#ami IS REGION SPECIFIC - please check which region you are in if you receive an errorinstance_type = var.instance_override == false ? var.instance_type : var.set_instance_typekey_name = "tf-demo"<br/>tags = {<br/>"Name"              = "ec2One"<br/>"Terraform Managed" = "False"<br/> }<br/>}</span></pre><p id="af33" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">ç°åœ¨ï¼Œå¯¼å…¥æ‚¨æƒ³è¦çš„ä»¥åŠæˆ‘ä»¬åœ¨æœ€ç»ˆè®¡åˆ’ä¸­æƒ³è¦çš„å…¶ä½™ä»»ä½•èµ„æºï¼Œç„¶åæœ€åè®¨è®ºâ€œcount =â€å±æ€§ï¼Œè¯¥å±æ€§å°†æ”¹å˜æ‚¨å¦‚ä½•å¯¼å…¥ä»å¤šä¸ªç›¸åŒèµ„æºä¸­è°ƒé…çš„æ¯ä¸ªèµ„æºã€‚</p><p id="8aaf" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">å¿«é€ŸæŸ¥çœ‹å¯¼å…¥ rds èµ„æº:</p><pre class="kx ky kz la fd ld le lf lg aw lh bi"><span id="040b" class="li jt hx le b fi lj lk l ll lm">terraform import module.&lt;module name&gt;.aws_db_instance.&lt;db instance name from tf&gt; &lt;name of rds db&gt;</span><span id="aea1" class="li jt hx le b fi ln lk l ll lm">terraform import module.instance.aws_db_instance.tfdatabase tf-import-mysql</span></pre><p id="1e97" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">ç°åœ¨æˆ‘ä»¬çš„èµ„æºåº”è¯¥éƒ½æ˜¾ç¤ºåœ¨ terraform çŠ¶æ€åˆ—è¡¨ä¸‹:</p><pre class="kx ky kz la fd ld le lf lg aw lh bi"><span id="8bc4" class="li jt hx le b fi lj lk l ll lm">~/Desktop/tfimporttest/modules î‚° terraform state list<br/>module.instance.aws_db_instance.tfdatabase<br/>module.instance.aws_eip.tfeip1<br/>module.instance.aws_eip_association.eip_assoc1<br/>module.instance.aws_instance.tfimportec2</span></pre><p id="eecc" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">æˆ‘ä»ç„¶æœ‰å‡ ä¸ªæ›´æ–°ï¼Œä½†éå¸¸å°ï¼Œæ²¡æœ‰æ›¿æ¢:</p><pre class="kx ky kz la fd ld le lf lg aw lh bi"><span id="ec49" class="li jt hx le b fi lj lk l ll lm"># module.instance.aws_db_instance.tfdatabase will be updated in-place<br/>  ~ resource "aws_db_instance" "tfdatabase" {<br/>      + apply_immediately                     = true<br/>      ~ backup_retention_period               = 7 -&gt; 0<br/>      ~ copy_tags_to_snapshot                 = true -&gt; false<br/>        id                                    = "tf-import-mysql"<br/>      - max_allocated_storage                 = 21 -&gt; null<br/>        tags                                  = {}<br/>        # (39 unchanged attributes hidden)</span><span id="c48c" class="li jt hx le b fi ln lk l ll lm"># (1 unchanged block hidden)<br/>    }</span><span id="067b" class="li jt hx le b fi ln lk l ll lm"># module.instance.aws_eip.tfeip1 will be updated in-place<br/>  ~ resource "aws_eip" "tfeip1" {<br/>        id                   = "eipalloc-0f6e1a3dc02ffdf90"<br/>      ~ tags                 = {<br/>          ~ "Name" = "eip1" -&gt; "Tf-eip"<br/>        }<br/>        # (11 unchanged attributes hidden)</span><span id="c014" class="li jt hx le b fi ln lk l ll lm"># (1 unchanged block hidden)<br/>    }</span><span id="ba58" class="li jt hx le b fi ln lk l ll lm">Plan: 0 to add, 2 to change, 0 to destroy.</span></pre><p id="4fc3" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">ä»»ä½•èµ„æºä¸Šçš„ Count å‚æ•°:<br/>å½“å¯¼å…¥å¸¦æœ‰å¦‚ä¸‹ count å‚æ•°çš„èµ„æºæ—¶ï¼Œæ‚¨çš„ terraform å¯¼å…¥å‘½ä»¤å¿…é¡»ç”¨å•å¼•å·å°†èµ„æºçš„å€¼(count)æ‹¬èµ·æ¥ã€‚</p><pre class="kx ky kz la fd ld le lf lg aw lh bi"><span id="a214" class="li jt hx le b fi lj lk l ll lm"># --- ec2 instance resources --- #</span><span id="63ab" class="li jt hx le b fi ln lk l ll lm"># --- CHILD MODULE --- #</span><span id="da20" class="li jt hx le b fi ln lk l ll lm">resource "aws_instance" "tfimportec2" {<br/>count = var.count_id<br/>iam_instance_profile         = "Ec2Full"<br/>ami = var.ami[var.region]<br/>#ami IS REGION SPECIFIC - please check which region you are in if you receive an error<br/>instance_type = var.instance_override == false ? var.instance_type : var.set_instance_type<br/>key_name = "tf-demo"<br/>tags = {<br/>"Name"              = "ec2One"<br/>"Terraform Managed" = "False"<br/> }<br/>}</span><span id="b863" class="li jt hx le b fi ln lk l ll lm"># --- PARENT MODULE ---</span><span id="ea7f" class="li jt hx le b fi ln lk l ll lm">module "instance" {<br/>source = "../"</span><span id="9322" class="li jt hx le b fi ln lk l ll lm"><br/>instance_override = true<br/>set_instance_type = var.instance_type<br/>region = var.region<br/>count = var.count_id<br/>}</span><span id="ec57" class="li jt hx le b fi ln lk l ll lm">#---- add this variable in to both the child and parent module for consistency --- #</span><span id="0357" class="li jt hx le b fi ln lk l ll lm">variable "count_id" {<br/>type = number<br/>default = 2<br/>}</span></pre><p id="0faf" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">å¯¼å…¥è®¡æ•°ä¸º 2 çš„ aws_instanceï¼Œæˆ‘ä»¬å°†æ‰§è¡Œè®¾ç½®éƒ¨åˆ†ä¸­æ˜¾ç¤ºçš„ç¬¬äºŒä¸ªå®ä¾‹:</p><pre class="kx ky kz la fd ld le lf lg aw lh bi"><span id="95f6" class="li jt hx le b fi lj lk l ll lm">terraform import 'module.instance.aws_instance.tfimportec2[1]' i-02cd6a5f093b9e204</span></pre><p id="68c2" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">[1]ä½œä¸ºç¬¬äºŒä¸ªå®ä¾‹ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»å¯¼å…¥äº†ç¬¬ä¸€ä¸ªå®ä¾‹ï¼Œå®ƒåº”è¯¥æ˜¯å…·æœ‰æ­£ç¡® id çš„[0]ã€‚å¯¹äº eip å’Œ eip_associationï¼Œæ‚¨å¿…é¡»åœ¨å¯¼å…¥ä¹‹å‰ä½¿ç”¨ count.index å€¼ã€‚</p><pre class="kx ky kz la fd ld le lf lg aw lh bi"><span id="d1f8" class="li jt hx le b fi lj lk l ll lm">resource "aws_eip" "tfeip1" {<br/>count = var.count_id<br/>instance = aws_instance.tfimportec2[count.index].id<br/>vpc = true<br/>tags = {<br/>Name = "Tf-eip"<br/> }<br/>}</span><span id="1dc5" class="li jt hx le b fi ln lk l ll lm">resource "aws_eip_association" "eip_assoc1" {<br/>count = var.count_id<br/>instance_id   = aws_instance.tfimportec2[count.index].id<br/>allocation_id = aws_eip.tfeip1[count.index].id<br/>}</span><span id="41a2" class="li jt hx le b fi ln lk l ll lm">~/Desktop/tfimporttest/modules î‚° terraform import 'module.instance.aws_instance.tfimportec2[1]' i-02cd6a5f093b9e204<br/>module.instance.aws_instance.tfimportec2[1]: Importing from ID "i-02cd6a5f093b9e204"...<br/>module.instance.aws_instance.tfimportec2[1]: Import prepared!<br/>  Prepared aws_instance for import<br/>module.instance.aws_instance.tfimportec2[1]: Refreshing state... [id=i-02cd6a5f093b9e204]</span><span id="bd6c" class="li jt hx le b fi ln lk l ll lm">Import successful!</span><span id="8f85" class="li jt hx le b fi ln lk l ll lm">The resources that were imported are shown above. These resources are now in<br/>your Terraform state and will henceforth be managed by Terraform.</span><span id="7fff" class="li jt hx le b fi ln lk l ll lm">~/Desktop/tfimporttest/modules î‚° terraform import 'module.instance.aws_eip.tfeip1[1]' eipalloc-03a089d76beec0c7a                                module.instance.aws_eip.tfeip1[1]: Importing from ID "eipalloc-03a089d76beec0c7a"...<br/>module.instance.aws_eip.tfeip1[1]: Import prepared!<br/>  Prepared aws_eip for import<br/>module.instance.aws_eip.tfeip1[1]: Refreshing state... [id=eipalloc-03a089d76beec0c7a]</span><span id="c718" class="li jt hx le b fi ln lk l ll lm">Import successful!</span><span id="7108" class="li jt hx le b fi ln lk l ll lm">The resources that were imported are shown above. These resources are now in<br/>your Terraform state and will henceforth be managed by Terraform.</span><span id="e879" class="li jt hx le b fi ln lk l ll lm">~/Desktop/tfimporttest/modules î‚° terraform import module.'instance.aws_eip_association.eip_assoc1[1]' eipassoc-03a089d76beec0c7a<br/>module.instance.aws_eip_association.eip_assoc1[1]: Importing from ID "eipassoc-03a089d76beec0c7a"...<br/>module.instance.aws_eip_association.eip_assoc1[1]: Import prepared!<br/>  Prepared aws_eip_association for import<br/>module.instance.aws_eip_association.eip_assoc1[1]: Refreshing state... [id=eipassoc-03a089d76beec0c7a]</span><span id="27c6" class="li jt hx le b fi ln lk l ll lm">Import successful!</span><span id="d4c2" class="li jt hx le b fi ln lk l ll lm">The resources that were imported are shown above. These resources are now in<br/>your Terraform state and will henceforth be managed by Terraform.</span></pre><p id="bed9" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">ç°åœ¨æˆ‘ä»¬å·²ç»å¯¼å…¥äº†æ‰€æœ‰çš„èµ„æºï¼Œæˆ‘ä»¬å¯ä»¥è¿è¡Œä¸‹é¢çš„å‘½ä»¤å¹¶å°†å…¶å…¨éƒ¨åˆ é™¤ã€‚</p><pre class="kx ky kz la fd ld le lf lg aw lh bi"><span id="e518" class="li jt hx le b fi lj lk l ll lm">terraform destroy --auto-approve </span></pre><p id="7dfb" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">æ„Ÿè°¢é˜…è¯»ï¼å¦‚æœæœ‰ä»»ä½•ä¸æ¸…æ¥šçš„åœ°æ–¹ï¼Œè¯·è¯„è®ºï¼Œå¦‚æœæˆ‘èƒ½å¸®å¿™çš„è¯ï¼Œæˆ‘ä¼šå›å¤çš„ï¼</p></div></div>    
</body>
</html>