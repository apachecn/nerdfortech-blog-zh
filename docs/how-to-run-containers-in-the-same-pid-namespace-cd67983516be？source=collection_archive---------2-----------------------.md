# å¦‚ä½•åœ¨åŒä¸€ä¸ª PID åç§°ç©ºé—´ä¸­è¿è¡Œå®¹å™¨ï¼Ÿ

> åŽŸæ–‡ï¼š<https://medium.com/nerd-for-tech/how-to-run-containers-in-the-same-pid-namespace-cd67983516be?source=collection_archive---------2----------------------->

## å®¹å™¨éš”ç¦»å’Œ PID åç§°ç©ºé—´æ¦‚è¿°

![](img/f5285c20293a96bda0b96266ca0de825.png)

æ¥è‡ª: [Docker Docs](https://www.docker.com/resources/what-container/)

## å®¹å™¨éš”ç¦»æ¦‚è¿°

ä½¿ç”¨åç§°ç©ºé—´å’Œ cgroups å°†å®¹å™¨ä¸Žä¸»æœºå†…æ ¸éš”ç¦»å¼€æ¥ã€‚

**åç§°ç©ºé—´:**é™åˆ¶æ¯ä¸ªè¿›ç¨‹å¯ä»¥çœ‹åˆ°çš„å†…å®¹(ä¾‹å¦‚â€”å…¶ä»–è¿›ç¨‹ã€ç”¨æˆ·ã€æ–‡ä»¶ç³»ç»Ÿ)
Cgroups:é™åˆ¶è¿›ç¨‹çš„èµ„æºä½¿ç”¨(ä¾‹å¦‚â€” RAMã€ç£ç›˜ã€CPU)

## Linux å†…æ ¸åç§°ç©ºé—´:

åç§°ç©ºé—´æ˜¯ Linux å†…æ ¸çš„ä¸€ä¸ªç‰¹æ€§ï¼Œå®ƒå¯¹å†…æ ¸èµ„æºè¿›è¡Œåˆ†åŒºï¼Œä½¿å¾—ä¸€ç»„è¿›ç¨‹çœ‹åˆ°ä¸€ç»„èµ„æºï¼Œè€Œå¦ä¸€ç»„è¿›ç¨‹çœ‹åˆ°ä¸€ç»„ä¸åŒçš„èµ„æºã€‚

## å‘½åç©ºé—´çš„ç±»åž‹:

**PID åç§°ç©ºé—´:**è¿™ç§ç±»åž‹çš„åç§°ç©ºé—´å°†è¿›ç¨‹ç›¸äº’éš”ç¦»ã€‚ä¸€ä¸ªè¿›ç¨‹çœ‹ä¸åˆ°å…¶ä»–è¿›ç¨‹ï¼Œè€Œä¸”åŒä¸€ä¸ªè¿›ç¨‹ ID å¯ä»¥å­˜åœ¨äºŽå¤šä¸ªåç§°ç©ºé—´ä¸­ã€‚æ¯”å¦‚â€” **è¿›ç¨‹ ID 1** å¯ä»¥å­˜åœ¨å¤šæ¬¡ï¼Œä½†æ˜¯åœ¨æ¯ä¸ªåç§°ç©ºé—´ä¸­åªèƒ½å­˜åœ¨ä¸€æ¬¡ã€‚

**æŒ‚è½½åç§°ç©ºé—´:**æœ‰ä¸€ä¸ªç‹¬ç«‹çš„æŒ‚è½½ç‚¹åˆ—è¡¨ï¼Œç”±ç›¸åº”åç§°ç©ºé—´ä¸­çš„è¿›ç¨‹æŸ¥çœ‹ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥åœ¨æŒ‚è½½åç§°ç©ºé—´ä¸­æŒ‚è½½å’Œå¸è½½æ–‡ä»¶ç³»ç»Ÿï¼Œè€Œä¸ä¼šå½±å“ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚

**ç½‘ç»œåç§°ç©ºé—´:**åªå…è®¸è®¿é—®æŸäº›ç½‘ç»œè®¾å¤‡ã€‚å®ƒæœ‰è‡ªå·±çš„é˜²ç«å¢™ã€è·¯ç”±è§„åˆ™å’Œå¥—æŽ¥å­—ç«¯å£å·ã€‚å› æ­¤ï¼Œå®ƒæ— æ³•çœ‹åˆ°æ‰€æœ‰æµé‡æˆ–è”ç³»æ‰€æœ‰ç«¯ç‚¹

**ç”¨æˆ·åç§°ç©ºé—´:**ä½¿ç”¨ä¸€ç»„ä¸åŒçš„ç”¨æˆ· id å’Œç»„ idã€‚ä¾‹å¦‚â€”ä¸€ä¸ªå‘½åç©ºé—´ä¸­çš„ç”¨æˆ·(0)å¯èƒ½ä¸Žå¦ä¸€ä¸ªå‘½åç©ºé—´ä¸­çš„ç”¨æˆ·(0)ä¸åŒã€‚

ä½†æ˜¯ä¸ºäº†å®‰å…¨èµ·è§ï¼Œå»ºè®®ä¸è¦åœ¨å®¹å™¨å†…éƒ¨ä½¿ç”¨ root ç”¨æˆ·(0)ã€‚

è®©æˆ‘ä»¬è¿è¡Œä¸¤ä¸ª docker å®¹å™¨ï¼Œçœ‹çœ‹å®ƒä»¬æ˜¯å¦‚ä½•ç›¸äº’éš”ç¦»çš„:

**â—é›†è£…ç®± 1: c1**

```
>> docker run --name c1 -d ubuntu sh -c 'sleep 1d'

>> docker exec c1 ps aux

USER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
root           1  0.1  0.0   2880  1004 ?        Ss   03:57   0:00 sh -c sleep 1d
root           6  0.0  0.0   2780  1056 ?        S    03:57   0:00 sleep 1d #**
root          12  0.0  0.0   7052  1588 ?        Rs   03:57   0:00 ps aux
```

**â—å®¹å™¨ 2: c2**

```
>> docker run --name c2 -d ubuntu sh -c 'sleep 365d'

>> docker exec c2 ps aux

USER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
root           1  0.1  0.0   2880   964 ?        Ss   04:00   0:00 sh -c sleep 365d
root           6  0.0  0.0   2780  1008 ?        S    04:00   0:00 sleep 365d
root           7  0.0  0.0   7052  1576 ?        Rs   04:00   0:00 ps aux
```

æˆ‘ä»¬å·²ç»åˆ›å»ºäº†ä¸¤ä¸ªåä¸º**ã€C1ã€‘**å’Œ**ã€C2ã€‘**çš„å®¹å™¨ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°â€œc1â€å®¹å™¨æ— æ³•çœ‹åˆ°â€œc2â€çš„è¿‡ç¨‹ï¼Œåä¹‹äº¦ç„¶ã€‚

ä½†æ˜¯ç”±äºŽè¿™ä¸¤ä¸ªå®¹å™¨è¿è¡Œåœ¨åŒä¸€ä¸ª Linux å†…æ ¸ä¸Šã€‚ä»Žä¸»æœºå¯ä»¥çœ‹åˆ°å®¹å™¨å†…éƒ¨è¿è¡Œçš„è¿›ç¨‹ã€‚ä½†æ˜¯è¿›ç¨‹ ID ä¼šæœ‰æ‰€ä¸åŒï¼Œå› ä¸ºå®ƒæ˜¯ä½¿ç”¨ PID åç§°ç©ºé—´éš”ç¦»çš„ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥è¯´å®¹å™¨åªä¸è¿‡æ˜¯è¿è¡Œåœ¨ Linux å†…æ ¸ä¸Šçš„ä¸€ç»„è¿›ç¨‹ã€‚

ä»Ž Linux å†…æ ¸æ£€æŸ¥è¿›ç¨‹:

```
>> ps aux | grep -i sleep

root     46938  0.0  0.0   2880  1004 ?      Ss   03:57   0:00 sh -c sleep 1d
root     46973  0.0  0.0   2780  1056 ?      S    03:57   0:00 sleep 1d #<--
root     48280  0.0  0.0   2880   964 ?      Ss   04:00   0:00 sh -c sleep 365d
root     48366  0.0  0.0   2780  1008 ?      S    04:00   0:00 sleep 365d #<--
```

åœ¨ä¸Šå›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨â€œc1â€å’Œâ€œc2â€å®¹å™¨ä¸­è¿è¡Œçš„è¿›ç¨‹å¯ä»¥ä»Ž Linux ä¸»æœºä¸Šè¿›è¡Œæ£€æŸ¥ã€‚

## åœ¨åŒä¸€ä¸ª PID åç§°ç©ºé—´ä¸­è¿è¡Œå®¹å™¨:

çŽ°åœ¨ï¼Œæˆ‘ä»¬å°†å°è¯•åœ¨åŒä¸€ä¸ª PID åç§°ç©ºé—´ä¸­è¿è¡Œå®¹å™¨ã€‚å¦‚æžœæˆ‘ä»¬èƒ½å¤Ÿåšåˆ°è¿™ä¸€ç‚¹ï¼Œé‚£ä¹ˆåœ¨åŒä¸€ä¸ª PID åç§°ç©ºé—´ä¸­è¿è¡Œçš„å®¹å™¨å°†ä¼šçœ‹åˆ°å½¼æ­¤çš„è¿›ç¨‹ã€‚

è®©æˆ‘ä»¬åˆ é™¤**â€œC1â€**å®¹å™¨ï¼Œç„¶åŽæˆ‘ä»¬å°†å°è¯•åœ¨**â€œC2â€**å®¹å™¨çš„ PID åç§°ç©ºé—´ä¸­åˆ›å»ºå®ƒ:

```
>> docker rm c1 --force
```

è®©æˆ‘ä»¬å°è¯•åœ¨åŒä¸€ä¸ª PID åç§°ç©ºé—´ä¸­è¿è¡Œä¸¤ä¸ªå®¹å™¨ã€‚

```
# run container "c1" within the same namespace of the "c2"
>> docker run --name c1 --pid=container:c2 -d ubuntu sh -c 'sleep 1d'

>> docker exec c1 ps aux
USER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
root           1  0.0  0.0   2880   948 ?        Ss   04:00   0:00 sh -c sleep 365d
root           6  0.0  0.0   2780  1008 ?        S    04:00   0:00 sleep 365d
root          12  0.0  0.0   2880   964 ?        Ss   04:11   0:00 sh -c sleep 1d
root          17  0.0  0.0   2780  1056 ?        S    04:11   0:00 sleep 1d
root          18  0.0  0.0   7052  1580 ?        Rs   04:11   0:00 ps aux

>> docker exec c2 ps aux
USER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
root           1  0.0  0.0   2880   948 ?        Ss   04:00   0:00 sh -c sleep 365d
root           6  0.0  0.0   2780  1008 ?        S    04:00   0:00 sleep 365d
root          12  0.0  0.0   2880   964 ?        Ss   04:11   0:00 sh -c sleep 1d
root          17  0.0  0.0   2780  1056 ?        S    04:11   0:00 sleep 1d
root          23  0.0  0.0   7052  1644 ?        Rs   04:12   0:00 ps aux
```

çŽ°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªå®¹å™¨è¿è¡Œåœ¨åŒä¸€ä¸ª PID åç§°ç©ºé—´ä¸Šï¼Œå¹¶ä¸”èƒ½å¤Ÿçœ‹åˆ°å½¼æ­¤ã€‚

> *å¦‚æžœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« å¾ˆæœ‰å¸®åŠ©ï¼Œè¯·ç‚¹å‡»* ***è·Ÿéš*** *ðŸ‘‰******æ‹æ‹*** *ðŸ‘* *æŒ‰é’®å¸®åŠ©æˆ‘å†™æ›´å¤šè¿™æ ·çš„æ–‡ç« ã€‚
> è°¢è°¢ðŸ–¤***

## ***ðŸ‘‰æ‰€æœ‰å…³äºŽ Linux çš„æ–‡ç« ***

**![Md Shamim](img/b46bdc53005abde6c6cb3e8ff0c200c3.png)

[Md æ²™ç±³å§†](/@shamimice03?source=post_page-----cd67983516be--------------------------------)** 

## **æ‰€æœ‰å…³äºŽ Linux çš„æ–‡ç« **

**[View list](/@shamimice03/list/all-articles-on-linux-1339e15e3304?source=post_page-----cd67983516be--------------------------------)****12 stories****![](img/259cf1a3ab76526a3f714f7cbaffac3d.png)****![](img/985a8b8ce1f1090a033d94ee7ac5f4fd.png)****![](img/d917609dcb8b45812e60ccd8bf2ed277.png)**

## **ðŸ‘‰å…³äºŽ Kubernetes çš„æ‰€æœ‰æ–‡ç« **

**![Md Shamim](img/b46bdc53005abde6c6cb3e8ff0c200c3.png)

[Md æ²™ç±³å§†](/@shamimice03?source=post_page-----cd67983516be--------------------------------)** 

## **å…³äºŽ Kubernetes çš„æ‰€æœ‰æ–‡ç« **

**[View list](/@shamimice03/list/all-articles-on-kubernetes-7ae1a0f96f3b?source=post_page-----cd67983516be--------------------------------)****24 stories****![](img/f1050aa27a3ef03122558b1ba1de1f58.png)****![](img/f1c4131e92176033bce05392de197205.png)****![](img/27d4385154af67764cf37713dbbdc38e.png)**