# ä»å›è°ƒåœ°ç‹±åˆ°ç§‘ç‰¹æ—åç¨‹çš„æ—…ç¨‹ï¼Œç¬¬ 2 é›†

> åŸæ–‡ï¼š<https://medium.com/nerd-for-tech/a-journey-from-callback-hell-to-kotlin-coroutines-episode-2-c048f9898f?source=collection_archive---------13----------------------->

![](img/370f1d1938b7aa25d7fb9fcffe30a152.png)

é©¬å…‹Â·èµ–æ­‡å°”åœ¨ [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) ä¸Šçš„ç…§ç‰‡

ä½ å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°ç¬¬ä¸€é›†

å¥½äº†ï¼Œç°åœ¨ï¼Œåœ¨åˆç¡åï¼Œè‰¾å“ˆè¿ˆå¾·æ„Ÿè§‰å¾ˆå¥½ã€‚ä»–ä»¥ç¥ˆç¥·ã€åƒæ—©é¤å¼€å§‹ä»–çš„æ—¥å¸¸å·¥ä½œï¼Œç„¶åä»–ç»§ç»­ç ”ç©¶åç¨‹ã€‚

ä»–æƒ³çŸ¥é“é‚£ä¸ª **suspend** å…³é”®å­—åé¢æ˜¯ä»€ä¹ˆï¼Œä»–ç»§ç»­ä»–çš„è¿›åº¦é˜…è¯»ï¼Œ

> åç¨‹çš„æ¦‚å¿µæ˜¯ä¸€ä¸ªå‡½æ•°å¯ä»¥åœ¨æŸä¸ªæ—¶å€™æš‚åœæ‰§è¡Œï¼Œç¨åå†ç»§ç»­æ‰§è¡Œã€‚

Ahmed å‡ ä¹è¢«è¯´æœé€‰æ‹©åç¨‹è€Œä¸æ˜¯å…¶ä»–è§£å†³æ–¹æ¡ˆã€‚ä½†æ˜¯æƒ³å†™ä¸€äº›ä»£ç æ¥çœ‹çœ‹å®ƒçš„è¿è¡Œæƒ…å†µã€‚ä»–åœ¨ [kotlinlang](https://kotlinlang.org/docs/coroutines-basics.html#your-first-coroutine) ç½‘ç«™ä¸Šæ‰¾åˆ°äº†ä¸‹é¢çš„ä»£ç ç‰‡æ®µæ¥å±•ç¤ºä¸€ä¸ªç®€å•çš„åç¨‹

![](img/0da820faedf2831f486d6e4740b4d5f6.png)

æ˜¾ç¤ºä¸€ä¸ªç®€å•åç¨‹çš„ä»£ç ç‰‡æ®µï¼Œ [kotlinlang](https://kotlinlang.org/docs/coroutines-basics.html#your-first-coroutine)

ä»–å‘ç°äº†ä»¥ä¸‹è¾“å‡º:

```
Hello,
World!
```

æœ‰æ„æ€ï¼Œä½†æ˜¯ä»€ä¹ˆæ˜¯*èŒƒå›´*å’Œ*å‘å°„ï¼Ÿè‰¾å“ˆè¿ˆå¾·é—®é“ï¼Œç„¶åä»–ç»§ç»­é˜…è¯»ä»¥å¾—åˆ°ç­”æ¡ˆ*:

# åç¨‹ä¸Šä¸‹æ–‡å’Œè°ƒåº¦ç¨‹åº

> åç¨‹æ€»æ˜¯åœ¨æŸäº›ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œ â€¦,åç¨‹ä¸Šä¸‹æ–‡æ˜¯å„ç§å…ƒç´ çš„é›†åˆã€‚ä¸»è¦å…ƒç´ æ˜¯åç¨‹çš„[ä½œä¸š](https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/-job/index.html)å’Œå®ƒçš„**è°ƒåº¦å™¨**ã€‚

åç¨‹ä¸Šä¸‹æ–‡åŒ…æ‹¬ä¸€ä¸ª*åç¨‹è°ƒåº¦å™¨*(è§[åç¨‹è°ƒåº¦å™¨](https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/-coroutine-dispatcher/index.html))ï¼Œå®ƒå†³å®šç›¸åº”çš„åç¨‹ä½¿ç”¨å“ªä¸ªæˆ–å“ªäº›çº¿ç¨‹æ¥æ‰§è¡Œã€‚åç¨‹è°ƒåº¦ç¨‹åºå¯ä»¥å°†åç¨‹çš„æ‰§è¡Œé™åˆ¶åœ¨ä¸€ä¸ªç‰¹å®šçš„çº¿ç¨‹ä¸Šï¼Œå°†å®ƒè°ƒåº¦åˆ°ä¸€ä¸ªçº¿ç¨‹æ± ä¸­ï¼Œæˆ–è€…è®©å®ƒä¸å—é™åˆ¶åœ°è¿è¡Œã€‚

æ‚¨å¯ä»¥ä½¿ç”¨å¯é€‰çš„*åç¨‹ä¸Šä¸‹æ–‡ã€*æ¥è°ƒç”¨ launch{}å’Œ async{}å‡½æ•°ï¼Œä»¥ç¡®å®šè¿™ä¸ªåç¨‹ä½¿ç”¨å“ªä¸ªçº¿ç¨‹æ¥æ‰§è¡Œã€‚

![](img/ef32fe7a62a7597d16f8f10094d286a1.png)

è¿è¡Œä¸Šé¢çš„ä»£ç ç‰‡æ®µï¼ŒAhmed çœ‹åˆ°äº†ä»¥ä¸‹è¾“å‡º:

```
Unconfined            : I'm working in thread main
Default               : I'm working in thread DefaultDispatcher-worker-1
newSingleThreadContext: I'm working in thread MyOwnThread
main runBlocking      : I'm working in thread main
```

å› æ­¤ï¼Œåœ¨ç»§ç»­é˜…è¯»è¿™é‡Œçš„[ä¹‹åï¼Œä»–å¯¹å¦‚ä½•è¿è¡Œä¸€ä¸ªåç¨‹æœ‰äº†ä¸€ä¸ªå¾ˆå¥½çš„æƒ³æ³•ã€‚](https://kotlinlang.org/docs/coroutine-context-and-dispatchers.html#dispatchers-and-threads)

# æ£€æŸ¥æ€§èƒ½

ä¸ºäº†ç¡®ä¿åç¨‹æ˜¯è½»é‡çº§çš„ï¼Œå¹¶ä¸”ä¸åƒçœŸæ­£çš„çº¿ç¨‹é‚£æ ·æ˜‚è´µï¼ŒAhmed å†³å®šè¿è¡Œä¸€ä¸ª**ç™¾ä¸‡çº¿ç¨‹ï¼Œå¹¶å¯¹åç¨‹åšåŒæ ·çš„äº‹æƒ…ï¼Œ:D**

![](img/7793056ac8d0cb014dbfa75b2edec187.png)

æ¥è‡ª [kotlinlang](https://kotlinlang.org/docs/coroutines-basic-jvm.html#let-s-run-a-lot-of-them) çš„ snipperï¼Œè¿è¡Œ 1M çº¿ç¨‹

å®ƒè¿è¡Œ 1ï¼Œ000ï¼Œ000 ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹æ·»åŠ ä¸€ä¸ªå…¬å…±è®¡æ•°å™¨ã€‚è¿™åœ¨ä»–çš„æœºå™¨ä¸ŠèŠ±äº†è¶…è¿‡ 4 åˆ† 11 ç§’ã€‚

è®©æˆ‘ä»¬çœ‹çœ‹ä»–ç”¨åç¨‹åšåŒæ ·çš„äº‹æƒ…èŠ±äº†å¤šé•¿æ—¶é—´

![](img/40d323d7e638524f59568bb482589cb8.png)

æ¥è‡ª [kotlinlang](https://kotlinlang.org/docs/coroutines-basic-jvm.html#let-s-run-a-lot-of-them) çš„ snipperï¼Œè¿è¡Œ 1M çš„åç¨‹

è¿™ä¸ªä¾‹å­åœ¨**ä¸åˆ°ä¸€ç§’çš„æ—¶é—´å†…å®Œæˆ**ğŸ˜®ï¼Œä½†æ˜¯å®ƒæ‰“å°ä¸€äº›ä»»æ„çš„æ•°å­—ï¼Œå› ä¸ºä¸€äº›åç¨‹åœ¨`main()`æ‰“å°ç»“æœä¹‹å‰æ²¡æœ‰å®Œæˆã€‚è®©æˆ‘ä»¬è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

![](img/eb9c95fab462adf304a937956c3b86ad.png)

è¿™æ‰“å°äº†æ­£ç¡®çš„æ€»æ•°ã€‚

ä»–è¿˜æƒ³ç¡®ä¿æˆ‘ä»¬çš„ååŒç¨‹åºå®é™…ä¸Šæ˜¯å¹¶è¡Œè¿è¡Œçš„ã€‚ä»–ç»™æ¯ä¸ª`async`åŠ äº†ä¸€ä¸ª **1 ç§’**ï¼Œç»“æœç¨‹åºä¸åº”è¯¥è¿è¡Œ 1000000 ç§’(è¶…è¿‡ 11.5 å¤©):

![](img/c7810abac8a829d7ec922c9106acdaff.png)

è¿™èŠ±äº†å¤§çº¦ 10 ç§’é’Ÿï¼Œ**æ‰€ä»¥æ˜¯çš„**ï¼Œåç¨‹ç¡®å®æ˜¯å¹¶è¡Œè¿è¡Œçš„ã€‚

åœ¨è¿™ä¸€ç‚¹ä¸Šï¼ŒAhmed å®Œå…¨è¢«è¯´æœä½¿ç”¨åç¨‹è€Œä¸æ˜¯å…¶ä»–è§£å†³æ–¹æ¡ˆæ¥å¤„ç†çº¿ç¨‹å’Œå¼‚æ­¥ã€‚ä»–çš„ kotlin åº”ç”¨ç¨‹åºä¸­çš„ä»£ç ã€‚

ä»–æœ‰ä¸€ä¸ªå…³äºåç¨‹çš„å¥½ä¸»æ„æ¥å¼€å§‹ä½¿ç”¨å®ƒä»¬ï¼Œä½†æ˜¯å½“ç„¶ä»–éœ€è¦æ›´å¤šåœ°é˜…è¯»å¹¶åœ¨ä¸€äº›çœŸå®çš„é¡¹ç›®ä¸­å®è·µã€‚æ‰€ä»¥ä¹Ÿè®¸æˆ‘ä»¬å¯ä»¥åœ¨ä¸‹ä¸€é›†çœ‹åˆ°ä»–çš„å‘ç°:)

# å‚è€ƒ

[åç¨‹åŸºç¡€çŸ¥è¯†](https://kotlinlang.org/docs/coroutines-basic-jvm.htm)

[æˆ‘åœ¨#MENADD ä¸ Google(é˜¿æ‹‰ä¼¯è¯­)ä¸­è°ˆè®ºåç¨‹](https://www.youtube.com/watch?v=pbq8ema7YTA)

[Manuel Vivo çš„ Coroutines 101](https://www.youtube.com/watch?v=ZTDXo0-SKuU)